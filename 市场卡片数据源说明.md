# ğŸ“Š å¸‚åœºå¡ç‰‡æ•°æ®æºæ¶æ„è¯´æ˜

## ğŸ¯ æ•°æ®æ¥æº

### LUMI å¸‚åœºç³»ç»Ÿçš„ä¸‰å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. markets è¡¨ (Supabase)                â”‚
â”‚  â”œâ”€ å¸‚åœºåŸºæœ¬ä¿¡æ¯                          â”‚
â”‚  â”œâ”€ æ ‡é¢˜ã€æè¿°ã€åˆ†ç±»                      â”‚
â”‚  â”œâ”€ ç»“æŸæ—¶é—´                              â”‚
â”‚  â””â”€ æ¿€æ´»çŠ¶æ€                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. orderbooks è¡¨ (Supabase)             â”‚
â”‚  â”œâ”€ å®æ—¶è®¢å•ç°¿æ•°æ®                        â”‚
â”‚  â”œâ”€ bidsï¼ˆä¹°å•ï¼‰                          â”‚
â”‚  â”œâ”€ asksï¼ˆå–å•ï¼‰                          â”‚
â”‚  â”œâ”€ last_priceï¼ˆæœ€åä»·æ ¼ï¼‰                â”‚
â”‚  â””â”€ volume_24hï¼ˆ24å°æ—¶äº¤æ˜“é‡ï¼‰            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. åŒºå—é“¾ï¼ˆå®˜æ–¹ç»„ä»¶ï¼‰                     â”‚
â”‚  â”œâ”€ UMA é¢„è¨€æœº - åˆ›å»ºå’Œè£å†³å¸‚åœº           â”‚
â”‚  â”œâ”€ CTF Exchange - è®¢å•ç°¿äº¤æ˜“             â”‚
â”‚  â””â”€ Conditional Tokens - ä»£å¸ç®¡ç†         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ å¸‚åœºå¡ç‰‡æ˜¾ç¤ºçš„æ•°æ®

### æ•°æ®é¡¹ â†’ æ•°æ®æº

| æ˜¾ç¤ºå†…å®¹ | æ•°æ®æ¥æº | è¡¨/ç»„ä»¶ |
|---------|---------|---------|
| **æ ‡é¢˜** | markets.title | Supabase markets è¡¨ |
| **æè¿°** | markets.description | Supabase markets è¡¨ |
| **åˆ†ç±»** | markets.main_category | Supabase markets è¡¨ |
| **ç»“æŸæ—¶é—´** | markets.end_time | Supabase markets è¡¨ |
| **å½“å‰æ¦‚ç‡** | è®¡ç®—è‡ª orderbooks | Supabase orderbooks è¡¨ |
| **YESä»·æ ¼** | (bestBid + bestAsk) / 2 | Supabase orderbooks è¡¨ |
| **NOä»·æ ¼** | 1 - YESä»·æ ¼ | Supabase orderbooks è¡¨ |
| **äº¤æ˜“é‡** | orderbooks.volume_24h | Supabase orderbooks è¡¨ |
| **ä¹°ä»·** | orderbooks.bids[0].price | Supabase orderbooks è¡¨ |
| **å–ä»·** | orderbooks.asks[0].price | Supabase orderbooks è¡¨ |
| **ä»·å·®** | bestAsk - bestBid | Supabase orderbooks è¡¨ |

---

## ğŸ”„ å·¥ä½œæµç¨‹

### å¸‚åœºåˆ›å»ºæµç¨‹

```
1. ç®¡ç†å‘˜åœ¨Supabaseåˆ›å»ºå¸‚åœº
   â†“ (markets è¡¨æ’å…¥æ•°æ®)
   
2. ç”¨æˆ·ç‚¹å‡»"æˆ‘æ„Ÿå…´è¶£"
   â†“ (market_states è¡¨æ›´æ–°)
   
3. è¾¾åˆ°é˜ˆå€¼ï¼ˆ10äººï¼‰
   â†“
   
4. è§¦å‘åŒºå—é“¾æ¿€æ´»ï¼ˆé€šè¿‡RealUmaCTFAdapterï¼‰
   â”œâ”€ è°ƒç”¨ UMA é¢„è¨€æœºåˆ›å»ºå¸‚åœº
   â”œâ”€ è°ƒç”¨ Conditional Tokens åˆ›å»ºæ¡ä»¶
   â””â”€ è¿”å› condition_id
   â†“
   
5. æ›´æ–° markets è¡¨
   â”œâ”€ blockchain_status = 'created'
   â””â”€ condition_id = è¿”å›çš„ID
   â†“
   
6. ç”¨æˆ·å¯ä»¥äº¤æ˜“
```

### äº¤æ˜“æµç¨‹

```
1. ç”¨æˆ·ä¸‹å•ï¼ˆé€šè¿‡ CTF Exchangeï¼‰
   â†“
   
2. è®¢å•å†™å…¥ orders è¡¨
   â†“
   
3. è®¢å•åŒ¹é…å¼•æ“å¤„ç†
   â†“
   
4. æ›´æ–° orderbooks è¡¨
   â”œâ”€ æ›´æ–° bids/asks
   â”œâ”€ æ›´æ–° last_price
   â””â”€ æ›´æ–° volume_24h
   â†“
   
5. Supabase Realtime æ¨é€æ›´æ–°
   â†“
   
6. å‰ç«¯å®æ—¶æ›´æ–°ï¼ˆ< 1ç§’ï¼‰
   â”œâ”€ å¸‚åœºå¡ç‰‡æ¦‚ç‡æ›´æ–°
   â”œâ”€ å¸‚åœºå¡ç‰‡äº¤æ˜“é‡æ›´æ–°
   â””â”€ è¯¦æƒ…é¡µå›¾è¡¨é‡ç»˜
```

---

## ğŸ¯ å¸‚åœºå¡ç‰‡åº”è¯¥ä½¿ç”¨ä»€ä¹ˆï¼Ÿ

### é—®é¢˜ï¼šUMA è¿˜æ˜¯ CTF Exchangeï¼Ÿ

**ç­”æ¡ˆï¼šä¸¤è€…éƒ½ç”¨ï¼Œä½†åœ¨ä¸åŒé˜¶æ®µï¼**

### å®Œæ•´çš„ç»„ä»¶ä½¿ç”¨æ—¶æœº

| é˜¶æ®µ | ä½¿ç”¨ç»„ä»¶ | ç”¨é€” | æ•°æ®æº |
|------|---------|------|--------|
| **1. å¸‚åœºåˆ›å»º** | **UMAé¢„è¨€æœº** | åˆ›å»ºå¸‚åœºé—®é¢˜ | åŒºå—é“¾ |
| **2. ä»£å¸å‡†å¤‡** | **Conditional Tokens** | åˆ›å»ºYES/NOä»£å¸ | åŒºå—é“¾ |
| **3. æ˜¾ç¤ºä¿¡æ¯** | **marketsè¡¨** | æ˜¾ç¤ºæ ‡é¢˜ã€æè¿° | Supabase |
| **4. æ˜¾ç¤ºä»·æ ¼** | **orderbooksè¡¨** | æ˜¾ç¤ºæ¦‚ç‡ã€ä»·æ ¼ | Supabase |
| **5. ç”¨æˆ·äº¤æ˜“** | **CTF Exchange** | è®¢å•ç°¿äº¤æ˜“ | åŒºå—é“¾ + Supabase |
| **6. å®æ—¶æ›´æ–°** | **Supabase Realtime** | æ¨é€ä»·æ ¼å˜åŒ– | Supabase |
| **7. å¸‚åœºè§£æ** | **UMAé¢„è¨€æœº** | è£å†³ç»“æœ | åŒºå—é“¾ |
| **8. é¢†å–å¥–é‡‘** | **Conditional Tokens** | èµå›ä»£å¸ | åŒºå—é“¾ |

---

## ğŸ“Š å¸‚åœºå¡ç‰‡çš„å…·ä½“å®ç°

### å½“å‰å®ç°

```typescript
// MarketCard.tsx
export function MarketCard({ market }) {
  // 1. å¸‚åœºåŸºæœ¬ä¿¡æ¯æ¥è‡ª propsï¼ˆä» markets è¡¨ï¼‰
  const { id, title, description, blockchain_status } = market;
  
  // 2. å®æ—¶ä»·æ ¼æ¥è‡ª orderbooks è¡¨
  const price = useMarketPrice(id, blockchain_status === 'created');
  
  // æ˜¾ç¤ºï¼š
  // - æ ‡é¢˜ã€æè¿° â†’ markets è¡¨
  // - æ¦‚ç‡ã€ä»·æ ¼ â†’ orderbooks è¡¨ï¼ˆé€šè¿‡APIï¼‰
  // - äº¤æ˜“é‡ â†’ orderbooks è¡¨ï¼ˆé€šè¿‡APIï¼‰
}
```

### éœ€è¦æ”¹è¿›çš„åœ°æ–¹

**ç›®å‰é—®é¢˜ï¼š**
- âŒ `useMarketPrice` ä½¿ç”¨ HTTP è½®è¯¢ï¼ˆ30ç§’ä¸€æ¬¡ï¼‰
- âŒ ä¸æ˜¯çœŸæ­£çš„å®æ—¶æ›´æ–°
- âŒ å¤šä¸ªå¡ç‰‡æ—¶ä¼šäº§ç”Ÿå¤§é‡è¯·æ±‚

**åº”è¯¥æ”¹ä¸ºï¼š**
- âœ… ä½¿ç”¨ Supabase Realtime
- âœ… è®¢é˜… orderbooks è¡¨å˜åŒ–
- âœ… æ‰¹é‡è®¢é˜…ä¼˜åŒ–æ€§èƒ½

---

## ğŸ”„ æ¨èçš„å®æ—¶æ›´æ–°æ–¹æ¡ˆ

### æ–¹æ¡ˆ Aï¼šå•å¡ç‰‡ä½¿ç”¨ï¼ˆè¯¦æƒ…é¡µï¼‰

```typescript
// ä½¿ç”¨ç°æœ‰çš„ useOrderBookRealtime
const { orderBook, connected } = useOrderBookRealtime(marketId);

// ä» orderBook è®¡ç®—ä»·æ ¼
const bestBid = orderBook?.bids[0]?.price || 0.49;
const bestAsk = orderBook?.asks[0]?.price || 0.51;
const probability = ((bestBid + bestAsk) / 2) * 100;
```

### æ–¹æ¡ˆ Bï¼šå¤šå¡ç‰‡æ‰¹é‡è®¢é˜…ï¼ˆåˆ—è¡¨é¡µï¼‰

```typescript
// ä½¿ç”¨æ‰¹é‡è®¢é˜… Hook
const { orderBooks, connected } = useMultipleOrderBooks(marketIds);

// ä¸ºæ¯ä¸ªå¸‚åœºè®¡ç®—ä»·æ ¼
marketIds.forEach(id => {
  const orderBook = orderBooks.get(id);
  const price = calculatePrice(orderBook);
});
```

---

## ğŸ¯ æ€»ç»“

### å¸‚åœºå¡ç‰‡çš„æ•°æ®æ¶æ„

**æ•°æ®åº“å±‚ï¼ˆSupabaseï¼‰ï¼š**
- `markets` è¡¨ â†’ å¸‚åœºå…ƒæ•°æ®
- `orderbooks` è¡¨ â†’ å®æ—¶ä»·æ ¼å’Œäº¤æ˜“é‡
- `market_states` è¡¨ â†’ æ¿€æ´»çŠ¶æ€

**åŒºå—é“¾å±‚ï¼ˆå®˜æ–¹ç»„ä»¶ï¼‰ï¼š**
- **UMA** â†’ å¸‚åœºåˆ›å»ºã€ç»“æœè£å†³
- **CTF Exchange** â†’ è®¢å•ç°¿äº¤æ˜“
- **Conditional Tokens** â†’ ä»£å¸æ ‡å‡†

**å±•ç¤ºå±‚ï¼ˆå‰ç«¯ï¼‰ï¼š**
- ä» Supabase è¯»å–æ•°æ®
- ä½¿ç”¨ Realtime å®æ—¶æ›´æ–°
- æ˜¾ç¤ºç»™ç”¨æˆ·

### å›ç­”æ‚¨çš„é—®é¢˜

**Q: å¸‚åœºå¡ç‰‡åº”è¯¥ä½¿ç”¨ä»€ä¹ˆç»„ä»¶ï¼Ÿ**

**A: ç»„åˆä½¿ç”¨ï¼**
- **æ•°æ®æ˜¾ç¤º** â†’ Supabase (markets + orderbooks)
- **å¸‚åœºåˆ›å»º** â†’ UMA é¢„è¨€æœº
- **äº¤æ˜“æ‰§è¡Œ** â†’ CTF Exchange
- **å®æ—¶æ›´æ–°** â†’ Supabase Realtime

**å¸‚åœºå¡ç‰‡æœ¬èº«ä¸ç›´æ¥è°ƒç”¨åŒºå—é“¾**ï¼Œè€Œæ˜¯ï¼š
1. æ˜¾ç¤º Supabase ä¸­çš„æ•°æ®
2. ä½¿ç”¨ Realtime è®¢é˜…æ›´æ–°
3. ç‚¹å‡»äº¤æ˜“æ—¶æ‰è°ƒç”¨ CTF Exchange

---

**ä¸‹ä¸€æ­¥ï¼šæˆ‘æ¥å¸®æ‚¨å‡çº§ `useMarketPrice` Hookï¼Œæ”¹ç”¨ Realtimeï¼**

è¿™æ ·å¸‚åœºå¡ç‰‡çš„æ¦‚ç‡å’Œäº¤æ˜“é‡éƒ½èƒ½å®æ—¶æ›´æ–°ã€‚

