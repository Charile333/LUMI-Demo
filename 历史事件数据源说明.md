# å†å²äº‹ä»¶æ•°æ®æºè¯´æ˜

## ğŸ“Š æ•°æ®æ¥æº

é»‘å¤©é¹…é¡µé¢æ˜¾ç¤ºçš„å†å²é—ªå´©äº‹ä»¶æ¥è‡ª**ä¸¤ä¸ªä¸åŒçš„æ•°æ®æº**ï¼š

### 1. ğŸ“ **é™æ€æ•°æ®**ï¼ˆä¸»è¦ä½¿ç”¨ï¼‰

#### ä½ç½®ï¼š
- `LUMI/app/api/alerts/real-crash-events/route.ts`ï¼ˆNext.js APIè·¯ç”±ï¼‰
- `LUMI/server.js` ç¬¬351-471è¡Œï¼ˆExpressæœåŠ¡å™¨ï¼‰

#### ç‰¹ç‚¹ï¼š
- âœ… **ç¡¬ç¼–ç åœ¨ä»£ç ä¸­**ï¼Œä¸ä¾èµ–æ•°æ®åº“
- âœ… **10ä¸ªçœŸå®çš„å†å²äº‹ä»¶**
- âœ… åŒ…å«è¯¦ç»†çš„ä»·æ ¼å’Œç™¾åˆ†æ¯”æ•°æ®
- âœ… æŒ‰æ—¶é—´å€’åºæ’åˆ—

#### åŒ…å«çš„äº‹ä»¶ï¼š
1. **2025-10-11** - åŠ å¯†è´§å¸é—ªå´© (-66%)
2. **2022-05-09** - LUNA/USTå´©ç›˜ (-99.99%)
3. **2022-11-09** - FTXå´©ç›˜ (-17%)
4. **2022-11-08** - FTTä»£å¸å´©ç›˜ (-80%)
5. **2020-03-12** - COVIDé»‘è‰²æ˜ŸæœŸå›› (-50%)
6. **2017-12-17** - 2017-2018ç†Šå¸‚ (-84%)
7. **2013-04-10** - Mt. Goxå´©ç›˜ (-43%)
8. **2011-06-19** - Mt. Goxé—ªå´© (-99.9%)

---

### 2. ğŸ“¦ **æ•°æ®åº“æ•°æ®**ï¼ˆå¤‡ç”¨ï¼‰

#### ä½ç½®ï¼š
- `LUMI/database/alerts.db`ï¼ˆSQLiteæ•°æ®åº“ï¼‰
- åŒ…å«200+æ¡å†å²é¢„è­¦è®°å½•

#### ç‰¹ç‚¹ï¼š
- âœ… å­˜å‚¨åœ¨SQLiteæ•°æ®åº“ä¸­
- âœ… æ”¯æŒå®æ—¶WebSocketæ¨é€
- âœ… å¯ä»¥é€šè¿‡ `/api/alerts` ç«¯ç‚¹è®¿é—®

#### æ•°æ®ç¤ºä¾‹ï¼š
```json
{
  "id": 199,
  "timestamp": "2025-10-11T02:00:00Z",
  "symbol": "BTCUSDT",
  "message": "é—ªå´©æœŸé—´è§¦å‘å¤§è§„æ¨¡æ æ†æ¸…ç®—ï¼Œ162ä¸‡è´¦æˆ·è¢«å¼ºåˆ¶å¹³ä»“",
  "severity": "critical",
  "details": {
    "liquidation_usd": 19100000000,
    "liquidated_accounts": 1620000,
    "market_impact": "extreme",
    "leverage_cascade": true
  },
  "type": "whale_transfer",
  "created_at": "2025-10-25 18:49:58"
}
```

---

## ğŸ” å½“å‰ä½¿ç”¨çš„æ•°æ®æº

### Next.js API è·¯ç”±ï¼ˆæ¨èç”¨äºç”Ÿäº§ï¼‰

```typescript
// LUMI/app/api/alerts/real-crash-events/route.ts

import { NextRequest, NextResponse } from 'next/server'

const crashEvents = [
  {
    id: 'crash-1',
    date: '2022-05-12',
    timestamp: '2022-05-12T00:00:00Z',
    asset: 'LUNA/USDT',
    crashPercentage: -99.9,
    duration: '3 days',
    description: 'Terra Luna collapse - algorithmic stablecoin failure',
    details: {
      previous_price: 85.0,
      current_price: 0.0001,
      price_change: -0.999
    }
  },
  // ... æ›´å¤šäº‹ä»¶
]

export async function GET(request: NextRequest) {
  return NextResponse.json({
    success: true,
    data: crashEvents
  })
}
```

### Express æœåŠ¡å™¨ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

```javascript
// LUMI/server.js

} else if (req.url === '/api/alerts/real-crash-events') {
  // è¿”å›çœŸå®çš„å†å²é—ªå´©äº‹ä»¶ï¼ˆä¸ä¾èµ–æ•°æ®åº“ï¼‰
  const realEvents = [
    {
      id: 'altcoins_2025-10-11',
      date: '2025-10-11',
      asset: 'ALTCOINS',
      crashPercentage: '-66.0',
      // ...
    },
    // ... æ›´å¤šäº‹ä»¶
  ];
  
  res.writeHead(200);
  res.end(JSON.stringify({ success: true, data: realEvents }));
}
```

---

## ğŸ“Š æ•°æ®ç»“æ„å¯¹æ¯”

### Next.js API è·¯ç”±æ•°æ®ç»“æ„

```typescript
interface CrashEvent {
  id: string;
  date: string;              // YYYY-MM-DD
  timestamp: string;          // ISO 8601
  asset: string;             // e.g., "LUNA/USDT"
  crashPercentage: number;    // -99.9
  duration: string;          // "3 days"
  description: string;       // è¯¦ç»†æè¿°
  details: {
    previous_price: number;
    current_price: number;
    price_change: number;    // -0.999
  }
}
```

### Express æœåŠ¡å™¨æ•°æ®ç»“æ„

```typescript
interface CrashEvent {
  id: string;
  date: string;
  asset: string;
  crashPercentage: string;    // "-66.0" (å­—ç¬¦ä¸²)
  duration: string;
  description: string;
  timestamp: string;
  details: {
    previous_price: number;
    current_price: number;
    price_change: number;
  }
}
```

**æ³¨æ„**: Expressç‰ˆæœ¬ä½¿ç”¨**å­—ç¬¦ä¸²**æ ¼å¼çš„ `crashPercentage`ï¼ˆå¦‚"-66.0"ï¼‰ï¼Œè€ŒNext.jsç‰ˆæœ¬ä½¿ç”¨**æ•°å­—**ï¼ˆå¦‚-66.0ï¼‰ã€‚

---

## ğŸ¯ å‰ç«¯å¦‚ä½•è·å–æ•°æ®

### é»‘å¤©é¹…é¡µé¢

```typescript
// LUMI/app/black-swan/page.tsx

const loadCrashEvents = async () => {
  try {
    // ä½¿ç”¨ç›¸å¯¹è·¯å¾„çš„ API
    const response = await fetch('/api/alerts/real-crash-events');
    const result = await response.json();
    
    if (result.success && result.data) {
      setCrashEvents(result.data);
      // è‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ªäº‹ä»¶
      if (result.data.length > 0 && !selectedEvent) {
        setSelectedEvent(result.data[0]);
      }
    }
  } catch (error) {
    console.error('åŠ è½½é—ªå´©äº‹ä»¶å¤±è´¥:', error);
  }
};
```

---

## ğŸ”„ æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é»‘å¤©é¹…é¡µé¢ (page.tsx)                           â”‚
â”‚                                                  â”‚
â”‚  useEffect(() => {                              â”‚
â”‚    fetch('/api/alerts/real-crash-events')       â”‚
â”‚  })                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Next.js API è·¯ç”±                               â”‚
â”‚  app/api/alerts/real-crash-events/route.ts      â”‚
â”‚                                                  â”‚
â”‚  const crashEvents = [ ... ]                    â”‚
â”‚  return NextResponse.json({ data: crashEvents })â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æˆ–è€…ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Express æœåŠ¡å™¨                                  â”‚
â”‚  server.js (ç¬¬351-471è¡Œ)                        â”‚
â”‚                                                  â”‚
â”‚  else if (req.url === '/api/alerts/real-...') { â”‚
â”‚    const realEvents = [ ... ]                   â”‚
â”‚    res.end(JSON.stringify({ data: realEvents }))â”‚
â”‚  }                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ å¦‚ä½•æ·»åŠ æ–°äº‹ä»¶

### æ–¹æ³•1ï¼šä¿®æ”¹Next.js APIè·¯ç”±ï¼ˆæ¨èï¼‰

ç¼–è¾‘ `LUMI/app/api/alerts/real-crash-events/route.ts`:

```typescript
const crashEvents = [
  {
    id: 'crash-11',
    date: '2024-12-15',
    timestamp: '2024-12-15T10:00:00Z',
    asset: 'BTC/USDT',
    crashPercentage: -35.5,
    duration: '6 hours',
    description: 'New crash event description',
    details: {
      previous_price: 45000,
      current_price: 29000,
      price_change: -0.355
    }
  },
  // ... ç°æœ‰äº‹ä»¶
]
```

### æ–¹æ³•2ï¼šä¿®æ”¹ExpressæœåŠ¡å™¨

ç¼–è¾‘ `LUMI/server.js`:

```javascript
const realEvents = [
  {
    id: 'new_event_2024-12-15',
    date: '2024-12-15',
    asset: 'BTC/USDT',
    crashPercentage: '-35.5',
    duration: '6h',
    description: 'æ–°çš„äº‹ä»¶æè¿°',
    timestamp: '2024-12-15T10:00:00Z',
    details: {
      previous_price: 45000,
      current_price: 29000,
      price_change: -35.5
    }
  },
  // ... ç°æœ‰äº‹ä»¶
]
```

---

## ğŸ—„ï¸ æ•°æ®åº“ç»“æ„ï¼ˆç”¨äºWebSocketå®æ—¶æ¨é€ï¼‰

### alerts è¡¨ç»“æ„

```sql
CREATE TABLE alerts (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  timestamp TEXT NOT NULL,           -- äº‹ä»¶æ—¶é—´ ISO 8601
  symbol TEXT NOT NULL,              -- äº¤æ˜“å¯¹ (BTCUSDT, ETHUSDT)
  message TEXT NOT NULL,             -- é¢„è­¦æ¶ˆæ¯
  severity TEXT,                     -- critical, high, medium
  details TEXT,                      -- JSONæ ¼å¼çš„è¯¦ç»†ä¿¡æ¯
  type TEXT,                         -- price_jump, whale_transfer, funding_spike
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### æŸ¥è¯¢ç¤ºä¾‹

```sql
-- è·å–æ‰€æœ‰criticalçº§é¢„è­¦
SELECT * FROM alerts 
WHERE severity = 'critical' 
ORDER BY timestamp DESC 
LIMIT 20;

-- ç»Ÿè®¡æŒ‰ä¸¥é‡ç¨‹åº¦åˆ†ç±»
SELECT severity, COUNT(*) as count 
FROM alerts 
GROUP BY severity;
```

---

## ğŸ¨ å‰ç«¯ä½¿ç”¨

### åœ¨Kçº¿å›¾ä¸­æ˜¾ç¤º

```typescript
// å½“ç”¨æˆ·ç‚¹å‡»äº‹ä»¶å¡ç‰‡æ—¶
const handleEventClick = (event) => {
  setSelectedEvent(event);
  
  // TradingViewå›¾è¡¨ä¼šè‡ªåŠ¨é‡æ–°åŠ è½½
  // ä½¿ç”¨äº‹ä»¶çš„æ—¶é—´æˆ³æ¥èšç„¦Kçº¿å›¾
  const eventTimestamp = new Date(event.timestamp).getTime();
  // ...
};
```

### äº¤æ˜“å¯¹æ˜ å°„

```typescript
// ä»äº‹ä»¶assetå­—æ®µæ¨æ–­äº¤æ˜“å¯¹
const assetToSymbol = {
  'LUNA/USDT': 'LUNAUSDT',
  'BTC/USDT': 'BTCUSDT',
  'ETH/USDT': 'ETHUSDT',
  'FTT/USDT': 'FTTUSDT',
};

const symbol = assetToSymbol[selectedEvent.asset] || 'BTCUSDT';
```

---

## ğŸ“‹ æ€»ç»“

| ç‰¹æ€§ | Next.js API | Express æœåŠ¡å™¨ | SQLite æ•°æ®åº“ |
|-----|------------|---------------|--------------|
| **æ•°æ®ç»“æ„** | TypeScript æ•°ç»„ | JavaScript æ•°ç»„ | SQL è¡¨ |
| **æ•°é‡** | 10ä¸ªäº‹ä»¶ | 8ä¸ªäº‹ä»¶ | 200+æ¡è®°å½• |
| **å®æ—¶æ›´æ–°** | âŒ éœ€è¦é‡å¯ | âŒ éœ€è¦é‡å¯ | âœ… WebSocketæ¨é€ |
| **ç”Ÿäº§éƒ¨ç½²** | âœ… æ¨è | âš ï¸ å¼€å‘ç”¨ | âœ… åç«¯å­˜å‚¨ |
| **ç»´æŠ¤** | ä¿®æ”¹ä»£ç  | ä¿®æ”¹ä»£ç  | SQLæ’å…¥ |
| **æ•°æ®ç±»å‹** | `crashPercentage: number` | `crashPercentage: string` | JSONå­—æ®µ |

---

## ğŸ’¡ å»ºè®®

### å½“å‰é¡¹ç›®ä½¿ç”¨

**æ¨èä½¿ç”¨ Next.js API è·¯ç”±**ï¼ˆ`app/api/alerts/real-crash-events/route.ts`ï¼‰ï¼Œå› ä¸ºï¼š
- âœ… ç±»å‹å®‰å…¨ï¼ˆTypeScriptï¼‰
- âœ… æ•°æ®ç»“æ„æ¸…æ™°ä¸€è‡´
- âœ… é€‚åˆç”Ÿäº§éƒ¨ç½²
- âœ… 10ä¸ªç²¾é€‰çš„çœŸå®å†å²äº‹ä»¶

### å¦‚æœéœ€è¦æ›´å¤šäº‹ä»¶

å¯ä»¥ä»æ•°æ®åº“ `alerts.db` ä¸­æå–ï¼š
```bash
# å¯¼å‡ºä¸ºJSON
sqlite3 database/alerts.db "SELECT * FROM alerts WHERE severity='critical' LIMIT 20;" > events.json
```

ç„¶åæ‰‹åŠ¨æ•´ç†åæ·»åŠ åˆ°Next.js APIè·¯ç”±ä¸­ã€‚

---

**æœ€åæ›´æ–°**: 2025-10-26  
**æ•°æ®æº**: é™æ€ä»£ç ï¼ˆä¸ä¾èµ–æ•°æ®åº“ï¼‰  
**æ–‡ä»¶ä½ç½®**: `LUMI/app/api/alerts/real-crash-events/route.ts`



