# 🧪 测试步骤 - 一步一步

> 按照这个清单逐步测试您的 Polymarket 系统

---

## ✅ 测试前准备

- [ ] 开发服务器正在运行 (`npm run dev`)
- [ ] 浏览器已打开
- [ ] MetaMask 已安装（如果要测试交易）

---

## 📋 第一阶段：基础功能测试（5分钟）

### ✅ 测试 1: 访问主页

**步骤**：
1. 打开浏览器
2. 访问 `http://localhost:3000`

**验证**：
- [ ] 页面正常加载
- [ ] 看到导航栏
- [ ] 没有错误信息
- [ ] 页面显示正常

**如果失败**：
- 检查服务器是否运行
- 查看控制台错误
- 清理浏览器缓存

---

### ✅ 测试 2: 浏览市场列表

**步骤**：
1. 访问 `http://localhost:3000/grid-market`
2. 等待页面加载

**验证**：
- [ ] 页面加载成功
- [ ] 可以看到市场分类标签
- [ ] 可以点击不同分类
- [ ] 有市场卡片显示（如果已创建市场）

**当前状态**：
- 链上市场数量：0 个
- 需要先创建测试市场

---

### ✅ 测试 3: 查看市场详情页面

**步骤**：
1. 如果有市场，点击任意市场卡片
2. 查看详情页

**验证**：
- [ ] 详情页可以打开
- [ ] 显示市场信息
- [ ] 显示价格图表
- [ ] 显示订单簿

**如果没有市场**：
- 继续下一步创建测试市场

---

## 📋 第二阶段：创建测试市场（10分钟）

### ✅ 测试 4: 访问管理后台

**步骤**：
1. 访问 `http://localhost:3000/_dev_only_admin/create-market`
2. 查看创建市场表单

**验证**：
- [ ] 表单正常显示
- [ ] 可以输入标题
- [ ] 可以输入描述
- [ ] 可以选择结算时间
- [ ] 可以设置奖励

---

### ✅ 测试 5: 创建一个简单的测试市场

**步骤**：

1. **填写市场信息**：
   ```
   标题: 测试市场 - Bitcoin 价格预测
   描述: 这是一个测试市场，用于验证系统功能
   问题: Will Bitcoin exceed $100k by end of 2024?
   ```

2. **设置参数**：
   ```
   结果类型: YES/NO (2个结果)
   结算时间: 选择 未来 1 小时后
   奖励代币: Mock USDC
   奖励金额: 100 USDC
   ```

3. **点击 "Create Market" 或 "Deploy to Blockchain"**

**验证**：
- [ ] 表单提交成功
- [ ] 显示处理中状态
- [ ] MetaMask 弹出（如果需要签名）

**预期结果**：
- 市场创建成功
- 显示 questionId
- 可以查看交易哈希

---

### ✅ 测试 6: 验证市场已创建

**步骤**：
1. 返回市场列表 `http://localhost:3000/grid-market`
2. 刷新页面
3. 查找刚创建的市场

**验证**：
- [ ] 新市场出现在列表中
- [ ] 市场信息正确显示
- [ ] 可以点击进入详情

**运行验证脚本**：
```bash
npx hardhat run scripts/uma-oracle-test.js --network amoy
```

应该显示：`链上市场数量: 1` ✅

---

## 📋 第三阶段：钱包和交易测试（可选，15分钟）

### ✅ 测试 7: 连接钱包

**前提**：安装 MetaMask 扩展

**步骤**：
1. 点击页面上的 "Connect Wallet"
2. 选择 MetaMask
3. 确认连接

**验证**：
- [ ] 钱包成功连接
- [ ] 显示钱包地址
- [ ] 显示余额

---

### ✅ 测试 8: 添加 Polygon Amoy 网络

**步骤**：
1. 打开 MetaMask
2. 点击网络下拉菜单
3. 点击 "添加网络"
4. 点击 "手动添加网络"

**填入配置**：
```
网络名称: Polygon Amoy Testnet
RPC URL: https://polygon-amoy-bor-rpc.publicnode.com
Chain ID: 80002
货币符号: POL
区块浏览器: https://amoy.polygonscan.com
```

5. 点击保存
6. 切换到 Polygon Amoy 网络

**验证**：
- [ ] 网络添加成功
- [ ] MetaMask 显示 Polygon Amoy
- [ ] 可以看到 POL 余额

---

### ✅ 测试 9: 获取测试 USDC

**步骤**：

如果您的钱包地址是创建的测试钱包：
```
地址: 0xaa22D02aA0C31cF4140d54284B249cDb651107aB
```

**使用 Hardhat 脚本铸造 Mock USDC**：

```bash
npx hardhat console --network amoy
```

然后在 Hardhat 控制台中：
```javascript
const MockUSDC = await ethers.getContractFactory("MockUSDC");
const usdc = MockUSDC.attach("0x8d2dae90Dbc51dF7E18C1b857544AC979F87a77a");

// 铸造 10,000 USDC 到您的地址
await usdc.mint("YOUR_WALLET_ADDRESS", ethers.utils.parseUnits("10000", 6));
```

**验证**：
- [ ] 交易成功
- [ ] 可以在 MetaMask 中看到 USDC 余额

---

### ✅ 测试 10: 查看订单簿（如果有市场）

**步骤**：
1. 进入任意市场详情页
2. 查看订单簿区域

**验证**：
- [ ] 订单簿显示正常
- [ ] 显示买单（绿色）
- [ ] 显示卖单（红色）
- [ ] 价格和数量清晰

---

## 📋 第四阶段：UMA 预言机测试（高级，2小时+）

### ✅ 测试 11: 验证 UMA 预言机配置

**运行测试脚本**：
```bash
npx hardhat run scripts/uma-oracle-test.js --network amoy
```

**查看输出**：
```
✅ 账户配置正常
✅ 适配器工作正常
✅ 可以查询市场
✅ UMA Oracle 流程说明
```

**验证**：
- [ ] 脚本运行成功
- [ ] 显示正确的合约地址
- [ ] 显示账户信息
- [ ] 显示市场数量

---

### ✅ 测试 12: 创建短期测试市场

**为了快速测试 UMA 预言机，创建一个1小时后到期的市场**：

**步骤**：
1. 访问管理后台
2. 创建新市场：
   ```
   标题: UMA 预言机快速测试
   描述: 1小时后到期的测试市场
   结算时间: 当前时间 + 1小时
   奖励: 10 USDC
   ```
3. 部署到链上
4. 记录 questionId

**验证**：
- [ ] 市场创建成功
- [ ] 获得 questionId
- [ ] 可以在链上查询

---

### ✅ 测试 13: 等待市场到期并观察 UMA 流程

**步骤**：

1. **等待市场到期** (1小时后)

2. **请求 UMA 预言机价格**：
   - 方法1: 通过管理后台的结算功能
   - 方法2: 使用 Hardhat 脚本

3. **观察挑战期**：
   - 默认 2 小时
   - 任何人可以提出争议
   - 访问区块链浏览器查看状态

4. **等待结算**：
   - 无争议：2小时后自动确定
   - 有争议：UMA代币持有者投票

**验证**：
- [ ] 可以请求预言机价格
- [ ] 挑战期开始计时
- [ ] 可以查看提案状态
- [ ] 最终可以结算

**查看预言机活动**：
```
https://amoy.polygonscan.com/address/0x263351499f82C107e540B01F0Ca959843e22464a
```

---

## 📋 第五阶段：系统验证测试

### ✅ 测试 14: 查看区块链浏览器

**访问您部署的合约**：

1. **RealUmaCTFAdapter**：
   ```
   https://amoy.polygonscan.com/address/0xaBf0e29946C63fa1920E00bEA95dDADeF70FD80C
   ```
   
   验证：
   - [ ] 合约存在
   - [ ] 有交易记录
   - [ ] 可以查看代码

2. **UMA Oracle（官方）**：
   ```
   https://amoy.polygonscan.com/address/0x263351499f82C107e540B01F0Ca959843e22464a
   ```
   
   验证：
   - [ ] 显示为 `OptimisticOracleV2`
   - [ ] 有大量交易历史
   - [ ] 是 UMA 官方部署

3. **CTF Exchange（官方）**：
   ```
   https://amoy.polygonscan.com/address/0xdFE02Eb6733538f8Ea35D585af8DE5958AD99E40
   ```
   
   验证：
   - [ ] 显示为 `CTFExchange`
   - [ ] 是 Polymarket 官方部署
   - [ ] 已验证源代码

---

### ✅ 测试 15: 检查配置文件

**验证所有配置已更新**：

```bash
# 查看部署配置
cat deployments/amoy-complete-polymarket.json

# 查看系统配置
cat POLYMARKET_SYSTEM_CONFIG.md

# 查看快速参考
cat 快速参考-Polymarket系统.md
```

**验证**：
- [ ] 显示正确的合约地址
- [ ] UMA Oracle: 0x2633...464a
- [ ] CTF Exchange: 0xdFE0...9E40
- [ ] RealUmaCTFAdapter: 0xaBf0...D80C

---

## 🚀 简化版测试（快速验证，2分钟）

如果您只想快速验证系统是否工作：

### 快速测试清单 ⚡

```bash
# 1. 测试预言机连接
npx hardhat run scripts/uma-oracle-test.js --network amoy

# 2. 访问应用
# 打开浏览器: http://localhost:3000

# 3. 访问市场列表
# http://localhost:3000/grid-market

# 4. 访问管理后台
# http://localhost:3000/_dev_only_admin/create-market
```

**如果以上都正常**，说明系统工作正常！✅

---

## 🎯 推荐的测试顺序

### 新手推荐（从简单到复杂）

```
1️⃣  访问主页 (2分钟)
   ↓
2️⃣  浏览市场列表 (3分钟)
   ↓
3️⃣  访问管理后台 (2分钟)
   ↓
4️⃣  创建测试市场 (5分钟)
   ↓
5️⃣  验证市场已创建 (3分钟)
   ↓
6️⃣  连接钱包（可选）(5分钟)
   ↓
7️⃣  测试交易（可选）(10分钟)
   ↓
8️⃣  测试 UMA 预言机（高级）(2小时+)
```

---

## 🔍 每个测试的详细步骤

### 🧪 测试 1: 访问主页

**操作**：
```
1. 打开 Chrome 或其他浏览器
2. 在地址栏输入: http://localhost:3000
3. 按 Enter
```

**预期结果**：
```
✅ 页面加载
✅ 显示 "LegitChain" 或项目名称
✅ 有导航栏
✅ 没有错误提示
```

**如果失败**：
```bash
# 检查服务器
# 打开新终端运行:
npm run dev
```

---

### 🧪 测试 2: 浏览市场列表

**操作**：
```
1. 点击导航栏的 "Markets" 或直接访问
   http://localhost:3000/grid-market

2. 等待页面加载（约2-3秒）

3. 查看页面内容
```

**预期结果**：
```
✅ 页面显示市场分类标签
   - Automotive
   - Tech & AI
   - Entertainment
   - 等等...

✅ 显示 "当前没有市场" 或市场卡片列表

✅ 页面布局正常
```

**截图示例**：
页面应该类似于 Polymarket 的市场列表页面。

---

### 🧪 测试 3: 创建测试市场

**操作**：

**步骤 1**: 访问管理后台
```
http://localhost:3000/_dev_only_admin/create-market
```

**步骤 2**: 填写表单
```
标题:     Bitcoin 价格测试
描述:     测试市场 - Will Bitcoin exceed $100k?
分类:     economy-social
结算时间:  选择未来1小时
奖励:     100 USDC
```

**步骤 3**: 提交创建
- 点击 "Create" 或 "Deploy" 按钮
- 如果弹出 MetaMask，确认交易
- 等待交易确认（约10-30秒）

**预期结果**：
```
✅ 显示 "市场创建成功"
✅ 显示 questionId（一串字符）
✅ 显示交易哈希
✅ 可以在区块链浏览器查看
```

---

### 🧪 测试 4: 验证市场已上链

**运行验证脚本**：
```bash
npx hardhat run scripts/uma-oracle-test.js --network amoy
```

**查看输出**：
```
链上市场数量: 1  ← 应该从 0 变成 1
✅ 有现有市场
```

**在浏览器查看**：
```
1. 刷新市场列表页面
2. 应该看到新创建的市场卡片
3. 点击卡片进入详情
```

---

## 🎓 高级测试（可选）

### 🧪 测试 5: UMA 预言机完整流程

**这个测试需要约 2-3 小时**

**步骤**：

1. **创建短期市场**（1小时后到期）

2. **等待市场到期**

3. **请求预言机价格**
   ```bash
   # 使用 Hardhat 控制台
   npx hardhat console --network amoy
   
   # 在控制台中：
   const adapter = await ethers.getContractAt("RealUmaCTFAdapter", "0xaBf0e29946C63fa1920E00bEA95dDADeF70FD80C");
   await adapter.requestOraclePrice(questionId);
   ```

4. **观察挑战期**（2小时）
   - 访问 UMA Oracle 合约查看状态
   - 观察是否有提案
   - 观察是否有争议

5. **结算市场**
   ```bash
   await adapter.resolve(questionId);
   ```

**预期结果**：
```
✅ 价格请求成功
✅ 挑战期开始
✅ 2小时后可以结算
✅ 市场状态变为 "已结算"
```

---

## 🐛 常见问题和解决方案

### 问题 1: 页面 404 错误

**解决**：
```bash
# 清理缓存
Remove-Item -Path .next -Recurse -Force
npm run dev
```

### 问题 2: "链上市场数量: 0"

**原因**: 还没创建市场

**解决**: 
- 访问管理后台创建测试市场

### 问题 3: MetaMask 未弹出

**解决**：
- 检查 MetaMask 是否已安装
- 检查网络是否正确
- 刷新页面重试

### 问题 4: 交易失败

**检查**：
- Gas 费用是否足够
- 账户余额是否足够
- 网络是否稳定

---

## ✅ 最简单的测试流程（1分钟）

如果只想快速验证系统工作：

```bash
# 1. 运行测试脚本
npx hardhat run scripts/uma-oracle-test.js --network amoy

# 2. 打开浏览器访问
# http://localhost:3000

# 3. 访问管理后台
# http://localhost:3000/_dev_only_admin/create-market
```

**如果以上3步都成功**，系统就是正常的！✅

---

## 📊 测试完成标准

### 基础测试完成

- [ ] 可以访问主页
- [ ] 可以访问市场列表
- [ ] 可以访问管理后台
- [ ] UMA 测试脚本运行成功

### 中级测试完成

- [ ] 创建了测试市场
- [ ] 市场显示在列表中
- [ ] 可以查看市场详情
- [ ] 链上验证成功

### 高级测试完成

- [ ] 连接了钱包
- [ ] 测试了交易功能
- [ ] 完成了 UMA 预言机流程
- [ ] 市场结算成功

---

## 🎉 测试建议

### 今天立即测试（基础）

```
1. 访问主页 ✅
2. 访问市场列表 ✅
3. 访问管理后台 ✅
4. 运行测试脚本 ✅
```

**时间**: 5 分钟

### 明天或稍后测试（完整）

```
1. 创建测试市场
2. 验证市场显示
3. 测试钱包连接
4. 测试交易功能
5. 测试 UMA 预言机（需要等待2小时）
```

**时间**: 3 小时

---

## 📚 参考文档

- **UMA预言机测试指南.md** - 详细测试步骤
- **快速参考-Polymarket系统.md** - 一页纸参考
- **UMA协议集成完成.md** - 集成说明
- **系统部署完成-最终总结.md** - 总体概览

---

## 🚀 开始测试

**推荐从这里开始**：

```
1. 运行测试脚本验证系统
2. 访问主页查看界面
3. 创建一个测试市场
4. 观察市场是否正常显示
```

**有问题就告诉我！我会帮您解决！** 🤝

---

**祝测试顺利！** ✨





