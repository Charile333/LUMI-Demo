# ğŸ” é“¾ä¸Šäº¤æ˜“æµ‹è¯•æŒ‡å—

## ğŸ“‹ ç›®å½•

1. [æ£€æŸ¥å¸‚åœºä¸Šé“¾çŠ¶æ€](#æ£€æŸ¥å¸‚åœºä¸Šé“¾çŠ¶æ€)
2. [æµ‹è¯•é“¾ä¸Šäº¤æ˜“æµç¨‹](#æµ‹è¯•é“¾ä¸Šäº¤æ˜“æµç¨‹)
3. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ğŸ” æ£€æŸ¥å¸‚åœºä¸Šé“¾çŠ¶æ€

### æ­¥éª¤1ï¼šè¿è¡Œæ£€æŸ¥è„šæœ¬

```bash
node scripts/check-market-blockchain-status.js
```

### æ­¥éª¤2ï¼šæŸ¥çœ‹ç»“æœ

è„šæœ¬ä¼šæ˜¾ç¤ºï¼š
- âœ… **å·²ä¸Šé“¾çš„å¸‚åœº**ï¼šæœ‰ `condition_id` ä¸” `blockchain_status = 'created'`
- â³ **ä¸Šé“¾ä¸­çš„å¸‚åœº**ï¼š`blockchain_status = 'creating'`
- âŒ **ä¸Šé“¾å¤±è´¥çš„å¸‚åœº**ï¼š`blockchain_status = 'failed'`
- âš ï¸ **æœªä¸Šé“¾çš„å¸‚åœº**ï¼šæ²¡æœ‰ `condition_id` æˆ– `blockchain_status = 'not_created'`

### æ­¥éª¤3ï¼šæ£€æŸ¥å¸‚åœºæ•°æ®

å¦‚æœå¸‚åœºæœªä¸Šé“¾ï¼Œéœ€è¦ï¼š
1. ç¡®ä¿å¸‚åœºæœ‰ `question_id`ï¼ˆé“¾ä¸Šé—®é¢˜IDï¼‰
2. è°ƒç”¨å¸‚åœºæ¿€æ´»APIä¸Šé“¾
3. ç­‰å¾… `condition_id` ç”Ÿæˆ

---

## ğŸ§ª æµ‹è¯•é“¾ä¸Šäº¤æ˜“æµç¨‹

### æ­¥éª¤1ï¼šè¿è¡Œæµ‹è¯•è„šæœ¬

```bash
node scripts/test-onchain-trading.js
```

### æ­¥éª¤2ï¼šå‰ç«¯æµ‹è¯•

#### 2.1 è®¿é—®å¸‚åœºé¡µé¢

```
http://localhost:3000/markets/automotive
```

#### 2.2 æ‰¾åˆ°å·²ä¸Šé“¾çš„å¸‚åœº

- å¸‚åœºå¡ç‰‡ä¸Šä¼šæ˜¾ç¤º"ğŸŸ¢ äº¤æ˜“ä¸­"çŠ¶æ€
- ç‚¹å‡»å¸‚åœºå¡ç‰‡æŸ¥çœ‹è¯¦æƒ…

#### 2.3 åˆ›å»ºè®¢å•

1. ç‚¹å‡»"å¿«é€Ÿäº¤æ˜“"æŒ‰é’®
2. è¿æ¥é’±åŒ…ï¼ˆMetaMaskç­‰ï¼‰
3. ç¡®ä¿é’±åŒ…è¿æ¥åˆ° **Polygon Amoy** ç½‘ç»œï¼ˆChain ID: 80002ï¼‰
4. é€‰æ‹©"YES"æˆ–"NO"
5. è¾“å…¥é‡‘é¢å’Œä»·æ ¼
6. ç‚¹å‡»"æäº¤è®¢å•"

#### 2.4 æ£€æŸ¥è®¢å•æ’®åˆ

- å¦‚æœè®¢å•æ’®åˆæˆåŠŸï¼Œä¼šæ˜¾ç¤º"âœ… è®¢å•å·²æ’®åˆï¼"
- å¦‚æœæœ‰é“¾ä¸Šæ‰§è¡Œæ•°æ®ï¼Œä¼šæ˜¾ç¤º"æ‰§è¡Œé“¾ä¸Šäº¤æ˜“"æŒ‰é’®

#### 2.5 æ‰§è¡Œé“¾ä¸Šäº¤æ˜“

1. ç‚¹å‡»"æ‰§è¡Œé“¾ä¸Šäº¤æ˜“"æŒ‰é’®
2. ç¡®è®¤äº¤æ˜“è¯¦æƒ…
3. æ”¯ä»˜Gasè´¹
4. ç­‰å¾…é“¾ä¸Šç¡®è®¤

#### 2.6 æ£€æŸ¥äº¤æ˜“ç»“æœ

- æ£€æŸ¥è®¢å•çŠ¶æ€æ˜¯å¦æ›´æ–°ä¸º `filled`
- æ£€æŸ¥é“¾ä¸Šäº¤æ˜“æ˜¯å¦æˆåŠŸ
- æ£€æŸ¥èµ„äº§æ˜¯å¦è½¬ç§»

### æ­¥éª¤3ï¼šAPIæµ‹è¯•

#### 3.1 åˆ›å»ºè®¢å•

```bash
curl -X POST http://localhost:3000/api/orders/create \
  -H "Content-Type: application/json" \
  -d '{
    "marketId": 1,
    "maker": "0x...",
    "side": "buy",
    "outcome": 1,
    "price": "0.5",
    "amount": "100",
    "orderId": "order-123",
    "signature": "0x...",
    "salt": "0x...",
    "nonce": 1234567890,
    "expiration": 1234567890
  }'
```

#### 3.2 è·å–è®¢å•ç­¾å

```bash
curl http://localhost:3000/api/orders/1/signature
```

#### 3.3 æ‰§è¡Œé“¾ä¸Šäº¤æ˜“

```bash
curl -X POST http://localhost:3000/api/orders/execute-onchain \
  -H "Content-Type: application/json" \
  -d '{
    "ctfOrder": {...},
    "makerSignature": "0x...",
    "fillAmount": "100"
  }'
```

### æ­¥éª¤4ï¼šæ•°æ®åº“æµ‹è¯•

#### 4.1 æ£€æŸ¥è®¢å•è¡¨

```sql
SELECT 
  id,
  market_id,
  user_address,
  side,
  outcome,
  price,
  quantity,
  status,
  signature,
  condition_id,
  ctf_signature,
  ctf_order_data
FROM orders
WHERE market_id = 1
ORDER BY created_at DESC
LIMIT 10;
```

#### 4.2 æ£€æŸ¥å¸‚åœºè¡¨

```sql
SELECT 
  id,
  title,
  condition_id,
  blockchain_status,
  question_id
FROM markets
WHERE blockchain_status = 'created'
LIMIT 10;
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: å¸‚åœºæœªä¸Šé“¾æ€ä¹ˆåŠï¼Ÿ

**A:** éœ€è¦å…ˆæ¿€æ´»å¸‚åœºä¸Šé“¾ï¼š

1. **ä½¿ç”¨APIæ¿€æ´»**ï¼š
   ```bash
   curl -X POST http://localhost:3000/api/markets/1/activate
   ```

2. **æ‰‹åŠ¨ä¸Šé“¾**ï¼š
   - è¿æ¥é’±åŒ…
   - è°ƒç”¨æ™ºèƒ½åˆçº¦ `prepareCondition()`
   - è·å– `condition_id`
   - æ›´æ–°æ•°æ®åº“

3. **æ£€æŸ¥æ¿€æ´»çŠ¶æ€**ï¼š
   ```bash
   node scripts/check-market-blockchain-status.js
   ```

### Q2: è®¢å•æ’®åˆæˆåŠŸä½†æ²¡æœ‰é“¾ä¸Šæ‰§è¡ŒæŒ‰é’®ï¼Ÿ

**A:** å¯èƒ½åŸå› ï¼š

1. **å¸‚åœºæ²¡æœ‰ `condition_id`**ï¼š
   - æ£€æŸ¥å¸‚åœºæ˜¯å¦å·²ä¸Šé“¾
   - è¿è¡Œ `check-market-blockchain-status.js` æ£€æŸ¥

2. **è®¢å•æ²¡æœ‰ CTF ç­¾å**ï¼š
   - æ£€æŸ¥è®¢å•çš„ `ctf_signature` å­—æ®µ
   - å¦‚æœæ˜¯ Makerï¼Œéœ€è¦é‡æ–°ç­¾å

3. **APIè¿”å›é”™è¯¯**ï¼š
   - æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°
   - æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—

### Q3: é“¾ä¸Šæ‰§è¡Œå¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A:** æ£€æŸ¥ä»¥ä¸‹å†…å®¹ï¼š

1. **é’±åŒ…è¿æ¥**ï¼š
   - ç¡®ä¿é’±åŒ…å·²è¿æ¥
   - ç¡®ä¿é’±åŒ…è¿æ¥åˆ°æ­£ç¡®çš„ç½‘ç»œï¼ˆPolygon Amoyï¼‰

2. **Gasè´¹**ï¼š
   - ç¡®ä¿é’±åŒ…æœ‰è¶³å¤Ÿçš„Gasè´¹
   - æ£€æŸ¥Gasä»·æ ¼æ˜¯å¦åˆç†

3. **è®¢å•ç­¾å**ï¼š
   - æ£€æŸ¥è®¢å•çš„ `ctf_signature` æ˜¯å¦æ­£ç¡®
   - æ£€æŸ¥ Maker æ˜¯å¦å·²ç­¾å

4. **æ™ºèƒ½åˆçº¦**ï¼š
   - æ£€æŸ¥ CTF Exchange åˆçº¦åœ°å€æ˜¯å¦æ­£ç¡®
   - æ£€æŸ¥åˆçº¦æ˜¯å¦å·²éƒ¨ç½²

### Q4: æ•°æ®åº“è¿ç§»å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A:** æ‰‹åŠ¨æ‰§è¡ŒSQLï¼š

1. **è¿æ¥åˆ° Supabase Dashboard**ï¼š
   - æ‰“å¼€ Supabase Dashboard
   - è¿›å…¥ SQL Editor
   - è¿è¡Œ `database/add-orders-ctf-columns.sql`

2. **æ£€æŸ¥å­—æ®µ**ï¼š
   ```sql
   SELECT column_name
   FROM information_schema.columns
   WHERE table_name = 'orders'
     AND column_name IN ('condition_id', 'ctf_signature', 'ctf_order_data');
   ```

### Q5: å¦‚ä½•æµ‹è¯•ä¸¤ä¸ªç”¨æˆ·ä¹‹é—´çš„äº¤æ˜“ï¼Ÿ

**A:** æµ‹è¯•æ­¥éª¤ï¼š

1. **ç”¨æˆ·Aåˆ›å»ºä¹°å•**ï¼š
   - ä½¿ç”¨é’±åŒ…Aè¿æ¥
   - åˆ›å»ºä¹°å•ï¼ˆYESï¼Œä»·æ ¼0.5ï¼‰

2. **ç”¨æˆ·Båˆ›å»ºå–å•**ï¼š
   - ä½¿ç”¨é’±åŒ…Bè¿æ¥
   - åˆ›å»ºå–å•ï¼ˆYESï¼Œä»·æ ¼0.5ï¼‰

3. **æ£€æŸ¥æ’®åˆ**ï¼š
   - æ£€æŸ¥è®¢å•æ˜¯å¦æ’®åˆæˆåŠŸ
   - æ£€æŸ¥æ˜¯å¦éœ€è¦é“¾ä¸Šæ‰§è¡Œ

4. **æ‰§è¡Œé“¾ä¸Šäº¤æ˜“**ï¼š
   - ç”¨æˆ·Aæˆ–ç”¨æˆ·Bæ‰§è¡Œé“¾ä¸Šäº¤æ˜“
   - æ£€æŸ¥èµ„äº§æ˜¯å¦è½¬ç§»

---

## ğŸ“ æµ‹è¯•æ¸…å•

- [ ] è¿è¡Œ `check-market-blockchain-status.js` æ£€æŸ¥å¸‚åœºä¸Šé“¾çŠ¶æ€
- [ ] è¿è¡Œ `test-onchain-trading.js` æ£€æŸ¥æµ‹è¯•å‡†å¤‡
- [ ] ç¡®ä¿æ•°æ®åº“è¿ç§»å®Œæˆï¼ˆ`add-orders-ctf-columns.sql`ï¼‰
- [ ] ç¡®ä¿è‡³å°‘æœ‰ä¸€ä¸ªå¸‚åœºå·²ä¸Šé“¾ï¼ˆæœ‰ `condition_id`ï¼‰
- [ ] æµ‹è¯•å‰ç«¯è®¢å•åˆ›å»ºæµç¨‹
- [ ] æµ‹è¯•è®¢å•æ’®åˆæµç¨‹
- [ ] æµ‹è¯•é“¾ä¸Šæ‰§è¡Œæµç¨‹
- [ ] æµ‹è¯•ä¸¤ä¸ªç”¨æˆ·ä¹‹é—´çš„äº¤æ˜“
- [ ] æ£€æŸ¥æ•°æ®åº“è®¢å•æ•°æ®
- [ ] æ£€æŸ¥é“¾ä¸Šäº¤æ˜“è®°å½•

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [é“¾ä¸Šäº¤æ˜“æ–¹æ¡ˆå¯¹æ¯”](./é“¾ä¸Šäº¤æ˜“æ–¹æ¡ˆå¯¹æ¯”.md)
- [è®¢å•ç³»ç»Ÿæ–‡æ¡£](./ORDER_SYSTEM.md)
- [CTF Exchange é›†æˆæ–‡æ¡£](./CTF_EXCHANGE.md)

---

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š
1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°
2. æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—
3. è¿è¡Œæµ‹è¯•è„šæœ¬
4. æŸ¥çœ‹ç›¸å…³æ–‡æ¡£

