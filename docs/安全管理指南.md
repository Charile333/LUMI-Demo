# 🔐 管理后台安全管理指南

## ✅ 已实施的安全措施

### 1. 登录尝试限制
- **最大尝试次数**：5 次
- **锁定时间**：15 分钟
- **时间窗口**：1 分钟内的尝试计数

### 2. IP 锁定机制
- 超过最大尝试次数后，IP 会被锁定 15 分钟
- 锁定期间无法登录
- 锁定时间过后自动解除

### 3. 安全的认证 Token
- 使用时间戳 + 随机字符串生成 token
- Token 包含 secret 验证
- Token 有效期：24 小时
- Token 格式：Base64 编码

### 4. 安全的 Cookie 设置
- `httpOnly: true` - 防止 XSS 攻击
- `secure: true` - 生产环境仅通过 HTTPS 传输
- `sameSite: 'strict'` - 防止 CSRF 攻击
- `path: '/admin'` - 限制 cookie 路径
- 有效期：24 小时（缩短有效期）

### 5. 登录日志记录
- 记录所有登录尝试（成功/失败）
- 记录 IP 地址
- 记录时间戳
- 记录失败原因

### 6. 中间件保护
- 所有 `/admin/*` 路径受保护
- 所有 `/api/admin/*` 路径受保护
- 自动验证认证 token
- 自动检查 IP 锁定状态

## 🔒 安全配置

### 环境变量

在 Vercel 中配置以下环境变量：

```env
# 管理员密码（必填）
ADMIN_PASSWORD=your_secure_password_here

# 认证 Secret（可选，用于增强 token 安全性）
ADMIN_AUTH_SECRET=your_auth_secret_here
```

### 密码要求

**生产环境密码要求**：
- 至少 12 个字符
- 包含大小写字母、数字、特殊字符
- 不要使用常见密码
- 定期更换密码

### Secret 配置

**ADMIN_AUTH_SECRET**（可选）：
- 用于增强 token 安全性
- 建议使用随机生成的字符串
- 至少 32 个字符
- 不要提交到 Git

## 🚨 安全建议

### 1. 使用强密码

**推荐密码生成工具**：
- 使用密码管理器（如 1Password, LastPass）
- 使用随机密码生成器
- 避免使用常见密码

### 2. 定期更换密码

- 建议每 3 个月更换一次密码
- 如果发现可疑活动，立即更换密码

### 3. 限制访问

- 只允许信任的 IP 地址访问（可选）
- 使用 VPN 访问管理后台
- 不要在公共网络上访问

### 4. 监控登录日志

- 定期检查登录日志
- 发现可疑活动立即采取行动
- 监控失败登录尝试

### 5. 使用 HTTPS

- 生产环境必须使用 HTTPS
- 不要在生产环境使用 HTTP
- 配置 SSL 证书

## ⚠️ 安全警告

### 1. 不要暴露密码

- 不要将密码写在代码中
- 不要将密码提交到 Git
- 不要将密码发送给他人
- 不要在不安全的地方存储密码

### 2. 不要使用默认密码

- 生产环境必须修改默认密码
- 不要使用 `admin123` 等简单密码
- 使用强密码

### 3. 不要共享账号

- 每个管理员使用独立的账号
- 不要共享密码
- 使用个人账号登录

### 4. 及时登出

- 使用完毕后及时登出
- 不要在公共计算机上保持登录状态
- 清除浏览器缓存

## 🔍 安全检查清单

- [ ] 配置了 `ADMIN_PASSWORD` 环境变量
- [ ] 使用了强密码（至少 12 个字符）
- [ ] 配置了 `ADMIN_AUTH_SECRET`（可选）
- [ ] 生产环境使用了 HTTPS
- [ ] 定期检查登录日志
- [ ] 定期更换密码
- [ ] 限制了访问 IP（可选）
- [ ] 监控失败登录尝试
- [ ] 及时登出
- [ ] 不要在公共网络上访问

## 📝 日志记录

### 登录日志格式

```
[时间戳] [状态] IP: [IP地址] Reason: [原因]
```

### 日志示例

```
[2024-01-01T12:00:00.000Z] [SUCCESS] IP: 192.168.1.1
[2024-01-01T12:00:05.000Z] [FAILED] IP: 192.168.1.2 Reason: 密码错误
[2024-01-01T12:00:10.000Z] [FAILED] IP: 192.168.1.2 Reason: IP被锁定（过多失败尝试）
```

## 🔗 相关文档

- [管理员访问指南](./ADMIN_ACCESS_GUIDE.md)
- [管理后台访问路径](./管理后台访问路径.md)
- [激活市场指南](./激活市场指南.md)

