# ğŸš€ LUMI é“¾ä¸Šäº¤æ˜“æ–¹æ¡ˆå¯¹æ¯”

## ğŸ“‹ æ–¹æ¡ˆæ¦‚è§ˆ

| æ–¹æ¡ˆ | å®ç°éš¾åº¦ | Gasæˆæœ¬ | å»ä¸­å¿ƒåŒ–ç¨‹åº¦ | ç”¨æˆ·ä½“éªŒ | æ¨èæŒ‡æ•° |
|------|---------|---------|------------|---------|---------|
| **æ–¹æ¡ˆ1: ç›´æ¥ä½¿ç”¨CTF Exchange** | â­â­ | ä¸­ç­‰ | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ |
| **æ–¹æ¡ˆ2: æ··åˆæ¨¡å¼ï¼ˆæ¨èï¼‰** | â­â­â­ | ä½ | â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ |
| **æ–¹æ¡ˆ3: è‡ªå»ºæ’®åˆåˆçº¦** | â­â­â­â­â­ | é«˜ | â­â­â­â­â­ | â­â­â­ | â­â­â­ |
| **æ–¹æ¡ˆ4: AMMè‡ªåŠ¨åšå¸‚** | â­â­â­â­ | ä¸­ç­‰ | â­â­â­â­ | â­â­â­â­ | â­â­â­ |

---

## ğŸ¯ æ–¹æ¡ˆ1: ç›´æ¥ä½¿ç”¨ Polymarket CTF Exchangeï¼ˆæœ€ç®€å•ï¼‰

### æ ¸å¿ƒæ€è·¯
ç›´æ¥ä½¿ç”¨å·²éƒ¨ç½²çš„ CTF Exchange åˆçº¦ï¼Œè®¢å•å®Œå…¨ä¸Šé“¾ï¼Œåˆ©ç”¨ç°æœ‰çš„é“¾ä¸ŠæµåŠ¨æ€§ã€‚

### æŠ€æœ¯æ¶æ„
```
ç”¨æˆ·ä¸‹å•
    â†“
ç­¾åè®¢å•ï¼ˆEIP-712ï¼‰
    â†“
æäº¤åˆ° CTF Exchange åˆçº¦
    â”œâ”€ fillOrder() - ç«‹å³æ’®åˆ
    â””â”€ æˆ–æŒ‚å•ç­‰å¾…æ’®åˆ
    â†“
Conditional Tokens è‡ªåŠ¨è½¬è´¦
    â†“
é“¾ä¸Šæˆäº¤è®°å½•
```

### âœ… ä¼˜åŠ¿
- **å®ç°ç®€å•** - åˆçº¦å·²éƒ¨ç½²ï¼Œåªéœ€è°ƒç”¨
- **å®Œå…¨å»ä¸­å¿ƒåŒ–** - æ‰€æœ‰äº¤æ˜“åœ¨é“¾ä¸Š
- **èµ„é‡‘å®‰å…¨** - Conditional Tokens æ‰˜ç®¡
- **å¯ç»„åˆæ€§** - ä¸å…¶ä»– DeFi åè®®é›†æˆ
- **æ— éœ€ç»´æŠ¤** - ä½¿ç”¨æˆç†Ÿåè®®

### âŒ åŠ£åŠ¿
- **Gas è´¹è¾ƒé«˜** - æ¯ç¬”äº¤æ˜“éœ€æ”¯ä»˜
- **ä¾èµ–é“¾ä¸ŠæµåŠ¨æ€§** - éœ€è¦å¯¹æ‰‹ç›˜åœ¨é“¾ä¸Š
- **é€Ÿåº¦è¾ƒæ…¢** - éœ€ç­‰å¾…åŒºå—ç¡®è®¤ï¼ˆ~2ç§’ï¼‰
- **ç”¨æˆ·ä½“éªŒ** - éœ€è¦å¤šæ¬¡äº¤æ˜“ç¡®è®¤

### å®ç°æ­¥éª¤
1. **è®¢å•ç­¾å**ï¼ˆå·²æœ‰ï¼‰
   ```typescript
   // ä½¿ç”¨ EIP-712 ç­¾åè®¢å•
   const signature = await signOrder(orderData, signer);
   ```

2. **æäº¤åˆ° CTF Exchange**
   ```typescript
   // è°ƒç”¨ fillOrder
   const tx = await ctfExchange.fillOrder(order, signature, fillAmount);
   await tx.wait();
   ```

3. **ç›‘å¬é“¾ä¸Šäº‹ä»¶**
   ```typescript
   // ç›‘å¬ OrderFilled äº‹ä»¶
   ctfExchange.on('OrderFilled', (orderId, maker, taker, amount) => {
     // æ›´æ–°UI
   });
   ```

### ä»£ç æ”¹åŠ¨é‡
- **å‰ç«¯**: ~500è¡Œï¼ˆè®¢å•æäº¤ã€çŠ¶æ€ç›‘å¬ï¼‰
- **åç«¯**: ~200è¡Œï¼ˆé“¾ä¸Šæ•°æ®åŒæ­¥ï¼‰
- **åˆçº¦**: 0è¡Œï¼ˆä½¿ç”¨ç°æœ‰åˆçº¦ï¼‰

### æˆæœ¬ä¼°ç®—
- **å¼€å‘æ—¶é—´**: 1-2å‘¨
- **Gasè´¹**: æ¯ç¬”äº¤æ˜“ ~$0.1-0.5ï¼ˆPolygonï¼‰
- **ç»´æŠ¤æˆæœ¬**: ä½

---

## ğŸ¯ æ–¹æ¡ˆ2: æ··åˆæ¨¡å¼ï¼ˆæ¨èâ­ï¼‰

### æ ¸å¿ƒæ€è·¯
é“¾ä¸‹è®¢å•ç°¿ + é“¾ä¸Šç»“ç®—ï¼Œå¹³è¡¡ç”¨æˆ·ä½“éªŒå’Œå»ä¸­å¿ƒåŒ–ã€‚

### æŠ€æœ¯æ¶æ„
```
ç”¨æˆ·ä¸‹å•
    â†“
é“¾ä¸‹è®¢å•ç°¿ï¼ˆSupabaseï¼‰
    â”œâ”€ å¿«é€Ÿæ’®åˆ
    â”œâ”€ å®æ—¶æ›´æ–°
    â””â”€ é›¶Gasè´¹
    â†“
å®šæœŸæ‰¹é‡ç»“ç®—åˆ°é“¾ä¸Š
    â”œâ”€ åˆ›å»ºConditional Tokenså¤´å¯¸
    â””â”€ é“¾ä¸Šå¯éªŒè¯
    â†“
å¸‚åœºç»“ç®—æ—¶
    â”œâ”€ UMAé¢„è¨€æœºç»“ç®—
    â””â”€ Conditional Tokensèµå›
```

### âœ… ä¼˜åŠ¿
- **ç”¨æˆ·ä½“éªŒæœ€ä½³** - å³æ—¶äº¤æ˜“ï¼Œé›¶Gasè´¹
- **å»ä¸­å¿ƒåŒ–ç»“ç®—** - æœ€ç»ˆç»“æœåœ¨é“¾ä¸Š
- **æˆæœ¬ä½** - æ‰¹é‡ç»“ç®—é™ä½Gasè´¹
- **å‘åå…¼å®¹** - ç°æœ‰ç³»ç»Ÿå¯å¤ç”¨
- **çµæ´»** - å¯é€‰æ‹©æ˜¯å¦ä¸Šé“¾

### âŒ åŠ£åŠ¿
- **éƒ¨åˆ†ä¸­å¿ƒåŒ–** - è®¢å•ç°¿åœ¨é“¾ä¸‹
- **éœ€è¦ä¿¡ä»»** - ä¾èµ–å¹³å°ç»“ç®—
- **å®ç°å¤æ‚** - éœ€è¦åŒæ­¥é“¾ä¸Šé“¾ä¸‹

### å®ç°æ­¥éª¤

#### é˜¶æ®µ1: é“¾ä¸‹äº¤æ˜“ï¼ˆå·²æœ‰ï¼‰
```typescript
// å½“å‰ç³»ç»Ÿç»§ç»­ä½¿ç”¨
POST /api/orders/create
```

#### é˜¶æ®µ2: æ‰¹é‡ç»“ç®—æœåŠ¡
```typescript
// æ¯å°æ—¶æ‰¹é‡ç»“ç®—ä¸€æ¬¡
async function batchSettleOrders() {
  // 1. è·å–æœªç»“ç®—è®¢å•
  const pendingOrders = await getPendingOrders();
  
  // 2. æŒ‰å¸‚åœºåˆ†ç»„
  const ordersByMarket = groupByMarket(pendingOrders);
  
  // 3. æ‰¹é‡åˆ›å»ºConditional Tokenså¤´å¯¸
  for (const [marketId, orders] of ordersByMarket) {
    await createConditionalTokensPositions(marketId, orders);
  }
  
  // 4. æ ‡è®°ä¸ºå·²ç»“ç®—
  await markOrdersAsSettled(pendingOrders);
}
```

#### é˜¶æ®µ3: ç»“ç®—æ—¶é“¾ä¸ŠéªŒè¯
```typescript
// å¸‚åœºç»“ç®—æ—¶
async function resolveMarket(marketId: number) {
  // 1. UMAé¢„è¨€æœºç»“ç®—
  await umaOracle.resolve(questionId);
  
  // 2. è®¡ç®—ç”¨æˆ·æ”¶ç›Š
  const positions = await getChainPositions(marketId);
  
  // 3. æ‰¹é‡èµå›
  await conditionalTokens.redeemPositions(positions);
}
```

### ä»£ç æ”¹åŠ¨é‡
- **å‰ç«¯**: ~100è¡Œï¼ˆæ˜¾ç¤ºé“¾ä¸ŠçŠ¶æ€ï¼‰
- **åç«¯**: ~800è¡Œï¼ˆæ‰¹é‡ç»“ç®—æœåŠ¡ï¼‰
- **åˆçº¦**: 0è¡Œï¼ˆä½¿ç”¨ç°æœ‰åˆçº¦ï¼‰

### æˆæœ¬ä¼°ç®—
- **å¼€å‘æ—¶é—´**: 2-3å‘¨
- **Gasè´¹**: æ‰¹é‡ç»“ç®— ~$1-5/æ‰¹æ¬¡
- **ç»´æŠ¤æˆæœ¬**: ä¸­ç­‰ï¼ˆéœ€è¦ç›‘æ§æœåŠ¡ï¼‰

---

## ğŸ¯ æ–¹æ¡ˆ3: è‡ªå»ºé“¾ä¸Šæ’®åˆåˆçº¦

### æ ¸å¿ƒæ€è·¯
éƒ¨ç½²è‡ªå·±çš„æ’®åˆåˆçº¦ï¼Œå®Œå…¨æ§åˆ¶äº¤æ˜“é€»è¾‘ã€‚

### æŠ€æœ¯æ¶æ„
```
ç”¨æˆ·ä¸‹å•
    â†“
æäº¤åˆ°è‡ªå®šä¹‰æ’®åˆåˆçº¦
    â”œâ”€ è®¢å•ç°¿åœ¨é“¾ä¸Š
    â”œâ”€ è‡ªåŠ¨æ’®åˆ
    â””â”€ ç«‹å³æˆäº¤æˆ–æŒ‚å•
    â†“
Conditional Tokensè½¬è´¦
    â†“
é“¾ä¸Šäº‹ä»¶
```

### âœ… ä¼˜åŠ¿
- **å®Œå…¨å»ä¸­å¿ƒåŒ–** - æ‰€æœ‰é€»è¾‘åœ¨é“¾ä¸Š
- **å¯å®šåˆ¶** - å®Œå…¨æ§åˆ¶æ’®åˆé€»è¾‘
- **é€æ˜** - æ‰€æœ‰ä»£ç å¯å®¡è®¡
- **æ— å•ç‚¹æ•…éšœ** - ä¸ä¾èµ–ä¸­å¿ƒåŒ–æœåŠ¡

### âŒ åŠ£åŠ¿
- **å¼€å‘æˆæœ¬é«˜** - éœ€è¦ç¼–å†™å’Œå®¡è®¡åˆçº¦
- **Gasè´¹æé«˜** - æ¯ç¬”äº¤æ˜“éƒ½ä¸Šé“¾
- **ç”¨æˆ·ä½“éªŒå·®** - éœ€è¦ç­‰å¾…ç¡®è®¤
- **ç»´æŠ¤å¤æ‚** - éœ€è¦æŒç»­å®¡è®¡å’Œå‡çº§

### åˆçº¦è®¾è®¡ç¤ºä¾‹
```solidity
contract LUMIMatchingEngine {
    struct Order {
        address maker;
        uint256 marketId;
        uint8 side; // 0=buy, 1=sell
        uint256 price;
        uint256 amount;
        uint256 filled;
        uint256 expiration;
    }
    
    mapping(uint256 => Order[]) public orderbook;
    
    function submitOrder(Order memory order) external {
        // 1. éªŒè¯è®¢å•
        require(order.amount > 0, "Invalid amount");
        
        // 2. å°è¯•æ’®åˆ
        matchOrder(order);
        
        // 3. å¦‚æœæœªå®Œå…¨æˆäº¤ï¼ŒåŠ å…¥è®¢å•ç°¿
        if (order.filled < order.amount) {
            orderbook[order.marketId].push(order);
        }
    }
    
    function matchOrder(Order memory newOrder) internal {
        // æ’®åˆé€»è¾‘...
    }
}
```

### ä»£ç æ”¹åŠ¨é‡
- **å‰ç«¯**: ~800è¡Œï¼ˆå®Œå…¨é‡å†™äº¤æ˜“æµç¨‹ï¼‰
- **åç«¯**: ~300è¡Œï¼ˆé“¾ä¸Šæ•°æ®åŒæ­¥ï¼‰
- **åˆçº¦**: ~2000è¡Œï¼ˆæ’®åˆå¼•æ“ï¼‰

### æˆæœ¬ä¼°ç®—
- **å¼€å‘æ—¶é—´**: 2-3ä¸ªæœˆ
- **å®¡è®¡è´¹ç”¨**: $10k-50k
- **Gasè´¹**: æ¯ç¬”äº¤æ˜“ ~$0.5-2
- **ç»´æŠ¤æˆæœ¬**: é«˜

---

## ğŸ¯ æ–¹æ¡ˆ4: AMMè‡ªåŠ¨åšå¸‚ï¼ˆç±»ä¼¼Uniswapï¼‰

### æ ¸å¿ƒæ€è·¯
ä½¿ç”¨æ’å®šä¹˜ç§¯å…¬å¼ï¼Œç”¨æˆ·ç›´æ¥ä¸æµåŠ¨æ€§æ± äº¤æ˜“ã€‚

### æŠ€æœ¯æ¶æ„
```
æµåŠ¨æ€§æä¾›è€…
    â†“
å­˜å…¥USDCå’ŒConditional Tokens
    â†“
åˆ›å»ºæµåŠ¨æ€§æ± 
    â†“
ç”¨æˆ·äº¤æ˜“
    â”œâ”€ ç›´æ¥ä¸æ± å­äº¤æ˜“
    â”œâ”€ è‡ªåŠ¨å®šä»·ï¼ˆx * y = kï¼‰
    â””â”€ å³æ—¶æˆäº¤
```

### âœ… ä¼˜åŠ¿
- **å³æ—¶æˆäº¤** - æ— éœ€ç­‰å¾…å¯¹æ‰‹ç›˜
- **ä»·æ ¼è¿ç»­** - æ»‘ç‚¹å¯æ§
- **æµåŠ¨æ€§èšåˆ** - æ‰€æœ‰å¸‚åœºå…±äº«æµåŠ¨æ€§
- **ç”¨æˆ·ä½“éªŒå¥½** - ç±»ä¼¼Uniswap

### âŒ åŠ£åŠ¿
- **éœ€è¦æµåŠ¨æ€§** - éœ€è¦LPæä¾›èµ„é‡‘
- **å®ç°å¤æ‚** - éœ€è¦AMMé€»è¾‘
- **æ— å¸¸æŸå¤±** - LPæ‰¿æ‹…é£é™©
- **Gasè´¹ä¸­ç­‰** - æ¯æ¬¡äº¤æ˜“éœ€æ”¯ä»˜

### å®ç°ç¤ºä¾‹
```solidity
contract LUMIAMM {
    mapping(uint256 => LiquidityPool) public pools;
    
    struct LiquidityPool {
        uint256 yesTokens;
        uint256 noTokens;
        uint256 usdc;
    }
    
    function swap(
        uint256 marketId,
        uint8 direction, // 0=buy YES, 1=buy NO
        uint256 usdcAmount
    ) external {
        LiquidityPool storage pool = pools[marketId];
        
        // è®¡ç®—è¾“å‡ºï¼ˆæ’å®šä¹˜ç§¯ï¼‰
        uint256 output = calculateOutput(
            pool.yesTokens,
            pool.noTokens,
            usdcAmount,
            direction
        );
        
        // æ‰§è¡Œäº¤æ¢
        IERC20(usdc).transferFrom(msg.sender, address(this), usdcAmount);
        conditionalTokens.transfer(msg.sender, output);
        
        // æ›´æ–°æ± å­
        updatePool(pool, usdcAmount, output, direction);
    }
}
```

### ä»£ç æ”¹åŠ¨é‡
- **å‰ç«¯**: ~600è¡Œï¼ˆAMMäº¤æ˜“ç•Œé¢ï¼‰
- **åç«¯**: ~400è¡Œï¼ˆæµåŠ¨æ€§ç®¡ç†ï¼‰
- **åˆçº¦**: ~1500è¡Œï¼ˆAMMé€»è¾‘ï¼‰

### æˆæœ¬ä¼°ç®—
- **å¼€å‘æ—¶é—´**: 1-2ä¸ªæœˆ
- **å®¡è®¡è´¹ç”¨**: $5k-20k
- **Gasè´¹**: æ¯ç¬”äº¤æ˜“ ~$0.2-0.8
- **ç»´æŠ¤æˆæœ¬**: ä¸­ç­‰

---

## ğŸ“Š ç»¼åˆå¯¹æ¯”

### å¼€å‘æˆæœ¬
| æ–¹æ¡ˆ | å‰ç«¯ | åç«¯ | åˆçº¦ | æ€»è®¡ |
|------|------|------|------|------|
| æ–¹æ¡ˆ1 | 500è¡Œ | 200è¡Œ | 0è¡Œ | 700è¡Œ |
| æ–¹æ¡ˆ2 | 100è¡Œ | 800è¡Œ | 0è¡Œ | 900è¡Œ |
| æ–¹æ¡ˆ3 | 800è¡Œ | 300è¡Œ | 2000è¡Œ | 3100è¡Œ |
| æ–¹æ¡ˆ4 | 600è¡Œ | 400è¡Œ | 1500è¡Œ | 2500è¡Œ |

### ç”¨æˆ·ä½“éªŒ
- **æ–¹æ¡ˆ2** > **æ–¹æ¡ˆ4** > **æ–¹æ¡ˆ1** > **æ–¹æ¡ˆ3**

### å»ä¸­å¿ƒåŒ–ç¨‹åº¦
- **æ–¹æ¡ˆ3** = **æ–¹æ¡ˆ1** > **æ–¹æ¡ˆ4** > **æ–¹æ¡ˆ2**

### æˆæœ¬ï¼ˆGasè´¹ï¼‰
- **æ–¹æ¡ˆ2** < **æ–¹æ¡ˆ4** < **æ–¹æ¡ˆ1** < **æ–¹æ¡ˆ3**

---

## ğŸ¯ æ¨èæ–¹æ¡ˆ

### çŸ­æœŸï¼ˆ1-3ä¸ªæœˆï¼‰ï¼šæ–¹æ¡ˆ2 - æ··åˆæ¨¡å¼
- âœ… å¿«é€Ÿä¸Šçº¿
- âœ… ç”¨æˆ·ä½“éªŒæœ€ä½³
- âœ… æˆæœ¬æœ€ä½
- âœ… å¯é€æ­¥è¿ç§»

### é•¿æœŸï¼ˆ6-12ä¸ªæœˆï¼‰ï¼šæ–¹æ¡ˆ1 + æ–¹æ¡ˆ2
- âœ… æ–¹æ¡ˆ2ä½œä¸ºé»˜è®¤æ¨¡å¼ï¼ˆç”¨æˆ·ä½“éªŒï¼‰
- âœ… æ–¹æ¡ˆ1ä½œä¸ºé«˜çº§é€‰é¡¹ï¼ˆå®Œå…¨å»ä¸­å¿ƒåŒ–ï¼‰
- âœ… ç”¨æˆ·å¯é€‰æ‹©äº¤æ˜“æ¨¡å¼

---

## ğŸš€ å®æ–½è·¯çº¿å›¾

### é˜¶æ®µ1: æ··åˆæ¨¡å¼åŸºç¡€ï¼ˆ2å‘¨ï¼‰
- [ ] å®ç°æ‰¹é‡ç»“ç®—æœåŠ¡
- [ ] é“¾ä¸ŠçŠ¶æ€åŒæ­¥
- [ ] ç”¨æˆ·ç•Œé¢æ›´æ–°

### é˜¶æ®µ2: CTF Exchangeé›†æˆï¼ˆ2å‘¨ï¼‰
- [ ] è®¢å•ç­¾åä¼˜åŒ–
- [ ] CTF Exchangeè°ƒç”¨
- [ ] é“¾ä¸Šäº‹ä»¶ç›‘å¬

### é˜¶æ®µ3: ç”¨æˆ·é€‰æ‹©ï¼ˆ1å‘¨ï¼‰
- [ ] äº¤æ˜“æ¨¡å¼åˆ‡æ¢
- [ ] Gasè´¹ä¼°ç®—æ˜¾ç¤º
- [ ] ç”¨æˆ·ä½“éªŒä¼˜åŒ–

---

## ğŸ’¡ å»ºè®®

1. **å…ˆå®æ–½æ–¹æ¡ˆ2** - å¿«é€Ÿæå‡ç”¨æˆ·ä½“éªŒ
2. **å¹¶è¡Œå¼€å‘æ–¹æ¡ˆ1** - ä¸ºé«˜çº§ç”¨æˆ·æä¾›é€‰æ‹©
3. **é•¿æœŸè€ƒè™‘æ–¹æ¡ˆ4** - å¦‚æœæµåŠ¨æ€§å……è¶³
4. **æš‚ä¸è€ƒè™‘æ–¹æ¡ˆ3** - æˆæœ¬è¿‡é«˜ï¼Œæ”¶ç›Šæœ‰é™

