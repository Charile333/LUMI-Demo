# âš¡ å¿«é€Ÿå¯ç”¨å¹³å°è‡ªåŠ¨ç»“ç®—

## ğŸ¯ ä¸‰æ­¥å¯ç”¨

### æ­¥éª¤ 1ï¼šé…ç½®ç¯å¢ƒå˜é‡

åœ¨é¡¹ç›®æ ¹ç›®å½•çš„ `.env.local` æ–‡ä»¶ä¸­æ·»åŠ ï¼š

```env
# å¹³å°é’±åŒ…ç§é’¥ï¼ˆç”¨äºæ‰¹é‡ç»“ç®—ï¼‰
PLATFORM_WALLET_PRIVATE_KEY=your_private_key_here

# RPC URLï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
NEXT_PUBLIC_RPC_URL=https://polygon-amoy.g.alchemy.com/v2/your_key
```

**æ³¨æ„**ï¼šç§é’¥ä¸è¦åŒ…å« `0x` å‰ç¼€ï¼ˆå¦‚æœåŒ…å«ä¼šè‡ªåŠ¨å¤„ç†ï¼‰

---

### æ­¥éª¤ 2ï¼šç¡®ä¿é’±åŒ…æœ‰èµ„é‡‘

å¹³å°é’±åŒ…éœ€è¦ï¼š
- âœ… **MATIC**ï¼šè‡³å°‘ 1 MATICï¼ˆç”¨äºæ”¯ä»˜ Gasï¼‰
- âœ… **USDC**ï¼šæ ¹æ®å®é™…éœ€è¦ï¼ˆå¦‚æœæ‰¹é‡ç»“ç®—éœ€è¦ï¼‰

æ£€æŸ¥é’±åŒ…ä½™é¢ï¼š

```bash
# ä½¿ç”¨æ£€æŸ¥è„šæœ¬
node scripts/check-usdc-approve.js
```

---

### æ­¥éª¤ 3ï¼šå¯åŠ¨ Cron è°ƒåº¦å™¨

#### æ–¹å¼ 1ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰â­

```bash
# Windows (Git Bash)
bash scripts/start-cron.sh

# Linux/Mac
./scripts/start-cron.sh
```

#### æ–¹å¼ 2ï¼šä½¿ç”¨ npm å‘½ä»¤

```bash
# å¯åŠ¨
npm run cron:start

# æŸ¥çœ‹çŠ¶æ€
npm run cron:status

# æŸ¥çœ‹æ—¥å¿—
npm run cron:logs
```

#### æ–¹å¼ 3ï¼šä½¿ç”¨ PM2 ç›´æ¥å¯åŠ¨

```bash
# å®‰è£… PM2ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
npm install -g pm2

# å¯åŠ¨ Cron è°ƒåº¦å™¨
pm2 start ecosystem.config.js

# ä¿å­˜é…ç½®
pm2 save

# è®¾ç½®å¼€æœºè‡ªå¯ï¼ˆå¯é€‰ï¼‰
pm2 startup
```

#### æ–¹å¼ 4ï¼šç›´æ¥è¿è¡Œï¼ˆå¼€å‘æµ‹è¯•ï¼‰

```bash
# ç›´æ¥è¿è¡Œï¼ˆå‰å°è¿è¡Œï¼ŒæŒ‰ Ctrl+C åœæ­¢ï¼‰
npm run cron
```

---

## âœ… éªŒè¯æ˜¯å¦å¯ç”¨

### 1. æ£€æŸ¥ PM2 çŠ¶æ€

```bash
pm2 status
```

åº”è¯¥çœ‹åˆ° `lumi-cron` çŠ¶æ€ä¸º `online`

### 2. æŸ¥çœ‹æ—¥å¿—

```bash
pm2 logs lumi-cron --lines 50
```

åº”è¯¥çœ‹åˆ°ï¼š
```
âœ… Cron è°ƒåº¦å™¨å·²å¯åŠ¨
ä»»åŠ¡åˆ—è¡¨:
  1. å¸‚åœºæ¿€æ´» - æ¯å°æ—¶ (0 * * * *)
  2. æ¸…ç†è®¢å• - æ¯ 30 åˆ†é’Ÿ (*/30 * * * *)
  3. æ‰¹é‡ç»“ç®— - æ¯ 5 åˆ†é’Ÿ (*/5 * * * *)
```

### 3. æ‰‹åŠ¨æµ‹è¯•æ‰¹é‡ç»“ç®—

```bash
npm run settle-trades
```

åº”è¯¥çœ‹åˆ°ï¼š
```
ğŸ’° å¼€å§‹æ‰¹é‡ç»“ç®—äº¤æ˜“...
âœ… å½“å‰æ²¡æœ‰å¾…ç»“ç®—çš„äº¤æ˜“
```

æˆ–å¦‚æœæœ‰å¾…ç»“ç®—çš„è®¢å•ï¼š
```
ğŸ’° å¼€å§‹æ‰¹é‡ç»“ç®—äº¤æ˜“...
ğŸ“Š æ‰¾åˆ° X ç¬”å¾…ç»“ç®—äº¤æ˜“
ğŸ“¦ åˆ›å»ºç»“ç®—æ‰¹æ¬¡: batch-...
âœ… æ‰¹é‡ç»“ç®—å®Œæˆ
```

---

## ğŸ“Š å¯ç”¨åçš„æ•ˆæœ

å¯ç”¨å¹³å°è‡ªåŠ¨ç»“ç®—åï¼š

1. âœ… **è‡ªåŠ¨æ‰¹é‡ç»“ç®—**ï¼šæ¯ 5 åˆ†é’Ÿè‡ªåŠ¨ç»“ç®—å¾…å¤„ç†çš„è®¢å•
2. âœ… **å¹³å°ä»£ä»˜ Gas**ï¼šç”¨æˆ·æ— éœ€æ”¯ä»˜ Gas è´¹
3. âœ… **æ— éœ€ç”¨æˆ·æ“ä½œ**ï¼šå®Œå…¨è‡ªåŠ¨åŒ–
4. âœ… **æ‰¹é‡ä¼˜åŒ–**ï¼šä¸€æ¬¡ç»“ç®—å¤šä¸ªè®¢å•ï¼ŒèŠ‚çœ Gas

**ç”¨æˆ·ä½“éªŒ**ï¼š
- âœ… ç”¨æˆ·ä¸‹å•åï¼Œè®¢å•ä¼šåœ¨ 5-10 åˆ†é’Ÿå†…è‡ªåŠ¨ç»“ç®—
- âœ… ç”¨æˆ·æ— éœ€æ‰‹åŠ¨ç‚¹å‡»"æ‰§è¡Œé“¾ä¸Šäº¤æ˜“"æŒ‰é’®
- âœ… ç”¨æˆ·æ— éœ€æ”¯ä»˜ Gas è´¹
- âœ… äº¤æ˜“å®Œå…¨è‡ªåŠ¨åŒ–

---

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### PM2 å‘½ä»¤

```bash
# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs lumi-cron

# æŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼ˆæœ€å 50 è¡Œï¼‰
pm2 logs lumi-cron --lines 50

# é‡å¯
pm2 restart lumi-cron

# åœæ­¢
pm2 stop lumi-cron

# åˆ é™¤
pm2 delete lumi-cron

# æŸ¥çœ‹è¯¦æƒ…
pm2 describe lumi-cron

# ç›‘æ§
pm2 monit
```

### npm å‘½ä»¤

```bash
# å¯åŠ¨ Cron
npm run cron:start

# æŸ¥çœ‹çŠ¶æ€
npm run cron:status

# æŸ¥çœ‹æ—¥å¿—
npm run cron:logs

# é‡å¯
npm run cron:restart

# åœæ­¢
npm run cron:stop

# ç›´æ¥è¿è¡Œï¼ˆå‰å°ï¼‰
npm run cron

# æµ‹è¯•æ‰¹é‡ç»“ç®—
npm run settle-trades
```

---

## âš ï¸ å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šç¯å¢ƒå˜é‡æœªåŠ è½½

**é”™è¯¯**ï¼š
```
âš ï¸ æœªé…ç½® PLATFORM_WALLET_PRIVATE_KEY
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤ `.env.local` æ–‡ä»¶å­˜åœ¨
2. ç¡®è®¤ç¯å¢ƒå˜é‡åç§°æ­£ç¡®
3. é‡å¯ Cron è°ƒåº¦å™¨ï¼š`pm2 restart lumi-cron`

---

### é—®é¢˜ 2ï¼šPM2 æœªå®‰è£…

**é”™è¯¯**ï¼š
```
command not found: pm2
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
npm install -g pm2
```

---

### é—®é¢˜ 3ï¼šé’±åŒ…ä½™é¢ä¸è¶³

**é”™è¯¯**ï¼š
```
âŒ äº¤æ˜“å¤±è´¥: insufficient funds
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥å¹³å°é’±åŒ… MATIC ä½™é¢
2. ä¸ºé’±åŒ…å……å€¼ MATICï¼ˆå»ºè®®è‡³å°‘ 1 MATICï¼‰

---

### é—®é¢˜ 4ï¼šCron è°ƒåº¦å™¨æœªè¿è¡Œ

**æ£€æŸ¥**ï¼š
```bash
pm2 status
```

**å¦‚æœæ²¡æœ‰è¿è¡Œ**ï¼š
```bash
pm2 start ecosystem.config.js
pm2 save
```

---

## ğŸ“ ç›‘æ§å»ºè®®

### æ¯æ—¥æ£€æŸ¥

```bash
# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—ï¼ˆæœ€å 50 è¡Œï¼‰
pm2 logs lumi-cron --lines 50
```

### æ¯å‘¨æ£€æŸ¥

```bash
# æ£€æŸ¥é’±åŒ…ä½™é¢
node scripts/check-usdc-approve.js

# æ‰‹åŠ¨æµ‹è¯•æ‰¹é‡ç»“ç®—
npm run settle-trades
```

---

## ğŸ‰ å®Œæˆï¼

**å¹³å°è‡ªåŠ¨ç»“ç®—å·²å¯ç”¨ï¼**

ç°åœ¨ç”¨æˆ·çš„è®¢å•ä¼šè‡ªåŠ¨æ‰¹é‡ç»“ç®—ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œã€‚

**åç»­ç»´æŠ¤**ï¼š
- å®šæœŸæ£€æŸ¥ PM2 çŠ¶æ€ï¼š`pm2 status`
- ç›‘æ§æ‰¹é‡ç»“ç®—æ—¥å¿—ï¼š`pm2 logs lumi-cron`
- ç¡®ä¿å¹³å°é’±åŒ…æœ‰è¶³å¤Ÿçš„èµ„é‡‘

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `docs/å¯ç”¨å¹³å°è‡ªåŠ¨ç»“ç®—æŒ‡å—.md` - è¯¦ç»†å¯ç”¨æŒ‡å—
- `docs/ç»“ç®—æ–¹å¼è¯´æ˜.md` - ç»“ç®—æ–¹å¼è¯¦ç»†è¯´æ˜
- `docs/ä¸»æµå¹³å°ç»“ç®—æ–¹å¼å¯¹æ¯”.md` - ä¸»æµå¹³å°å¯¹æ¯”

