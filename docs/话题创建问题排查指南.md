# è¯é¢˜åˆ›å»ºé—®é¢˜æ’æŸ¥æŒ‡å—

## å¸¸è§é—®é¢˜

### 1. 500 å†…éƒ¨æœåŠ¡å™¨é”™è¯¯

**å¯èƒ½åŸå› **ï¼š
- `user_topics` è¡¨ä¸å­˜åœ¨
- Supabase ç¯å¢ƒå˜é‡æœªé…ç½®
- Supabase è¿æ¥å¤±è´¥
- æ•°æ®åº“æƒé™é—®é¢˜

**æ’æŸ¥æ­¥éª¤**ï¼š

1. **æ£€æŸ¥ Vercel å‡½æ•°æ—¥å¿—**ï¼š
   - ç™»å½• Vercel Dashboard
   - è¿›å…¥é¡¹ç›® â†’ Functions â†’ `/api/topics`
   - æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼ŒæŸ¥æ‰¾è¯¦ç»†é”™è¯¯ä¿¡æ¯

2. **æ£€æŸ¥ Supabase è¡¨æ˜¯å¦å­˜åœ¨**ï¼š
   - ç™»å½• Supabase Dashboard
   - è¿›å…¥ SQL Editor
   - è¿è¡ŒæŸ¥è¯¢ï¼š
   ```sql
   SELECT EXISTS (
     SELECT FROM information_schema.tables 
     WHERE table_schema = 'public' 
     AND table_name = 'user_topics'
   );
   ```
   - å¦‚æœè¿”å› `false`ï¼Œéœ€è¦è¿è¡Œ `database/create-user-topics-table.sql`

3. **æ£€æŸ¥ç¯å¢ƒå˜é‡**ï¼š
   - åœ¨ Vercel Dashboard ä¸­æ£€æŸ¥ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š
     - `NEXT_PUBLIC_SUPABASE_URL`
     - `SUPABASE_SERVICE_ROLE_KEY` æˆ– `NEXT_PUBLIC_SUPABASE_ANON_KEY`

4. **åˆ›å»ºæ•°æ®åº“è¡¨**ï¼š
   - å¦‚æœè¡¨ä¸å­˜åœ¨ï¼Œåœ¨ Supabase SQL Editor ä¸­è¿è¡Œï¼š
   ```sql
   -- ä» database/create-user-topics-table.sql å¤åˆ¶ SQL
   ```

### 2. 503 æœåŠ¡ä¸å¯ç”¨

**å¯èƒ½åŸå› **ï¼š
- Supabase æœªé…ç½®
- Supabase å®¢æˆ·ç«¯åˆå§‹åŒ–å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ Vercel ç¯å¢ƒå˜é‡æ˜¯å¦é…ç½®æ­£ç¡®
- æ£€æŸ¥ Supabase é¡¹ç›®æ˜¯å¦æ­£å¸¸è¿è¡Œ

### 3. 409 å†²çªé”™è¯¯

**å¯èƒ½åŸå› **ï¼š
- è¯é¢˜æ ‡é¢˜å·²å­˜åœ¨ï¼ˆæ ‡é¢˜å”¯ä¸€çº¦æŸï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä¿®æ”¹è¯é¢˜æ ‡é¢˜ï¼Œç¡®ä¿å”¯ä¸€æ€§

### 4. ç½‘ç»œé”™è¯¯

**å¯èƒ½åŸå› **ï¼š
- ç½‘ç»œè¿æ¥é—®é¢˜
- API ç«¯ç‚¹ä¸å¯è¾¾

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰ CORS é”™è¯¯
- æ£€æŸ¥ Vercel éƒ¨ç½²æ˜¯å¦æˆåŠŸ

---

## è°ƒè¯•æ­¥éª¤

### 1. å¯ç”¨è¯¦ç»†æ—¥å¿—

ä»£ç å·²ç»æ·»åŠ äº†è¯¦ç»†çš„æ§åˆ¶å°æ—¥å¿—ï¼Œåœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¸­æŸ¥çœ‹ï¼š

```
ğŸ“¤ æäº¤è¯é¢˜: { title: "...", description: "..." }
ğŸ“¥ API å“åº”çŠ¶æ€: 200 OK
ğŸ“¥ API å“åº”æ•°æ®: { success: true, topic: {...} }
âœ… è¯é¢˜åˆ›å»ºæˆåŠŸ: 1
```

å¦‚æœå¤±è´¥ï¼Œä¼šæ˜¾ç¤ºï¼š
```
âŒ åˆ›å»ºè¯é¢˜å¤±è´¥: { status: 500, error: "...", errorCode: "...", ... }
```

### 2. æ£€æŸ¥ Vercel å‡½æ•°æ—¥å¿—

1. ç™»å½• [Vercel Dashboard](https://vercel.com/dashboard)
2. é€‰æ‹©é¡¹ç›®
3. ç‚¹å‡» "Functions" æ ‡ç­¾
4. ç‚¹å‡» `/api/topics` å‡½æ•°
5. æŸ¥çœ‹å®æ—¶æ—¥å¿—

### 3. æ£€æŸ¥ Supabase æ—¥å¿—

1. ç™»å½• [Supabase Dashboard](https://supabase.com/dashboard)
2. é€‰æ‹©é¡¹ç›®
3. ç‚¹å‡» "Logs" â†’ "API Logs"
4. æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯è¯·æ±‚

---

## å¿«é€Ÿä¿®å¤

### å¦‚æœè¡¨ä¸å­˜åœ¨

åœ¨ Supabase SQL Editor ä¸­è¿è¡Œï¼š

```sql
-- åˆ›å»ºç”¨æˆ·è¯é¢˜è¡¨
CREATE TABLE IF NOT EXISTS user_topics (
  id SERIAL PRIMARY KEY,
  title VARCHAR(100) NOT NULL UNIQUE,
  description TEXT DEFAULT '',
  created_by VARCHAR(255) NOT NULL DEFAULT 'anonymous',
  votes INTEGER NOT NULL DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- åˆ›å»ºè¯é¢˜æŠ•ç¥¨è¡¨
CREATE TABLE IF NOT EXISTS topic_votes (
  id SERIAL PRIMARY KEY,
  topic_id INTEGER NOT NULL REFERENCES user_topics(id) ON DELETE CASCADE,
  user_address VARCHAR(255) NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(topic_id, user_address)
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_user_topics_votes ON user_topics(votes DESC);
CREATE INDEX IF NOT EXISTS idx_user_topics_created_at ON user_topics(created_at DESC);
CREATE INDEX IF NOT EXISTS idx_topic_votes_topic_id ON topic_votes(topic_id);
CREATE INDEX IF NOT EXISTS idx_topic_votes_user_address ON topic_votes(user_address);
```

### å¦‚æœç¯å¢ƒå˜é‡æœªé…ç½®

åœ¨ Vercel Dashboard ä¸­ï¼š

1. è¿›å…¥é¡¹ç›®è®¾ç½® â†’ Environment Variables
2. æ·»åŠ ä»¥ä¸‹å˜é‡ï¼š
   - `NEXT_PUBLIC_SUPABASE_URL`: ä» Supabase Dashboard â†’ Settings â†’ API è·å–
   - `SUPABASE_SERVICE_ROLE_KEY`: ä» Supabase Dashboard â†’ Settings â†’ API è·å–ï¼ˆéœ€è¦ Service Role Keyï¼‰

---

## è·å–é”™è¯¯è¯¦æƒ…

å¦‚æœä»ç„¶å¤±è´¥ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **æµè§ˆå™¨æ§åˆ¶å°æ—¥å¿—**ï¼š
   - æ‰“å¼€å¼€å‘è€…å·¥å…· (F12)
   - æŸ¥çœ‹ Console æ ‡ç­¾
   - å¤åˆ¶æ‰€æœ‰ä¸ `/api/topics` ç›¸å…³çš„æ—¥å¿—

2. **ç½‘ç»œè¯·æ±‚è¯¦æƒ…**ï¼š
   - æ‰“å¼€å¼€å‘è€…å·¥å…· (F12)
   - æŸ¥çœ‹ Network æ ‡ç­¾
   - æ‰¾åˆ° `/api/topics` POST è¯·æ±‚
   - æŸ¥çœ‹ Request å’Œ Response

3. **Vercel å‡½æ•°æ—¥å¿—**ï¼š
   - ä» Vercel Dashboard è·å–æœ€æ–°æ—¥å¿—

---

## ç›¸å…³æ–‡ä»¶

- `app/api/topics/route.ts` - API ç«¯ç‚¹
- `components/CreateTopicButton.tsx` - å‰ç«¯ç»„ä»¶
- `database/create-user-topics-table.sql` - æ•°æ®åº“è¡¨åˆ›å»ºè„šæœ¬
- `lib/supabase-client.ts` - Supabase å®¢æˆ·ç«¯é…ç½®

