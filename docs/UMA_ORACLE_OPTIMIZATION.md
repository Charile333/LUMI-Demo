# ğŸ”® UMA é¢„è¨€æœºé›†æˆä¼˜åŒ–æ–¹æ¡ˆ

## ğŸ“Š UMA é¢„è¨€æœºæ˜¯ä»€ä¹ˆï¼Ÿ

UMA (Universal Market Access) æ˜¯ä¸€ä¸ª**å»ä¸­å¿ƒåŒ–çš„ä¹è§‚é¢„è¨€æœºåè®®**ï¼ŒPolymarket ä½¿ç”¨å®ƒæ¥ç¡®ä¿å¸‚åœºç»“ç®—çš„å…¬å¹³æ€§å’Œå®‰å…¨æ€§ã€‚

### æ ¸å¿ƒç‰¹ç‚¹

1. **ä¹è§‚æœºåˆ¶**ï¼šé»˜è®¤ç›¸ä¿¡ææ¡ˆè€…è¯šå®
2. **ç»æµæ¿€åŠ±**ï¼šé€šè¿‡ä¿è¯é‡‘å’Œå¥–åŠ±æœºåˆ¶
3. **äº‰è®®è§£å†³**ï¼šUMA ä»£å¸æŒæœ‰è€…æŠ•ç¥¨
4. **ä½æˆæœ¬**ï¼šåªæœ‰åœ¨äº‰è®®æ—¶æ‰éœ€è¦æŠ•ç¥¨

---

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

åœ¨å¡ç‰‡å’Œè¯¦æƒ…é¡µä¸­å±•ç¤º UMA é¢„è¨€æœºç›¸å…³ä¿¡æ¯ï¼š

```
âœ… å¸‚åœºçŠ¶æ€ï¼ˆäº¤æ˜“ä¸­/å¾…ç»“ç®—/å·²ç»“ç®—ï¼‰
âœ… ç»“ç®—å€’è®¡æ—¶
âœ… æŒ‘æˆ˜æœŸå€’è®¡æ—¶
âœ… ç»“ç®—ç»“æœå±•ç¤º
âœ… æ“ä½œæŒ‰é’®ï¼ˆè¯·æ±‚ç»“ç®—/æœ€ç»ˆç¡®è®¤/èµå›ï¼‰
```

---

## ğŸ—ï¸ å®æ–½æ–¹æ¡ˆ

### æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           UMAOracleProvider (æ–°å¢)                    â”‚
â”‚  â”œâ”€ æ‰¹é‡è·å–å¸‚åœºç»“ç®—çŠ¶æ€                               â”‚
â”‚  â”œâ”€ å®æ—¶ç›‘å¬ç»“ç®—çŠ¶æ€å˜åŒ–                               â”‚
â”‚  â””â”€ è®¡ç®—å€’è®¡æ—¶ã€åˆ¤æ–­å¯æ‰§è¡Œæ“ä½œ                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           MarketDataProvider (å·²æœ‰)                   â”‚
â”‚  â”œâ”€ å®æ—¶ä»·æ ¼ã€äº¤æ˜“é‡ã€å‚ä¸äººæ•°                         â”‚
â”‚  â””â”€ è®¢å•ç°¿æ•°æ®                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“        â†“        â†“
  å¡ç‰‡    è®¢å•ç°¿   UMAçŠ¶æ€ç»„ä»¶
```

---

## ğŸ“ å·²åˆ›å»ºçš„æ–‡ä»¶

### æ ¸å¿ƒæ–‡ä»¶ï¼ˆ3ä¸ªï¼‰

1. **`lib/contexts/UMAOracleContext.tsx`**
   - UMA é¢„è¨€æœºçŠ¶æ€ç®¡ç†
   - æ‰¹é‡æŸ¥è¯¢ + å®æ—¶ç›‘å¬
   - Hook: `useOracleStatus(marketId)`

2. **`components/UMAOracleStatus.tsx`**
   - é¢„è¨€æœºçŠ¶æ€å±•ç¤ºç»„ä»¶
   - å€’è®¡æ—¶ç»„ä»¶
   - çŠ¶æ€å¾½ç« ç»„ä»¶

3. **`components/MarketCardWithOracle.tsx`**
   - é›†æˆ UMA çŠ¶æ€çš„å¡ç‰‡
   - æ˜¾ç¤ºç»“ç®—çŠ¶æ€å¾½ç« 
   - è‡ªåŠ¨åˆ‡æ¢äº¤æ˜“/ç»“ç®—æ¨¡å¼

### ç¤ºä¾‹é¡µé¢ï¼ˆ1ä¸ªï¼‰

4. **`app/markets/with-oracle/page.tsx`**
   - å®Œæ•´ç¤ºä¾‹é¡µé¢
   - çŠ¶æ€è¿‡æ»¤å™¨
   - UMA å·¥ä½œæµç¨‹è¯´æ˜

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æ•°æ®åº“å‡†å¤‡

ç¡®ä¿ `markets` è¡¨æœ‰ä»¥ä¸‹å­—æ®µï¼š

```sql
-- æ£€æŸ¥å¹¶æ·»åŠ å­—æ®µ
ALTER TABLE markets ADD COLUMN IF NOT EXISTS end_date TIMESTAMPTZ;
ALTER TABLE markets ADD COLUMN IF NOT EXISTS settlement_requested_at TIMESTAMPTZ;
ALTER TABLE markets ADD COLUMN IF NOT EXISTS settlement_resolved_at TIMESTAMPTZ;
ALTER TABLE markets ADD COLUMN IF NOT EXISTS settlement_result VARCHAR(10);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_markets_end_date ON markets(end_date);
CREATE INDEX IF NOT EXISTS idx_markets_settlement_status ON markets(settlement_requested_at, settlement_resolved_at);
```

### 2. è®¿é—®ç¤ºä¾‹é¡µé¢

```bash
# å¯åŠ¨é¡¹ç›®
npm run dev

# è®¿é—® UMA é›†æˆç¤ºä¾‹
http://localhost:3000/markets/with-oracle
```

---

## ğŸ’» ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•1: å•ç‹¬ä½¿ç”¨ UMA çŠ¶æ€ç»„ä»¶

```typescript
import { UMAOracleProvider, useOracleStatus } from '@/lib/contexts/UMAOracleContext';
import { UMAOracleStatus } from '@/components/UMAOracleStatus';

export default function MarketDetailPage() {
  const marketId = 1;
  
  return (
    <UMAOracleProvider marketIds={[marketId]}>
      {/* æ˜¾ç¤ºå®Œæ•´çš„ UMA çŠ¶æ€é¢æ¿ */}
      <UMAOracleStatus 
        marketId={marketId}
        questionId="market-question-id"
        showActions={true}
      />
    </UMAOracleProvider>
  );
}
```

### æ–¹æ³•2: é›†æˆåˆ°å¡ç‰‡

```typescript
import { MarketDataProvider } from '@/lib/contexts/MarketDataContext';
import { UMAOracleProvider } from '@/lib/contexts/UMAOracleContext';
import { MarketCardWithOracle } from '@/components/MarketCardWithOracle';

export default function MarketsPage() {
  const markets = [...];
  const marketIds = markets.map(m => m.id);
  
  return (
    <MarketDataProvider marketIds={marketIds}>
      <UMAOracleProvider marketIds={marketIds}>
        <div className="grid grid-cols-3 gap-4">
          {markets.map(market => (
            <MarketCardWithOracle key={market.id} market={market} />
          ))}
        </div>
      </UMAOracleProvider>
    </MarketDataProvider>
  );
}
```

### æ–¹æ³•3: å®Œæ•´äº¤æ˜“é¡µé¢

```typescript
import { MarketDataProvider } from '@/lib/contexts/MarketDataContext';
import { UMAOracleProvider } from '@/lib/contexts/UMAOracleContext';
import { OrderBookOptimized } from '@/components/trading/OrderBookOptimized';
import { UMAOracleStatus, OracleCountdown } from '@/components/UMAOracleStatus';

export default function TradingPage() {
  const marketId = 1;
  
  return (
    <MarketDataProvider marketIds={[marketId]}>
      <UMAOracleProvider marketIds={[marketId]}>
        <div className="grid grid-cols-3 gap-6">
          
          {/* å·¦ä¾§ï¼šå¸‚åœºä¿¡æ¯ */}
          <div className="col-span-2">
            <MarketInfo />
            
            {/* UMA çŠ¶æ€å’Œå€’è®¡æ—¶ */}
            <OracleCountdown marketId={marketId} />
          </div>

          {/* å³ä¾§ï¼šè®¢å•ç°¿ + UMA çŠ¶æ€ */}
          <div className="space-y-6">
            <OrderBookOptimized marketId={marketId} />
            <UMAOracleStatus 
              marketId={marketId}
              showActions={true}
            />
          </div>
        </div>
      </UMAOracleProvider>
    </MarketDataProvider>
  );
}
```

---

## ğŸ“– ç»„ä»¶ API

### UMAOracleStatus

**å®Œæ•´æ¨¡å¼**ï¼ˆç”¨äºè¯¦æƒ…é¡µï¼‰

```typescript
<UMAOracleStatus 
  marketId={1}
  questionId="market-question-id"
  showActions={true}    // æ˜¾ç¤ºæ“ä½œæŒ‰é’®
  compact={false}       // å®Œæ•´æ¨¡å¼
/>
```

**ç´§å‡‘æ¨¡å¼**ï¼ˆç”¨äºå¡ç‰‡ï¼‰

```typescript
<UMAOracleStatus 
  marketId={1}
  compact={true}        // ç´§å‡‘æ¨¡å¼ï¼Œåªæ˜¾ç¤ºçŠ¶æ€
/>
```

### OracleStatusBadge

**çŠ¶æ€å¾½ç« **ï¼ˆç”¨äºå¡ç‰‡æ ‡ç­¾ï¼‰

```typescript
import { OracleStatusBadge } from '@/components/UMAOracleStatus';

<OracleStatusBadge marketId={1} />
// æ˜¾ç¤ºï¼šğŸŸ¢ äº¤æ˜“ä¸­ | ğŸŸ¡ å¾…ç»“ç®— | â³ æŒ‘æˆ˜æœŸ | âœ… å·²ç»“ç®—
```

### OracleCountdown

**å€’è®¡æ—¶ç»„ä»¶**

```typescript
import { OracleCountdown } from '@/components/UMAOracleStatus';

<OracleCountdown marketId={1} />
// æ˜¾ç¤ºï¼š2:00:00ï¼ˆæŒ‘æˆ˜æœŸå€’è®¡æ—¶ï¼‰
```

---

## ğŸ” UMA é¢„è¨€æœºçŠ¶æ€

### çŠ¶æ€æšä¸¾

```typescript
type OracleState = 
  | 'active'      // ğŸŸ¢ äº¤æ˜“ä¸­
  | 'ended'       // ğŸŸ¡ å·²åˆ°æœŸï¼Œç­‰å¾…ç»“ç®—
  | 'requested'   // â³ å·²è¯·æ±‚é¢„è¨€æœºï¼ˆæŒ‘æˆ˜æœŸä¸­ï¼‰
  | 'proposed'    // âœ“ ææ¡ˆå·²é€šè¿‡ï¼ˆå¯æœ€ç»ˆç¡®è®¤ï¼‰
  | 'disputed'    // âš ï¸ ç»“æœè¢«äº‰è®®
  | 'resolved';   // âœ… å·²æœ€ç»ˆç»“ç®—
```

### çŠ¶æ€è½¬æ¢æµç¨‹

```
active (äº¤æ˜“ä¸­)
    â†“ å¸‚åœºåˆ°æœŸ
ended (å¾…ç»“ç®—)
    â†“ è°ƒç”¨ requestSettlement()
requested (æŒ‘æˆ˜æœŸ 2å°æ—¶)
    â†“ æŒ‘æˆ˜æœŸç»“æŸ + æ— äº‰è®®
proposed (å¯æœ€ç»ˆç¡®è®¤)
    â†“ è°ƒç”¨ resolveMarket()
resolved (å·²ç»“ç®—)
    â†“ ç”¨æˆ·èµå›
å®Œæˆ
```

---

## ğŸ¯ é›†æˆåˆ°ç°æœ‰é¡µé¢

### æ­¥éª¤1: ä¿®æ”¹å¸‚åœºåˆ—è¡¨é¡µ

```typescript
// app/markets/page.tsx
import { UMAOracleProvider } from '@/lib/contexts/UMAOracleContext';
import { MarketCardWithOracle } from '@/components/MarketCardWithOracle';

export default function MarketsPage() {
  return (
    <MarketDataProvider marketIds={marketIds}>
+     <UMAOracleProvider marketIds={marketIds}>
        <div className="grid grid-cols-3">
          {markets.map(market => (
-           <MarketCardOptimized market={market} />
+           <MarketCardWithOracle market={market} />
          ))}
        </div>
+     </UMAOracleProvider>
    </MarketDataProvider>
  );
}
```

### æ­¥éª¤2: ä¿®æ”¹è¯¦æƒ…é¡µ

```typescript
// app/market/[marketId]/page.tsx
import { UMAOracleStatus } from '@/components/UMAOracleStatus';

export default function MarketDetailPage() {
  return (
    <MarketDataProvider marketIds={[marketId]}>
      <UMAOracleProvider marketIds={[marketId]}>
        <div className="grid grid-cols-3">
          <div className="col-span-2">
            {/* å¸‚åœºä¿¡æ¯ */}
          </div>
          <div>
            <OrderBookOptimized marketId={marketId} />
            
            {/* ğŸ”¥ æ·»åŠ  UMA çŠ¶æ€é¢æ¿ */}
            <UMAOracleStatus 
              marketId={marketId}
              questionId={market.question_id}
              showActions={true}
            />
          </div>
        </div>
      </UMAOracleProvider>
    </MarketDataProvider>
  );
}
```

---

## ğŸ“Š æ•°æ®åº“å­—æ®µè¯´æ˜

### markets è¡¨å­—æ®µ

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|-----|------|------|
| `end_date` | TIMESTAMPTZ | å¸‚åœºæˆªæ­¢æ—¶é—´ |
| `settlement_requested_at` | TIMESTAMPTZ | è¯·æ±‚ç»“ç®—æ—¶é—´ |
| `settlement_resolved_at` | TIMESTAMPTZ | æœ€ç»ˆç»“ç®—æ—¶é—´ |
| `settlement_result` | VARCHAR(10) | ç»“ç®—ç»“æœï¼ˆYES/NO/INVALIDï¼‰ |

### çŠ¶æ€åˆ¤æ–­é€»è¾‘

```typescript
// åˆ¤æ–­å¸‚åœºçŠ¶æ€
const now = new Date();
const endDate = new Date(market.end_date);
const requestedAt = market.settlement_requested_at 
  ? new Date(market.settlement_requested_at) 
  : null;

let state: OracleState;

if (market.settlement_result) {
  state = 'resolved';
} else if (requestedAt) {
  const challengeEnd = new Date(requestedAt.getTime() + 2 * 60 * 60 * 1000);
  state = now > challengeEnd ? 'proposed' : 'requested';
} else if (now > endDate) {
  state = 'ended';
} else {
  state = 'active';
}
```

---

## ğŸ”® UMA å·¥ä½œæµç¨‹è¯¦è§£

### å®Œæ•´æµç¨‹

```
1ï¸âƒ£ åˆ›å»ºå¸‚åœº
   â”œâ”€ è°ƒç”¨ adapter.initialize()
   â”œâ”€ è®¾ç½®æˆªæ­¢æ—¶é—´
   â””â”€ è®¾ç½®å¥–åŠ±é‡‘é¢

2ï¸âƒ£ äº¤æ˜“é˜¶æ®µ (Active)
   â”œâ”€ ç”¨æˆ·è‡ªç”±äº¤æ˜“
   â”œâ”€ ä»·æ ¼åæ˜ å¸‚åœºé¢„æœŸ
   â””â”€ ç­‰å¾…å¸‚åœºåˆ°æœŸ

3ï¸âƒ£ å¸‚åœºåˆ°æœŸ (Ended)
   â”œâ”€ åœæ­¢äº¤æ˜“
   â”œâ”€ ç­‰å¾…ç»“ç®—è¯·æ±‚
   â””â”€ ä»»ä½•äººéƒ½å¯ä»¥å‘èµ·ç»“ç®—

4ï¸âƒ£ è¯·æ±‚ç»“ç®— (Requested)
   â”œâ”€ è°ƒç”¨ adapter.requestOraclePrice()
   â”œâ”€ ææ¡ˆè€…æäº¤ç»“æœï¼ˆéœ€ä¿è¯é‡‘ï¼‰
   â””â”€ è¿›å…¥2å°æ—¶æŒ‘æˆ˜æœŸ

5ï¸âƒ£ æŒ‘æˆ˜æœŸ (Challenge Period)
   â”œâ”€ ä»»ä½•äººå¯ä»¥äº‰è®®ç»“æœ
   â”œâ”€ äº‰è®®è€…ä¹Ÿéœ€è¦è´¨æŠ¼ä¿è¯é‡‘
   â”œâ”€ å¦‚æœæ— äº‰è®®ï¼Œ2å°æ—¶åè‡ªåŠ¨é€šè¿‡
   â””â”€ å¦‚æœæœ‰äº‰è®®ï¼Œè¿›å…¥ UMA æŠ•ç¥¨

6ï¸âƒ£ æœ€ç»ˆç¡®è®¤ (Proposed)
   â”œâ”€ æŒ‘æˆ˜æœŸå·²è¿‡
   â”œâ”€ æ— äº‰è®®æˆ–æŠ•ç¥¨å®Œæˆ
   â””â”€ è°ƒç”¨ adapter.resolve() æœ€ç»ˆç¡®è®¤

7ï¸âƒ£ ç»“ç®—å®Œæˆ (Resolved)
   â”œâ”€ ç»“æœå†™å…¥åŒºå—é“¾
   â”œâ”€ ç”¨æˆ·å¯ä»¥èµå›å¥–åŠ±
   â””â”€ è°ƒç”¨ ctf.redeemPositions()
```

---

## ğŸ’¡ åœ¨å¡ç‰‡ä¸­çš„å±•ç¤º

### ä¸åŒçŠ¶æ€çš„å¡ç‰‡å¤–è§‚

#### 1. äº¤æ˜“ä¸­ï¼ˆActiveï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç‰¹æ–¯æ‹‰Q4äº¤ä»˜é‡           â”‚
â”‚ ğŸ”¥æ¨è ğŸŸ¢äº¤æ˜“ä¸­         â”‚  â† UMAçŠ¶æ€å¾½ç« 
â”‚                         â”‚
â”‚ 65% æ¦‚ç‡                â”‚
â”‚ YES 65Â¢  NO 35Â¢         â”‚
â”‚ ğŸ’°$12.5K  ğŸ‘¥42äºº        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. å¾…ç»“ç®—ï¼ˆEndedï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç‰¹æ–¯æ‹‰Q4äº¤ä»˜é‡           â”‚
â”‚ ğŸ”¥æ¨è ğŸŸ¡å¾…ç»“ç®—         â”‚  â† çŠ¶æ€æ”¹å˜
â”‚                         â”‚
â”‚ 65% æœ€ç»ˆæ¦‚ç‡            â”‚
â”‚ [å¸‚åœºå·²ç»“æŸï¼Œç­‰å¾…ç»“ç®—]   â”‚  â† æ›¿æ¢äº¤æ˜“æŒ‰é’®
â”‚ ğŸ’°$12.5K  ğŸ‘¥42äºº        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3. æŒ‘æˆ˜æœŸï¼ˆRequestedï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç‰¹æ–¯æ‹‰Q4äº¤ä»˜é‡           â”‚
â”‚ ğŸ”¥æ¨è â³æŒ‘æˆ˜æœŸä¸­        â”‚  â† çŠ¶æ€å¾½ç« 
â”‚                         â”‚
â”‚ 65% ææ¡ˆç»“æœ            â”‚
â”‚ [â³ 1:45:30 å‰©ä½™]       â”‚  â† å€’è®¡æ—¶
â”‚ ğŸ’°$12.5K  ğŸ‘¥42äºº        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4. å·²ç»“ç®—ï¼ˆResolvedï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç‰¹æ–¯æ‹‰Q4äº¤ä»˜é‡           â”‚
â”‚ ğŸ”¥æ¨è âœ…ç»“æœ: YES      â”‚  â† ç»“ç®—ç»“æœ
â”‚                         â”‚
â”‚ 65% æœ€ç»ˆæ¦‚ç‡            â”‚
â”‚ [ğŸ’° èµå›å¥–åŠ±]           â”‚  â† èµå›æŒ‰é’®
â”‚ ğŸ’°$12.5K  ğŸ‘¥42äºº        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“– è¯¦ç»†ç»„ä»¶æ–‡æ¡£

### UMAOracleProvider

**Props:**
```typescript
{
  children: ReactNode;
  marketIds: number[];  // éœ€è¦ç›‘æ§çš„å¸‚åœºIDåˆ—è¡¨
}
```

**æä¾›çš„æ•°æ®:**
```typescript
{
  getOracleStatus: (marketId: number) => OracleStatus | null;
  loading: boolean;
  refresh: () => Promise<void>;
}
```

### useOracleStatus Hook

```typescript
const { status, loading, refresh } = useOracleStatus(marketId);

// status åŒ…å«ï¼š
{
  state: 'active' | 'ended' | 'requested' | 'proposed' | 'resolved',
  settlementDeadline?: Date,
  challengePeriodEnd?: Date,
  finalResult?: 'YES' | 'NO' | 'INVALID',
  canSettle: boolean,
  canResolve: boolean,
  canRedeem: boolean,
  requestedAt?: Date,
  resolvedAt?: Date
}
```

---

## ğŸ¨ UI ç»„ä»¶

### 1. UMAOracleStatusï¼ˆå®Œæ•´çŠ¶æ€é¢æ¿ï¼‰

**ç”¨äºè¯¦æƒ…é¡µï¼Œæ˜¾ç¤ºå®Œæ•´ä¿¡æ¯å’Œæ“ä½œæŒ‰é’®**

```typescript
<UMAOracleStatus 
  marketId={1}
  questionId="question-id"
  showActions={true}    // æ˜¾ç¤º"è¯·æ±‚ç»“ç®—"ç­‰æŒ‰é’®
  compact={false}       // å®Œæ•´æ¨¡å¼
/>
```

æ˜¾ç¤ºå†…å®¹ï¼š
- âœ… å½“å‰çŠ¶æ€ï¼ˆé¢œè‰²ç¼–ç ï¼‰
- âœ… å€’è®¡æ—¶ï¼ˆæˆªæ­¢æ—¶é—´æˆ–æŒ‘æˆ˜æœŸï¼‰
- âœ… æ“ä½œæŒ‰é’®ï¼ˆæ ¹æ®çŠ¶æ€æ˜¾ç¤ºï¼‰
- âœ… æ—¶é—´çº¿ï¼ˆå…³é”®äº‹ä»¶æ—¶é—´ï¼‰

### 2. OracleStatusBadgeï¼ˆçŠ¶æ€å¾½ç« ï¼‰

**ç”¨äºå¡ç‰‡ï¼Œæ˜¾ç¤ºç´§å‡‘å¾½ç« **

```typescript
<OracleStatusBadge marketId={1} />
```

æ˜¾ç¤ºæ ·å¼ï¼š
- ğŸŸ¢ äº¤æ˜“ä¸­
- ğŸŸ¡ å¾…ç»“ç®—
- â³ æŒ‘æˆ˜æœŸ
- âœ… å·²ç»“ç®—

### 3. OracleCountdownï¼ˆå€’è®¡æ—¶ï¼‰

**ç”¨äºè¯¦æƒ…é¡µï¼Œæ˜¾ç¤ºé†’ç›®å€’è®¡æ—¶**

```typescript
<OracleCountdown marketId={1} />
```

æ˜¾ç¤ºï¼š
- å¤§å­—å·å€’è®¡æ—¶ï¼š`1:45:30`
- è¿›åº¦æ¡å¯è§†åŒ–
- çŠ¶æ€è¯´æ˜æ–‡å­—

---

## ğŸ”§ é…ç½®è¦æ±‚

### ç¯å¢ƒå˜é‡

```bash
# .env.local
NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=xxx

# UMA ç›¸å…³ï¼ˆå¦‚æœéœ€è¦é“¾ä¸Šæ“ä½œï¼‰
NEXT_PUBLIC_RPC_URL=https://polygon-amoy-bor-rpc.publicnode.com
NEXT_PUBLIC_UMA_ADAPTER_ADDRESS=0x...
```

### æ•°æ®åº“é…ç½®

```sql
-- å¯ç”¨ Realtime
ALTER TABLE markets REPLICA IDENTITY FULL;

-- æ·»åŠ å­—æ®µï¼ˆå¦‚æœæ²¡æœ‰ï¼‰
ALTER TABLE markets 
ADD COLUMN IF NOT EXISTS settlement_requested_at TIMESTAMPTZ,
ADD COLUMN IF NOT EXISTS settlement_resolved_at TIMESTAMPTZ,
ADD COLUMN IF NOT EXISTS settlement_result VARCHAR(10);
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### æ‰¹é‡æŸ¥è¯¢ UMA çŠ¶æ€

```typescript
// UMAOracleContext å†…éƒ¨å®ç°
const { data: markets } = await supabase
  .from('markets')
  .select(`
    id,
    end_date,
    settlement_requested_at,
    settlement_resolved_at,
    settlement_result
  `)
  .in('id', marketIds);

// ä¸€æ¬¡æŸ¥è¯¢è·å–æ‰€æœ‰å¸‚åœºçš„ UMA çŠ¶æ€
// 100ä¸ªå¸‚åœº = 1æ¬¡æŸ¥è¯¢
```

### å®æ—¶ç›‘å¬ç»“ç®—å˜åŒ–

```typescript
// å•ä¸€è®¢é˜…ç›‘å¬æ‰€æœ‰å¸‚åœº
supabase
  .channel('oracle_status_updates')
  .on('postgres_changes', {
    event: 'UPDATE',
    table: 'markets',
    filter: `id=in.(${marketIds.join(',')})`
  })
  .subscribe();
```

---

## ğŸ¯ å®Œæ•´ä¼˜åŒ–æ€»ç»“

### ä¸‰å±‚ä¼˜åŒ–

```
ç¬¬1å±‚ï¼šMarketDataProvider (å·²å®Œæˆ)
â”œâ”€ å®æ—¶ä»·æ ¼ã€äº¤æ˜“é‡ã€å‚ä¸äººæ•°
â”œâ”€ å®Œæ•´è®¢å•ç°¿æ•°æ®
â””â”€ æ€§èƒ½æå‡ï¼š80%

ç¬¬2å±‚ï¼šUMAOracleProvider (æœ¬æ¬¡æ–°å¢)
â”œâ”€ UMA é¢„è¨€æœºçŠ¶æ€
â”œâ”€ ç»“ç®—å€’è®¡æ—¶
â””â”€ æ“ä½œçŠ¶æ€åˆ¤æ–­

ç¬¬3å±‚ï¼šç»„ä»¶å±‚
â”œâ”€ MarketCardWithOracle (é›†æˆå±•ç¤º)
â”œâ”€ OrderBookOptimized (è®¢å•ç°¿)
â””â”€ UMAOracleStatus (çŠ¶æ€é¢æ¿)
```

### æ•´ä½“æ€§èƒ½

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|-----|--------|--------|------|
| **æ•°æ®æŸ¥è¯¢** | 5æ¬¡/å¡ç‰‡ | 1æ¬¡/æ‰¹é‡ | âš¡ 99% |
| **Realtimeè®¢é˜…** | 5ä¸ª/å¡ç‰‡ | 3ä¸ª/å…¨å±€ | âš¡ 99% |
| **UMAçŠ¶æ€æŸ¥è¯¢** | æ¯æ¬¡è½®è¯¢ | æ‰¹é‡+å®æ—¶ | âš¡ 90% |
| **ç”¨æˆ·ä½“éªŒ** | å·® | ä¼˜ç§€ | âœ… æ”¹å–„ |

---

## ğŸ› æ•…éšœæ’æŸ¥

### Q1: UMA çŠ¶æ€ä¸æ˜¾ç¤º

**åŸå› **: æ•°æ®åº“ç¼ºå°‘å­—æ®µ

**è§£å†³**:
```sql
ALTER TABLE markets 
ADD COLUMN IF NOT EXISTS settlement_requested_at TIMESTAMPTZ,
ADD COLUMN IF NOT EXISTS settlement_resolved_at TIMESTAMPTZ,
ADD COLUMN IF NOT EXISTS settlement_result VARCHAR(10);
```

### Q2: å€’è®¡æ—¶ä¸å·¥ä½œ

**åŸå› **: end_date å­—æ®µä¸ºç©º

**è§£å†³**:
```sql
UPDATE markets 
SET end_date = '2025-12-31 23:59:59'
WHERE end_date IS NULL;
```

### Q3: ç»“ç®—æŒ‰é’®ç‚¹å‡»æ— æ•ˆ

**åŸå› **: é’±åŒ…æœªè¿æ¥

**è§£å†³**:
- ç¡®ä¿è°ƒç”¨äº† `polymarket.connect()`
- æ£€æŸ¥ questionId æ˜¯å¦æ­£ç¡®

---

## ğŸŠ æ€»ç»“

**UMA é¢„è¨€æœºé›†æˆå·²å®Œæˆï¼**

### å·²å®ç°
- âœ… 5ä¸ªçŠ¶æ€ç›‘æ§
- âœ… å®æ—¶å€’è®¡æ—¶
- âœ… æ“ä½œæŒ‰é’®
- âœ… çŠ¶æ€å¾½ç« 

### æ€§èƒ½
- âš¡ æ‰¹é‡æŸ¥è¯¢
- âš¡ å®æ—¶ç›‘å¬
- âš¡ é›¶é¢å¤–è®¢é˜…

### ä½¿ç”¨
- ğŸ“– 3ç§ä½¿ç”¨æ–¹å¼
- ğŸ“– å®Œæ•´æ–‡æ¡£
- ğŸ“– ç¤ºä¾‹é¡µé¢

**ç«‹å³ä½“éªŒ**:
```bash
npm run dev
http://localhost:3000/markets/with-oracle
```






















