# é’±åŒ…è¿æ¥ç»„ä»¶è¯´æ˜

## é¡¹ç›®ä¸­çš„é’±åŒ…è¿æ¥ç»„ä»¶

é¡¹ç›®ä¸­ä¸»è¦æœ‰ **2 ä¸ªé’±åŒ…è¿æ¥ç»„ä»¶**ï¼Œå®ƒä»¬åœ¨ä¸åŒçš„åœ°æ–¹ä½¿ç”¨ï¼š

### 1. `WalletConnect` ç»„ä»¶ï¼ˆä¸»è¦ä½¿ç”¨ï¼‰

**æ–‡ä»¶ä½ç½®**ï¼š`components/WalletConnect.tsx`

**æŠ€æœ¯æ ˆ**ï¼šåŸºäº RainbowKit çš„ `ConnectButton.Custom`

**ä½¿ç”¨ä½ç½®**ï¼š
- âœ… **å¯¼èˆªæ ** (`components/Navbar.tsx`) - ä¸»è¦ä½¿ç”¨
- âœ… **äº¤æ˜“å¼¹çª—** (`components/trading/CompactTradeModal.tsx`) - ä½œä¸ºå¤‡ç”¨

**ç‰¹ç‚¹**ï¼š
- ä½¿ç”¨ RainbowKit çš„ `ConnectButton.Custom`ï¼Œæ”¯æŒå¤šç§é’±åŒ…
- è‡ªåŠ¨å¤„ç†ç½‘ç»œåˆ‡æ¢ã€è´¦æˆ·æ˜¾ç¤ºç­‰
- æ”¯æŒ MetaMaskã€WalletConnectã€Coinbase Wallet ç­‰
- æ˜¾ç¤ºç½‘ç»œå›¾æ ‡ã€è´¦æˆ·åœ°å€ã€ä½™é¢ç­‰ä¿¡æ¯

**ä»£ç ç¤ºä¾‹**ï¼š
```typescript
// components/WalletConnect.tsx
import { ConnectButton } from '@rainbow-me/rainbowkit';

export default function WalletConnect() {
  return (
    <ConnectButton.Custom>
      {({ account, chain, openConnectModal, ... }) => {
        // è‡ªå®šä¹‰ UI
      }}
    </ConnectButton.Custom>
  );
}
```

**UI çŠ¶æ€**ï¼š
- **æœªè¿æ¥**ï¼šæ˜¾ç¤º"è¿æ¥é’±åŒ…"æŒ‰é’®ï¼ˆç¥ç€è‰²ï¼‰
- **å·²è¿æ¥**ï¼šæ˜¾ç¤ºç½‘ç»œåˆ‡æ¢æŒ‰é’® + è´¦æˆ·ä¿¡æ¯ï¼ˆç»¿è‰²ï¼‰
- **ç½‘ç»œä¸æ”¯æŒ**ï¼šæ˜¾ç¤º"åˆ‡æ¢ç½‘ç»œ"æŒ‰é’®ï¼ˆçº¢è‰²ï¼‰

---

### 2. `ConnectWallet` ç»„ä»¶ï¼ˆå¤‡ç”¨ï¼‰

**æ–‡ä»¶ä½ç½®**ï¼š`components/wallet/ConnectWallet.tsx`

**æŠ€æœ¯æ ˆ**ï¼šç›´æ¥ä½¿ç”¨ ethers.js + MetaMask

**ä½¿ç”¨ä½ç½®**ï¼š
- âš ï¸ **äº¤æ˜“é¡µé¢** (`app/trade/[marketId]/page.tsx`) - è¾ƒå°‘ä½¿ç”¨

**ç‰¹ç‚¹**ï¼š
- ç›´æ¥ä½¿ç”¨ `ethers.providers.Web3Provider` å’Œ `window.ethereum`
- åªæ”¯æŒ MetaMask
- è‡ªå·±ç®¡ç†è¿æ¥çŠ¶æ€ã€ä½™é¢ã€ç½‘ç»œç­‰
- åŒ…å«ç½‘ç»œåˆ‡æ¢åŠŸèƒ½ï¼ˆåˆ‡æ¢åˆ° Amoy æµ‹è¯•ç½‘ï¼‰

**ä»£ç ç¤ºä¾‹**ï¼š
```typescript
// components/wallet/ConnectWallet.tsx
export function ConnectWallet() {
  const connectWallet = async () => {
    const provider = new ethers.providers.Web3Provider(window.ethereum);
    await provider.send("eth_requestAccounts", []);
    // ...
  };
}
```

**UI çŠ¶æ€**ï¼š
- **æœªè¿æ¥**ï¼šæ˜¾ç¤º"ğŸ¦Š è¿æ¥é’±åŒ…"æŒ‰é’®ï¼ˆè“è‰²ï¼‰
- **å·²è¿æ¥**ï¼šæ˜¾ç¤ºä½™é¢ã€ç½‘ç»œã€è´¦æˆ·åœ°å€

---

## é’±åŒ…è¿æ¥æ¶æ„

### å…¨å±€ Provider

**ä½ç½®**ï¼š`app/client-layout.tsx`

```typescript
<WagmiProviderWrapper>
  <WalletProvider>  // app/provider-wagmi.tsx
    {children}
  </WalletProvider>
</WagmiProviderWrapper>
```

**ä½œç”¨**ï¼š
- æä¾›å…¨å±€é’±åŒ…çŠ¶æ€ç®¡ç†
- æ‰€æœ‰ç»„ä»¶é€šè¿‡ `useWallet()` hook è®¿é—®é’±åŒ…çŠ¶æ€
- åŸºäº Wagmi + RainbowKit

### Hook ä½¿ç”¨

**ä¸»è¦ Hook**ï¼š`useWallet()` from `@/app/provider-wagmi`

**ä½¿ç”¨ä½ç½®**ï¼š
- `components/trading/OrderForm.tsx`
- `components/trading/CompactTradeModal.tsx`
- `components/trading/QuickTradeModal.tsx`

**ç¤ºä¾‹**ï¼š
```typescript
import { useWallet } from '@/app/provider-wagmi';

const { address, isConnected, connectWallet } = useWallet();
```

---

## ç»„ä»¶ä½¿ç”¨æƒ…å†µæ€»ç»“

| ç»„ä»¶ | ä½ç½® | æŠ€æœ¯æ ˆ | ä½¿ç”¨é¢‘ç‡ | çŠ¶æ€ |
|------|------|--------|----------|------|
| `WalletConnect` | Navbar, CompactTradeModal | RainbowKit | â­â­â­â­â­ | âœ… ä¸»è¦ä½¿ç”¨ |
| `ConnectWallet` | trade é¡µé¢ | ethers.js | â­ | âš ï¸ è¾ƒå°‘ä½¿ç”¨ |
| `useWallet()` Hook | æ‰€æœ‰äº¤æ˜“ç»„ä»¶ | Wagmi | â­â­â­â­â­ | âœ… ä¸»è¦ä½¿ç”¨ |

---

## æ¨èä½¿ç”¨æ–¹å¼

### âœ… æ¨èï¼šä½¿ç”¨ `WalletConnect` ç»„ä»¶

**åŸå› **ï¼š
1. åŸºäº RainbowKitï¼Œæ”¯æŒå¤šç§é’±åŒ…
2. UI ç»Ÿä¸€ï¼Œç”¨æˆ·ä½“éªŒå¥½
3. è‡ªåŠ¨å¤„ç†ç½‘ç»œåˆ‡æ¢ã€è´¦æˆ·ç®¡ç†ç­‰
4. ä¸å…¨å±€ Provider é›†æˆè‰¯å¥½

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```typescript
import WalletConnect from '@/components/WalletConnect';

// åœ¨ç»„ä»¶ä¸­ç›´æ¥ä½¿ç”¨
<WalletConnect />
```

### âœ… æ¨èï¼šä½¿ç”¨ `useWallet()` Hook

**åŸå› **ï¼š
1. ç»Ÿä¸€çš„é’±åŒ…çŠ¶æ€ç®¡ç†
2. é¿å…é‡å¤è¿æ¥è¯·æ±‚
3. ä¸å…¨å±€ Provider é›†æˆ

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```typescript
import { useWallet } from '@/app/provider-wagmi';

function MyComponent() {
  const { address, isConnected, connectWallet } = useWallet();
  
  if (!isConnected) {
    return <button onClick={connectWallet}>è¿æ¥é’±åŒ…</button>;
  }
  
  return <div>å·²è¿æ¥: {address}</div>;
}
```

### âš ï¸ ä¸æ¨èï¼šç›´æ¥ä½¿ç”¨ `ConnectWallet` ç»„ä»¶

**åŸå› **ï¼š
1. åªæ”¯æŒ MetaMask
2. è‡ªå·±ç®¡ç†çŠ¶æ€ï¼Œå®¹æ˜“äº§ç”Ÿå†²çª
3. ä¸å…¨å±€ Provider ä¸ç»Ÿä¸€

---

## ä¿®å¤å»ºè®®

### 1. ç»Ÿä¸€ä½¿ç”¨ `WalletConnect` ç»„ä»¶

å°† `app/trade/[marketId]/page.tsx` ä¸­çš„ `ConnectWallet` æ›¿æ¢ä¸º `WalletConnect`ï¼š

```typescript
// ä¿®æ”¹å‰
import { ConnectWallet } from '@/components/wallet/ConnectWallet';
<ConnectWallet />

// ä¿®æ”¹å
import WalletConnect from '@/components/WalletConnect';
<WalletConnect />
```

### 2. ç»Ÿä¸€ä½¿ç”¨ `useWallet()` Hook

æ‰€æœ‰éœ€è¦é’±åŒ…çŠ¶æ€çš„ç»„ä»¶éƒ½åº”è¯¥ä½¿ç”¨ `useWallet()` hookï¼Œè€Œä¸æ˜¯è‡ªå·±ç®¡ç†è¿æ¥ã€‚

---

## ç›¸å…³æ–‡ä»¶

- `components/WalletConnect.tsx` - ä¸»è¦é’±åŒ…è¿æ¥ç»„ä»¶ï¼ˆRainbowKitï¼‰
- `components/wallet/ConnectWallet.tsx` - å¤‡ç”¨é’±åŒ…è¿æ¥ç»„ä»¶ï¼ˆethers.jsï¼‰
- `app/provider-wagmi.tsx` - å…¨å±€é’±åŒ… Provider
- `app/client-layout.tsx` - å…¨å±€å¸ƒå±€ï¼ŒåŒ…å« Provider
- `components/Navbar.tsx` - å¯¼èˆªæ ï¼Œä½¿ç”¨ WalletConnect
- `components/trading/CompactTradeModal.tsx` - äº¤æ˜“å¼¹çª—ï¼Œä½¿ç”¨ WalletConnect

