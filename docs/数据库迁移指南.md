# ğŸ”§ æ•°æ®åº“è¿ç§»æŒ‡å— - æ·»åŠ  orders è¡¨å­—æ®µ

## é—®é¢˜è¯´æ˜

äº¤æ˜“å¤±è´¥é”™è¯¯ï¼š`Could not find the 'condition_id' column of 'orders' in the schema cache`

è¿™æ˜¯å› ä¸º `orders` è¡¨ç¼ºå°‘é“¾ä¸Šäº¤æ˜“ç›¸å…³çš„å­—æ®µã€‚

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ³• 1: åœ¨ Supabase Dashboard ä¸­æ‰§è¡Œ SQLï¼ˆæ¨èï¼‰

1. **æ‰“å¼€ Supabase Dashboard**
   - è®¿é—® https://supabase.com/dashboard
   - é€‰æ‹©ä½ çš„é¡¹ç›®

2. **è¿›å…¥ SQL Editor**
   - ç‚¹å‡»å·¦ä¾§èœå• "SQL Editor"
   - ç‚¹å‡» "New query"

3. **æ‰§è¡Œä»¥ä¸‹ SQL**

```sql
-- ğŸ”§ ä¸º orders è¡¨æ·»åŠ é“¾ä¸Šäº¤æ˜“ç›¸å…³å­—æ®µ

ALTER TABLE orders ADD COLUMN IF NOT EXISTS condition_id TEXT;
ALTER TABLE orders ADD COLUMN IF NOT EXISTS ctf_signature TEXT;
ALTER TABLE orders ADD COLUMN IF NOT EXISTS ctf_order_data JSONB;

-- éªŒè¯å­—æ®µå·²æ·»åŠ 
SELECT 
  column_name,
  data_type
FROM information_schema.columns
WHERE table_name = 'orders'
  AND column_name IN ('condition_id', 'ctf_signature', 'ctf_order_data');
```

4. **ç‚¹å‡» "Run" æ‰§è¡Œ**

5. **éªŒè¯ç»“æœ**
   - å¦‚æœçœ‹åˆ°æŸ¥è¯¢ç»“æœæ˜¾ç¤ºäº† 3 ä¸ªå­—æ®µï¼Œè¯´æ˜è¿ç§»æˆåŠŸ

### æ–¹æ³• 2: ä½¿ç”¨æ£€æŸ¥è„šæœ¬éªŒè¯

æ‰§è¡Œæ£€æŸ¥è„šæœ¬éªŒè¯å­—æ®µæ˜¯å¦å·²æ·»åŠ ï¼š

```bash
node scripts/check-orders-table-schema.js
```

è„šæœ¬ä¼šæ£€æŸ¥æ‰€æœ‰å¿…éœ€å­—æ®µï¼Œå¹¶æ˜¾ç¤ºç¼ºå¤±çš„å­—æ®µã€‚

### æ–¹æ³• 3: ç›´æ¥å¤åˆ¶ SQL æ–‡ä»¶å†…å®¹

ä½ è¿˜å¯ä»¥ç›´æ¥å¤åˆ¶ `database/add-orders-ctf-columns.sql` æ–‡ä»¶çš„å†…å®¹åˆ° Supabase SQL Editor ä¸­æ‰§è¡Œã€‚

## éœ€è¦æ·»åŠ çš„å­—æ®µ

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| `condition_id` | TEXT | å¸‚åœºçš„æ¡ä»¶ IDï¼ˆç”¨äºé“¾ä¸Šäº¤æ˜“ï¼‰ |
| `ctf_signature` | TEXT | CTF Exchange è®¢å•ç­¾å |
| `ctf_order_data` | JSONB | CTF Exchange è®¢å•æ•°æ®ï¼ˆJSON æ ¼å¼ï¼‰ |

## éªŒè¯è¿ç§»æˆåŠŸ

è¿ç§»æˆåŠŸåï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š

1. âœ… æ­£å¸¸åˆ›å»ºè®¢å•ï¼ˆä¸ä¼šå†å‡ºç° `condition_id` åˆ—ä¸å­˜åœ¨çš„é”™è¯¯ï¼‰
2. âœ… è®¢å•å¯ä»¥åŒ…å«é“¾ä¸Šäº¤æ˜“ç›¸å…³ä¿¡æ¯
3. âœ… é“¾ä¸Šäº¤æ˜“åŠŸèƒ½å¯ä»¥æ­£å¸¸å·¥ä½œ

## ç›¸å…³æ–‡ä»¶

- `database/add-orders-ctf-columns.sql` - SQL è¿ç§»è„šæœ¬
- `scripts/check-orders-table-schema.js` - æ£€æŸ¥è¡¨ç»“æ„çš„è„šæœ¬
- `scripts/add-orders-columns-supabase.js` - è‡ªåŠ¨è¿ç§»è„šæœ¬ï¼ˆéœ€è¦æ‰‹åŠ¨æ‰§è¡Œï¼‰

## æ³¨æ„äº‹é¡¹

- âš ï¸ æ‰§è¡Œ SQL å‰è¯·ç¡®ä¿å¤‡ä»½æ•°æ®åº“ï¼ˆå¦‚æœç”Ÿäº§ç¯å¢ƒï¼‰
- âœ… ä½¿ç”¨ `IF NOT EXISTS` å¯ä»¥å®‰å…¨åœ°é‡å¤æ‰§è¡Œï¼ˆä¸ä¼šæŠ¥é”™ï¼‰
- ğŸ’¡ å¦‚æœå­—æ®µå·²å­˜åœ¨ï¼ŒSQL ä¸ä¼šæŠ¥é”™ï¼Œåªæ˜¯è·³è¿‡


