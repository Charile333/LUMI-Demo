# 🗄️ 创建订单簿表 - 3分钟完成

---

## 🚀 快速执行（复制粘贴即可）

### 第 1 步：打开 Supabase SQL Editor

1. 访问: https://supabase.com/dashboard
2. 选择您的 **LUMI 项目**
3. 左侧菜单 → **SQL Editor**
4. 点击 **"New query"**

---

### 第 2 步：复制 SQL 脚本

打开文件：**`创建订单簿表_一键执行.sql`**

复制全部内容（Ctrl+A, Ctrl+C）

---

### 第 3 步：粘贴并执行

1. 在 SQL Editor 中粘贴（Ctrl+V）
2. 点击右下角 **"Run"** 按钮（或按 Ctrl+Enter）
3. 等待执行完成（约 5 秒）

---

### 第 4 步：验证创建成功

应该看到输出：
```
✅ 3 行结果:
orderbooks    1
orders        0  
market_states 1
```

---

## ✅ 创建的表

执行后您将拥有：

### 1. **orderbooks** 表
- 存储每个市场的订单簿
- 包含 bids（买单）和 asks（卖单）
- **Realtime 已自动启用** ✅

### 2. **orders** 表  
- 存储所有用户订单
- 支持 buy/sell
- **Realtime 已自动启用** ✅

### 3. **market_states** 表
- 存储市场激活状态
- 追踪感兴趣用户数
- **Realtime 已自动启用** ✅

---

## 🎯 立即测试

执行完 SQL 后：

### 1. 查看表

在 Supabase:
- Table Editor → 应该看到 3 个新表
- 每个表右上角应该有 **"Disable Realtime"** 按钮（说明已启用）

### 2. 测试 Realtime

启动开发服务器：
```bash
npm run dev
```

访问测试页面：
```
http://localhost:3000/test-realtime
```

应该看到：
- 🟢 订单簿 Realtime: 已连接 ✅
- 显示订单簿数据（bids 和 asks）
- 显示市场状态

---

## 💡 测试实时更新

1. 保持 `test-realtime` 页面打开
2. 在 Supabase Table Editor 中打开 `orderbooks` 表
3. 修改 market_id=1 的数据（比如改变 bids 或 asks）
4. 点击 Save
5. **页面应该在 1 秒内自动更新！** ⚡

---

## 🐛 如果出现错误

### 错误：表已存在
```sql
-- 如果表已存在但有问题，先删除
DROP TABLE IF EXISTS orderbooks CASCADE;
DROP TABLE IF EXISTS orders CASCADE;
DROP TABLE IF EXISTS market_states CASCADE;

-- 然后重新执行完整脚本
```

### 错误：权限不足
- 确保您是项目的 Owner 或 Admin

---

**现在去 Supabase SQL Editor 执行 `创建订单簿表_一键执行.sql` 吧！** 🚀



