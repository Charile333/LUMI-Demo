# ğŸ“Š é»‘å¤©é¹…ç³»ç»Ÿ - çœŸå®æ•°æ®è¯´æ˜

## âœ… æ‰€æœ‰æ•°æ®æ¥æº

### 1. å®æ—¶è­¦æŠ¥æµ
**æ•°æ®æ¥æº**: WebSocketå®æ—¶æ¨é€  
**ç«¯ç‚¹**: `ws://localhost:3000/ws/alerts`  
**æ›´æ–°é¢‘ç‡**: å®æ—¶ï¼ˆæ¯2ç§’æ£€æŸ¥æ•°æ®åº“ï¼‰  
**æ•°æ®åº“**: `duolume-master/utils/database/app.db`

```typescript
// æ•°æ®æµå‘
Binance API â†’ main.py (æ£€æµ‹) â†’ SQLite â†’ server.js (ç›‘æ§) â†’ WebSocket â†’ å‰ç«¯ç•Œé¢
```

**åŒ…å«å­—æ®µ**:
- `symbol` - äº¤æ˜“å¯¹ (å¦‚: BTCUSDT, ETHUSDT)
- `message` - è­¦æŠ¥æ¶ˆæ¯
- `timestamp` - æ—¶é—´æˆ³
- `severity` - ä¸¥é‡ç¨‹åº¦ (critical/high/medium)
- `details.price_change` - ä»·æ ¼å˜åŒ–ç™¾åˆ†æ¯”
- `details.current_price` - å½“å‰ä»·æ ¼
- `details.previous_price` - ä¹‹å‰ä»·æ ¼

---

### 2. å†å²é—ªå´©äº‹ä»¶
**æ•°æ®æ¥æº**: REST API  
**ç«¯ç‚¹**: `GET /api/alerts/crash-events`  
**æŸ¥è¯¢é€»è¾‘**: ä»æ•°æ®åº“æŸ¥è¯¢ `severity='critical'` çš„è­¦æŠ¥ï¼ŒæŒ‰æ—¥æœŸåˆ†ç»„

**SQL æŸ¥è¯¢**:
```sql
SELECT 
  symbol,
  timestamp,
  message,
  details,
  severity,
  DATE(timestamp) as event_date
FROM alerts 
WHERE severity = 'critical'
ORDER BY timestamp DESC 
LIMIT 50
```

**å¤„ç†é€»è¾‘**:
1. æŸ¥æ‰¾æ‰€æœ‰ä¸¥é‡è­¦æŠ¥
2. æŒ‰ `symbol + date` å»é‡
3. è®¡ç®—æŒç»­æ—¶é—´ï¼ˆåŸºäºåŒä¸€å¤©çš„è­¦æŠ¥æ•°é‡ï¼‰
4. æå–ä»·æ ¼å˜åŒ–æ•°æ®
5. è¿”å›å‰10ä¸ªæœ€ä¸¥é‡çš„äº‹ä»¶

**è¿”å›å­—æ®µ**:
- `id` - äº‹ä»¶ID (symbol_date)
- `date` - äº‹ä»¶æ—¥æœŸ
- `asset` - èµ„äº§åç§° (BTC/USDT)
- `crashPercentage` - å´©ç›˜ç™¾åˆ†æ¯”
- `duration` - æŒç»­æ—¶é—´
- `description` - äº‹ä»¶æè¿°
- `details` - è¯¦ç»†ä»·æ ¼æ•°æ®

---

### 3. ç³»ç»Ÿç»Ÿè®¡æ•°æ®
**æ•°æ®æ¥æº**: REST API  
**ç«¯ç‚¹**: `GET /api/alerts/stats`  

**SQL æŸ¥è¯¢**:
```sql
-- æŒ‰ä¸¥é‡ç¨‹åº¦ç»Ÿè®¡
SELECT severity, COUNT(*) as count 
FROM alerts 
GROUP BY severity

-- ç›‘æ§çš„èµ„äº§æ•°é‡
SELECT DISTINCT symbol 
FROM alerts
```

**è¿”å›å­—æ®µ**:
- `total_alerts` - æ€»è­¦æŠ¥æ•°
- `critical_alerts` - ä¸¥é‡è­¦æŠ¥æ•°
- `high_alerts` - é«˜çº§è­¦æŠ¥æ•°
- `medium_alerts` - ä¸­çº§è­¦æŠ¥æ•°
- `monitored_assets` - ç›‘æ§çš„èµ„äº§æ•°é‡
- `severity_breakdown` - ä¸¥é‡ç¨‹åº¦è¯¦ç»†åˆ†å¸ƒ

---

### 4. äº‹ä»¶è¯¦ç»†æ•°æ®
**æ•°æ®æ¥æº**: é€‰ä¸­äº‹ä»¶çš„ `details` å­—æ®µ

**ä»æ•°æ®åº“è§£æ**:
```javascript
details = JSON.parse(row.details)
{
  price_change: -0.152,      // ä»·æ ¼å˜åŒ–ï¼ˆ-15.2%ï¼‰
  current_price: 57000,      // å½“å‰ä»·æ ¼
  previous_price: 68000,     // ä¹‹å‰ä»·æ ¼
  alert_type: "Price Jump",  // è­¦æŠ¥ç±»å‹
  volume_change: 2.4         // äº¤æ˜“é‡å˜åŒ–
}
```

**æ˜¾ç¤ºä½ç½®**:
- Peak Price (å´©ç›˜å‰æœ€é«˜ä»·) - `details.previous_price`
- Bottom Price (å´©ç›˜æ—¶æœ€ä½ä»·) - `details.current_price`
- Price Change (ä»·æ ¼å˜åŒ–) - `crashPercentage` (ä» `details.price_change` è®¡ç®—)
- Duration (æŒç»­æ—¶é—´) - åŸºäºåŒä¸€å¤©è­¦æŠ¥æ•°é‡ä¼°ç®—

---

## ğŸ“ æ•°æ®æ˜¾ç¤ºä½ç½®

### black-swan é¡µé¢

#### å·¦ä¾§é¢æ¿
- **é—ªå´©äº‹ä»¶åˆ—è¡¨** â† `/api/alerts/crash-events`
  - äº‹ä»¶æ•°é‡
  - èµ„äº§åç§°
  - å´©ç›˜ç™¾åˆ†æ¯”
  - æ—¥æœŸ
  - æŒç»­æ—¶é—´

#### ä¸­é—´é¢æ¿
- **äº‹ä»¶æ¦‚è§ˆ** â† é€‰ä¸­äº‹ä»¶çš„æ•°æ®
  - èµ„äº§åç§° (`asset`)
  - å´©ç›˜ç™¾åˆ†æ¯” (`crashPercentage`)
  - æŒç»­æ—¶é—´ (`duration`)
  - æè¿° (`description`)
  
- **æ•°æ®æŒ‡æ ‡** â† é€‰ä¸­äº‹ä»¶çš„ `details`
  - Peak Price (`details.previous_price`)
  - Bottom Price (`details.current_price`)
  - Price Change (`crashPercentage`)
  - Duration (`duration`)

#### å³ä¾§é¢æ¿ï¼ˆå®æ—¶ç›‘æ§ï¼‰
- **è­¦æŠ¥æµ** â† WebSocket å®æ—¶æ¨é€
  - æ¯æ¡è­¦æŠ¥çš„è¯¦ç»†ä¿¡æ¯
  
- **ç»Ÿè®¡æ•°æ®** â† `/api/alerts/stats`
  - Recent: æœ€è¿‘20æ¡ï¼ˆæ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„ï¼‰
  - Critical: ä¸¥é‡è­¦æŠ¥æ•°ï¼ˆæœ€è¿‘20æ¡ä¸­çš„ï¼‰
  - Total: æ€»è­¦æŠ¥æ•°ï¼ˆæ•°æ®åº“ä¸­æ‰€æœ‰çš„ï¼‰
  
- **ç³»ç»ŸçŠ¶æ€** â† `/api/alerts/stats`
  - WS: WebSocketè¿æ¥çŠ¶æ€
  - Monitor: ç›‘æ§çŠ¶æ€ï¼ˆå›ºå®šæ˜¾ç¤º ACTIVEï¼‰
  - Assets: ç›‘æ§çš„èµ„äº§æ•°é‡ï¼ˆæ•°æ®åº“ä¸­ä¸åŒsymbolçš„æ•°é‡ï¼‰

---

### black-swan-terminal é¡µé¢

#### è­¦æŠ¥æµ
- **æ‰€æœ‰è­¦æŠ¥** â† `/api/alerts` + WebSocket
  - å¯åŠ¨æ—¶åŠ è½½æœ€è¿‘100æ¡å†å²è­¦æŠ¥
  - å®æ—¶æ¥æ”¶æ–°è­¦æŠ¥

#### ç»Ÿè®¡é¢æ¿
- **STATISTICS** â† å®æ—¶è®¡ç®—
  - Total Alerts: å½“å‰æ˜¾ç¤ºçš„è­¦æŠ¥æ•°
  - Critical/High/Medium: æŒ‰ä¸¥é‡ç¨‹åº¦åˆ†ç»„ç»Ÿè®¡
  - Assets: ä¸åŒèµ„äº§æ•°é‡

- **SYSTEM STATUS** â† å®æ—¶ç›‘æ§
  - WebSocket: è¿æ¥çŠ¶æ€
  - Monitoring: ç›‘æ§çŠ¶æ€
  - Uptime: è¿è¡Œæ—¶é—´ï¼ˆå‰ç«¯è®¡æ—¶ï¼‰
  - CPU/Memory: æ¨¡æ‹Ÿæ•°æ®ï¼ˆå¯ä»¥åç»­å¯¹æ¥çœŸå®ç³»ç»Ÿèµ„æºï¼‰

---

## ğŸ”„ æ•°æ®æ›´æ–°æœºåˆ¶

### å®æ—¶æ•°æ®
- **WebSocketæ¨é€**: æ¯2ç§’æ£€æŸ¥æ•°æ®åº“æ–°è­¦æŠ¥
- **è‡ªåŠ¨é‡è¿**: æ–­çº¿å5ç§’è‡ªåŠ¨é‡è¿
- **æ— éœ€åˆ·æ–°**: æ–°è­¦æŠ¥è‡ªåŠ¨å‡ºç°åœ¨ç•Œé¢

### å†å²æ•°æ®
- **é¡µé¢åŠ è½½æ—¶**: è‡ªåŠ¨è·å–ä¸€æ¬¡
- **æ‰‹åŠ¨åˆ·æ–°**: åˆ·æ–°æµè§ˆå™¨é¡µé¢é‡æ–°åŠ è½½

---

## ğŸ“Š æ•°æ®çœŸå®æ€§éªŒè¯

### å¦‚ä½•éªŒè¯æ•°æ®æ˜¯çœŸå®çš„ï¼Ÿ

#### æ–¹æ³•1ï¼šæŸ¥çœ‹æ•°æ®åº“
```bash
cd duolume-master
python check_btc_eth_alerts.py
```

#### æ–¹æ³•2ï¼šæŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—
```bash
cd LUMI
npm run dev
# è§‚å¯Ÿå¯åŠ¨æ—¥å¿—
ğŸ¦¢ é¢„è­¦ç›‘æ§å·²å¯åŠ¨ï¼Œæœ€åé¢„è­¦ ID: 123
```

#### æ–¹æ³•3ï¼šå¯¹æ¯”ç»ˆç«¯å’Œæ•°æ®åº“
```bash
# åœ¨ç»ˆç«¯æŸ¥è¯¢æ•°æ®åº“
cd duolume-master
sqlite3 utils/database/app.db "SELECT COUNT(*) FROM alerts;"

# å¯¹æ¯”é¡µé¢æ˜¾ç¤ºçš„ Total æ•°å­—
# åº”è¯¥ä¸€è‡´
```

#### æ–¹æ³•4ï¼šå®æ—¶ç”Ÿæˆæµ‹è¯•
```bash
# å¯åŠ¨é¢„è­¦æœåŠ¡
cd duolume-master
python main.py

# è§‚å¯Ÿé¡µé¢å®æ—¶æ›´æ–°
# æ–°è­¦æŠ¥ä¼šç«‹å³æ˜¾ç¤º
```

---

## ğŸ¯ æ— æ¨¡æ‹Ÿæ•°æ®

### å·²ç§»é™¤çš„æ¨¡æ‹Ÿæ•°æ®
- âŒ ~~ç¡¬ç¼–ç çš„é—ªå´©äº‹ä»¶åˆ—è¡¨~~
- âŒ ~~å›ºå®šçš„ç›‘æ§èµ„äº§æ•°é‡ (156)~~
- âŒ ~~å›ºå®šçš„ä»·æ ¼æ•°æ® ($68,000, $57,000)~~
- âŒ ~~å›ºå®šçš„äº¤æ˜“é‡å¢å¹… (+340%)~~
- âŒ ~~å›ºå®šçš„æ³¢åŠ¨ç‡ (89.2%)~~

### ç°åœ¨ä½¿ç”¨çš„çœŸå®æ•°æ®
- âœ… ä»æ•°æ®åº“æŸ¥è¯¢çš„é—ªå´©äº‹ä»¶
- âœ… å®æ—¶è®¡ç®—çš„èµ„äº§æ•°é‡
- âœ… äº‹ä»¶è¯¦æƒ…ä¸­çš„çœŸå®ä»·æ ¼
- âœ… çœŸå®çš„ä»·æ ¼å˜åŒ–ç™¾åˆ†æ¯”
- âœ… åŸºäºè­¦æŠ¥æ•°é‡ä¼°ç®—çš„æŒç»­æ—¶é—´

---

## ğŸ’¾ æ•°æ®åº“ç»“æ„

### alerts è¡¨
```sql
CREATE TABLE alerts (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  timestamp TEXT NOT NULL,
  symbol TEXT NOT NULL,
  message TEXT NOT NULL,
  severity TEXT NOT NULL,
  details TEXT,  -- JSON æ ¼å¼
  type TEXT
);
```

### details å­—æ®µ (JSON)
```json
{
  "price_change": -0.0523,
  "current_price": 57000,
  "previous_price": 68000,
  "alert_type": "Price Jump",
  "volume_change": 3.4
}
```

---

## ğŸ”§ è‡ªå®šä¹‰æŸ¥è¯¢

### æ‰©å±•APIç«¯ç‚¹

å¦‚æœéœ€è¦æ›´å¤šæ•°æ®ï¼Œå¯ä»¥åœ¨ `LUMI/server.js` ä¸­æ·»åŠ æ–°çš„ç«¯ç‚¹ï¼š

```javascript
else if (req.url === '/api/alerts/custom') {
  // æ·»åŠ è‡ªå®šä¹‰æŸ¥è¯¢é€»è¾‘
  const db = new sqlite3.Database(dbFile);
  db.all('YOUR SQL QUERY', (err, rows) => {
    // å¤„ç†æ•°æ®
    res.end(JSON.stringify({ success: true, data: rows }));
  });
}
```

---

## ğŸ“ˆ æ•°æ®æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Binance API       â”‚  å®æ—¶å¸‚åœºæ•°æ®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   main.py           â”‚  æ£€æµ‹å™¨åˆ†æ
â”‚  - price_jump       â”‚  - ä»·æ ¼æ³¢åŠ¨
â”‚  - whale_transfer   â”‚  - å¤§é¢è½¬è´¦
â”‚  - funding_spike    â”‚  - èµ„é‡‘è´¹ç‡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SQLite DB         â”‚  å­˜å‚¨è­¦æŠ¥
â”‚   alerts è¡¨         â”‚  - timestamp
â”‚                     â”‚  - symbol
â”‚                     â”‚  - severity
â”‚                     â”‚  - details
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   server.js         â”‚  ç›‘æ§ + æ¨é€
â”‚  - æ¯2ç§’æ£€æŸ¥        â”‚
â”‚  - WebSocketæ¨é€    â”‚
â”‚  - REST APIæŸ¥è¯¢     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯ç•Œé¢          â”‚  æ˜¾ç¤ºæ•°æ®
â”‚  - black-swan       â”‚  - å†å²äº‹ä»¶
â”‚  - terminal         â”‚  - å®æ—¶ç›‘æ§
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… æ€»ç»“

æ‰€æœ‰æ•°æ®ç°åœ¨éƒ½æ˜¯ï¼š
- âœ… **çœŸå®çš„** - æ¥è‡ªæ•°æ®åº“å’Œå®æ—¶æ£€æµ‹
- âœ… **åŠ¨æ€çš„** - è‡ªåŠ¨æ›´æ–°ï¼Œæ— éœ€åˆ·æ–°
- âœ… **å‡†ç¡®çš„** - ç›´æ¥æŸ¥è¯¢æ•°æ®åº“
- âœ… **å¯éªŒè¯çš„** - å¯ä»¥å¯¹æ¯”æ•°æ®åº“å’Œç•Œé¢

æ²¡æœ‰ä»»ä½•ç¡¬ç¼–ç çš„æ¨¡æ‹Ÿæ•°æ®ï¼

---

## ğŸš€ å¼€å§‹ä½¿ç”¨çœŸå®æ•°æ®

```bash
# 1. å¯åŠ¨é¢„è­¦æœåŠ¡ï¼ˆç”ŸæˆçœŸå®æ•°æ®ï¼‰
cd duolume-master
python main.py

# 2. å¯åŠ¨LUMIï¼ˆæ˜¾ç¤ºçœŸå®æ•°æ®ï¼‰
cd LUMI
npm run dev

# 3. è®¿é—®é¡µé¢
http://localhost:3000/black-swan
http://localhost:3000/black-swan-terminal
```

æ‰€æœ‰æ˜¾ç¤ºçš„æ•°æ®éƒ½æ˜¯ä» `duolume-master/utils/database/app.db` è¯»å–çš„çœŸå®é¢„è­¦æ•°æ®ï¼




