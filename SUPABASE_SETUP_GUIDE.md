# ğŸš€ Supabase å¿«é€Ÿè®¾ç½®æŒ‡å—

## âœ… ç¬¬ä¸€æ­¥ï¼šåˆ›å»º Supabase é¡¹ç›®ï¼ˆ2 åˆ†é’Ÿï¼‰

### 1. è®¿é—® Supabase
æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š**https://supabase.com**

### 2. æ³¨å†Œ/ç™»å½•
- ç‚¹å‡»å³ä¸Šè§’ **"Start your project"**
- é€‰æ‹© **"Sign in with GitHub"**ï¼ˆæ¨èï¼‰
- æˆ–ä½¿ç”¨é‚®ç®±æ³¨å†Œ

### 3. åˆ›å»ºæ–°é¡¹ç›®
ç‚¹å‡» **"New Project"** åå¡«å†™ï¼š

```
Organization: é€‰æ‹©ä½ çš„ç»„ç»‡ï¼ˆæˆ–åˆ›å»ºæ–°çš„ï¼‰
Project name: market-clob
Database Password: è®¾ç½®ä¸€ä¸ªå¼ºå¯†ç ï¼ˆåŠ¡å¿…è®°ä½ï¼ï¼‰
Region: Southeast Asia (Singapore) - äºšæ´²æœ€è¿‘çš„èŠ‚ç‚¹
Pricing Plan: Free ($0/æœˆ)
```

ç‚¹å‡» **"Create new project"**

### 4. ç­‰å¾…åˆå§‹åŒ–
â³ ç­‰å¾…çº¦ 2-3 åˆ†é’Ÿï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨åˆ›å»º

---

## âœ… ç¬¬äºŒæ­¥ï¼šå¯¼å…¥æ•°æ®åº“è¡¨ç»“æ„ï¼ˆ2 åˆ†é’Ÿï¼‰

### 1. æ‰“å¼€ SQL Editor
åœ¨ Supabase æ§åˆ¶å°å·¦ä¾§èœå•ï¼š
- ç‚¹å‡» **"SQL Editor"** å›¾æ ‡ï¼ˆğŸ“ï¼‰

### 2. åˆ›å»ºæ–°æŸ¥è¯¢
- ç‚¹å‡» **"New query"** æŒ‰é’®

### 3. å¤åˆ¶è¡¨ç»“æ„ä»£ç 
æ‰“å¼€é¡¹ç›®æ–‡ä»¶ï¼š
```
E:\project\market\scripts\setup-database.sql
```

**å…¨é€‰å¤åˆ¶** è¿™ä¸ªæ–‡ä»¶çš„å…¨éƒ¨å†…å®¹

### 4. ç²˜è´´å¹¶æ‰§è¡Œ
- ç²˜è´´åˆ° Supabase SQL Editor
- ç‚¹å‡»å³ä¸‹è§’çš„ **"Run"** æŒ‰é’®ï¼ˆæˆ–æŒ‰ Ctrl+Enterï¼‰

### 5. éªŒè¯è¡¨åˆ›å»º
åœ¨å·¦ä¾§ç‚¹å‡» **"Table Editor"**ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
- âœ… markets
- âœ… orders
- âœ… trades
- âœ… settlements
- âœ… balances
- âœ… users
- âœ… activity_logs

---

## âœ… ç¬¬ä¸‰æ­¥ï¼šè·å–è¿æ¥ä¿¡æ¯ï¼ˆ1 åˆ†é’Ÿï¼‰

### 1. æ‰“å¼€æ•°æ®åº“è®¾ç½®
å·¦ä¾§èœå•ç‚¹å‡»ï¼š**Settings** âš™ï¸ â†’ **Database**

### 2. æ‰¾åˆ°è¿æ¥å­—ç¬¦ä¸²
æ»šåŠ¨åˆ° **"Connection string"** éƒ¨åˆ†

### 3. é€‰æ‹© "Connection pooling"
âš ï¸ **é‡è¦**ï¼šå¿…é¡»é€‰æ‹© **"Connection pooling"**ï¼ˆé€‚åˆ Serverlessï¼‰

ä½ ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„ URLï¼š
```
postgresql://postgres.abcdefghijklmn:[YOUR-PASSWORD]@aws-0-ap-southeast-1.pooler.supabase.com:5432/postgres
```

### 4. å¤åˆ¶å®Œæ•´ URL
ç‚¹å‡»å³ä¾§çš„ ğŸ“‹ å¤åˆ¶æŒ‰é’®

---

## âœ… ç¬¬å››æ­¥ï¼šæ›´æ–°é¡¹ç›®é…ç½®ï¼ˆ1 åˆ†é’Ÿï¼‰

### 1. æ‰“å¼€é…ç½®æ–‡ä»¶
```
E:\project\market\.env.local
```

### 2. æ‰¾åˆ° DATABASE_URL è¿™ä¸€è¡Œ

**æ›¿æ¢å‰ï¼š**
```env
DATABASE_URL=postgresql://postgres:yourpassword@localhost:5432/market_clob
```

**æ›¿æ¢åï¼š**
```env
DATABASE_URL=postgresql://postgres.xxx:[YOUR-PASSWORD]@aws-0-ap-southeast-1.pooler.supabase.com:5432/postgres
```

âš ï¸ **å…³é”®æ­¥éª¤**ï¼šå°† URL ä¸­çš„ `[YOUR-PASSWORD]` æ›¿æ¢ä¸ºä½ åœ¨ç¬¬ä¸€æ­¥è®¾ç½®çš„**å®é™…æ•°æ®åº“å¯†ç **

### 3. ä¿å­˜æ–‡ä»¶

---

## âœ… ç¬¬äº”æ­¥ï¼šæµ‹è¯•è¿æ¥ï¼ˆ30 ç§’ï¼‰

### åœ¨é¡¹ç›®ç›®å½•æ‰“å¼€ç»ˆç«¯

è¿è¡Œæµ‹è¯•å‘½ä»¤ï¼š
```bash
npx ts-node scripts/test-db-connection.ts
```

**é¢„æœŸè¾“å‡ºï¼š**
```
ğŸ§ª æµ‹è¯•æ•°æ®åº“è¿æ¥...

1ï¸âƒ£ æµ‹è¯•åŸºæœ¬è¿æ¥...
âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ: 2024-10-23T...

2ï¸âƒ£ æ£€æŸ¥æ•°æ®åº“è¡¨...
ğŸ“‹ å·²åˆ›å»ºçš„è¡¨: [
  'activity_logs',
  'balances',
  'markets',
  'orders',
  'settlements',
  'trades',
  'users'
]
âœ… æ‰€æœ‰å¿…éœ€çš„è¡¨éƒ½å·²åˆ›å»ºï¼

...

âœ… æ•°æ®åº“æµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼
ğŸš€ å¯ä»¥å¼€å§‹ä½¿ç”¨ CLOB ç³»ç»Ÿäº†ï¼
```

---

## ğŸ‰ å®Œæˆï¼ç°åœ¨ä½ æ‹¥æœ‰ï¼š

âœ… **äº‘ç«¯ PostgreSQL æ•°æ®åº“**
- æ°¸ä¹…å­˜å‚¨
- è‡ªåŠ¨å¤‡ä»½
- å…¨çƒå¯è®¿é—®

âœ… **å…è´¹é¢åº¦**
- 500MB æ•°æ®åº“å­˜å‚¨
- æ¯å¤© 50,000 API è¯·æ±‚
- 5GB å¸¦å®½/æœˆ
- 2 ä¸ªå¹¶å‘è¿æ¥

âœ… **ä¼ä¸šçº§åŠŸèƒ½**
- è‡ªåŠ¨æ‰©å±•
- SSL åŠ å¯†è¿æ¥
- å®æ—¶æ•°æ®è®¢é˜…
- 99.9% æ­£å¸¸è¿è¡Œæ—¶é—´

---

## ğŸš€ å¯åŠ¨åº”ç”¨

```bash
npm run dev
```

è®¿é—®ï¼š
- ä¸»é¡µï¼šhttp://localhost:3000
- CLOB äº¤æ˜“ï¼šhttp://localhost:3000/clob-trade/1

**æ•°æ®ç°åœ¨å­˜å‚¨åœ¨äº‘ç«¯äº†ï¼** ğŸŒ

---

## ğŸ“Š Supabase æ§åˆ¶å°åŠŸèƒ½

### Table Editor
- ğŸ“ å¯è§†åŒ–ç¼–è¾‘æ•°æ®
- æ·»åŠ /åˆ é™¤/ä¿®æ”¹è®°å½•
- ç±»ä¼¼ Excel çš„ç•Œé¢

### SQL Editor
- è¿è¡Œä»»æ„ SQL æŸ¥è¯¢
- ä¿å­˜å¸¸ç”¨æŸ¥è¯¢
- æŸ¥çœ‹æ‰§è¡Œå†å²

### Database
- æŸ¥çœ‹è¿æ¥ä¿¡æ¯
- ç®¡ç†æ‰©å±•
- é…ç½®å¤‡ä»½

### API
- è‡ªåŠ¨ç”Ÿæˆ RESTful API
- å®æ—¶è®¢é˜…åŠŸèƒ½
- GraphQL æ”¯æŒ

---

## ğŸ” éªŒè¯æ•°æ®

### åœ¨ Supabase Table Editor ä¸­ï¼š

1. **æŸ¥çœ‹å¸‚åœºè¡¨**
   - å·¦ä¾§ç‚¹å‡» **"markets"**
   - åº”è¯¥æ˜¯ç©ºçš„ï¼ˆç­‰å¾…åˆ›å»ºå¸‚åœºï¼‰

2. **æ’å…¥æµ‹è¯•å¸‚åœº**
   - ç‚¹å‡» **"Insert row"**
   - å¡«å†™å­—æ®µï¼š
     ```
     question_id: test_001
     title: ç‰¹æœ—æ™®ä¼šèµ¢å¾—2024å¹´ç¾å›½æ€»ç»Ÿé€‰ä¸¾å—ï¼Ÿ
     description: æµ‹è¯•å¸‚åœº
     main_category: geopolitics
     status: active
     blockchain_status: created
     ```
   - ç‚¹å‡» **"Save"**

3. **éªŒè¯è®¢å•è¡¨**
   - ç‚¹å‡» **"orders"** è¡¨
   - ç°åœ¨æ˜¯ç©ºçš„
   - ç”¨æˆ·ä¸‹å•åä¼šè‡ªåŠ¨å¡«å……

---

## ğŸ’¡ å¸¸ç”¨æ“ä½œ

### æŸ¥çœ‹æ‰€æœ‰å¸‚åœº
åœ¨ SQL Editor ä¸­è¿è¡Œï¼š
```sql
SELECT * FROM markets ORDER BY created_at DESC;
```

### æŸ¥çœ‹æ‰€æœ‰è®¢å•
```sql
SELECT 
  o.*,
  m.title as market_title
FROM orders o
LEFT JOIN markets m ON o.market_id = m.id
ORDER BY o.created_at DESC
LIMIT 20;
```

### æŸ¥çœ‹æˆäº¤è®°å½•
```sql
SELECT * FROM trades ORDER BY created_at DESC LIMIT 20;
```

### æŸ¥çœ‹è®¢å•ç°¿
```sql
SELECT * FROM order_book_aggregated WHERE market_id = 1;
```

---

## ğŸ”’ å®‰å…¨å»ºè®®

### 1. ä¿æŠ¤ä½ çš„å¯†ç 
- âŒ ä¸è¦å°† `.env.local` æäº¤åˆ° Git
- âœ… å·²åœ¨ `.gitignore` ä¸­æ’é™¤
- âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡

### 2. é…ç½® Row Level Security (RLS)
Supabase é»˜è®¤å¯ç”¨ RLSï¼Œä½ å¯ä»¥åœ¨æ§åˆ¶å°é…ç½®è®¿é—®ç­–ç•¥ã€‚

### 3. API å¯†é’¥ç®¡ç†
- Supabase æä¾› anon key å’Œ service_role key
- anon key ç”¨äºå‰ç«¯ï¼ˆå…¬å¼€çš„ï¼‰
- service_role key ç”¨äºåç«¯ï¼ˆä¿å¯†ï¼‰

---

## ğŸ“ˆ å‡çº§é€‰é¡¹

### å½“å‰ï¼šFree å±‚
```
âœ… 500MB æ•°æ®åº“
âœ… 50K è¯·æ±‚/å¤©
âœ… 5GB å¸¦å®½/æœˆ
âœ… 2 å¹¶å‘è¿æ¥
```

### éœ€è¦å‡çº§æ—¶ï¼šPro å±‚ ($25/æœˆ)
```
âœ… 8GB æ•°æ®åº“
âœ… 500K è¯·æ±‚/å¤©
âœ… 250GB å¸¦å®½/æœˆ
âœ… 60 å¹¶å‘è¿æ¥
âœ… æ¯æ—¥å¤‡ä»½
âœ… æŠ€æœ¯æ”¯æŒ
```

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: è¿æ¥å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
**æ£€æŸ¥æ¸…å•ï¼š**
1. âœ… æ•°æ®åº“å¯†ç æ˜¯å¦æ­£ç¡®
2. âœ… URL ä¸­çš„ `[YOUR-PASSWORD]` å·²æ›¿æ¢
3. âœ… ä½¿ç”¨çš„æ˜¯ "Connection pooling" URL
4. âœ… ç½‘ç»œè¿æ¥æ­£å¸¸

### Q2: è¡¨æœªåˆ›å»ºï¼Ÿ
**è§£å†³æ–¹æ³•ï¼š**
1. å›åˆ° Supabase SQL Editor
2. é‡æ–°ç²˜è´´ `setup-database.sql` å†…å®¹
3. ç‚¹å‡» "Run"
4. æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

### Q3: å¦‚ä½•æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼Ÿ
åœ¨ Supabase æ§åˆ¶å°ï¼š
- ç‚¹å‡» **"Logs"**
- æŸ¥çœ‹æœ€è¿‘çš„æŸ¥è¯¢å’Œé”™è¯¯

### Q4: å¦‚ä½•å¤‡ä»½æ•°æ®ï¼Ÿ
**è‡ªåŠ¨å¤‡ä»½ï¼š** Free å±‚ä¸åŒ…å«ï¼ŒPro å±‚æ¯æ—¥è‡ªåŠ¨å¤‡ä»½

**æ‰‹åŠ¨å¤‡ä»½ï¼š**
1. Settings â†’ Database
2. ç‚¹å‡» "Database Webhooks"
3. æˆ–ä½¿ç”¨ SQL Editor å¯¼å‡ºæ•°æ®

---

## ğŸ¯ ä¸‹ä¸€æ­¥

### 1. åˆ›å»ºæµ‹è¯•å¸‚åœº
ä½¿ç”¨ SQL Editor æˆ–ç®¡ç†åå°åˆ›å»ºå¸‚åœº

### 2. æµ‹è¯•äº¤æ˜“
è®¿é—® CLOB äº¤æ˜“é¡µé¢ï¼Œè¿æ¥é’±åŒ…ä¸‹å•

### 3. éƒ¨ç½²åˆ° Vercel
```bash
npx vercel
```

ç„¶ååœ¨ Vercel ç¯å¢ƒå˜é‡ä¸­æ·»åŠ ï¼š
```
DATABASE_URL=ä½ çš„Supabaseè¿æ¥å­—ç¬¦ä¸²
```

---

## ğŸ“š ç›¸å…³èµ„æº

- **Supabase æ–‡æ¡£**: https://supabase.com/docs
- **PostgreSQL æ•™ç¨‹**: https://supabase.com/docs/guides/database
- **JavaScript å®¢æˆ·ç«¯**: https://supabase.com/docs/reference/javascript
- **ç¤¾åŒºè®ºå›**: https://github.com/supabase/supabase/discussions

---

## âœ… å®Œæˆæ£€æŸ¥æ¸…å•

- [ ] å·²åˆ›å»º Supabase é¡¹ç›®
- [ ] å·²å¯¼å…¥æ•°æ®åº“è¡¨ç»“æ„ï¼ˆ7ä¸ªè¡¨ï¼‰
- [ ] å·²å¤åˆ¶è¿æ¥å­—ç¬¦ä¸²
- [ ] å·²æ›´æ–° `.env.local`
- [ ] æ•°æ®åº“è¿æ¥æµ‹è¯•é€šè¿‡
- [ ] å¯ä»¥è®¿é—® CLOB äº¤æ˜“é¡µé¢
- [ ] å·²åˆ›å»ºæµ‹è¯•å¸‚åœº
- [ ] å·²æµ‹è¯•ä¸‹å•åŠŸèƒ½

---

**ğŸ‰ æ­å–œï¼ä½ ç°åœ¨æ‹¥æœ‰ä¸€ä¸ªå®Œå…¨äº‘ç«¯çš„é¢„æµ‹å¸‚åœºå¹³å°ï¼**

æ‰€æœ‰æ•°æ®æ°¸ä¹…å­˜å‚¨åœ¨ Supabase äº‘ç«¯ï¼Œå…¨çƒå¯è®¿é—®ï¼ğŸŒ







