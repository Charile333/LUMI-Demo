# ğŸ“Š å¸‚åœºå¡ç‰‡å®æ—¶ä»·æ ¼æ˜¾ç¤ºåŠŸèƒ½

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

å¸‚åœºå¡ç‰‡ç°åœ¨å¯ä»¥æ˜¾ç¤ºåŸºäºè®¢å•ç°¿çš„å®æ—¶ä»·æ ¼å’Œæ¦‚ç‡ï¼

### æ ¸å¿ƒç‰¹æ€§

1. âœ… **å®æ—¶ä»·æ ¼è®¡ç®—**ï¼šæ˜¾ç¤ºä»·æ ¼ = (æœ€é«˜ä¹°ä»· + æœ€ä½å–ä»·) Ã· 2
2. âœ… **YES/NO æ¦‚ç‡æ˜¾ç¤º**ï¼šYES% + NO% = 100%
3. âœ… **ä¹°ä»·/å–ä»·æ˜¾ç¤º**ï¼šç”¨æˆ·å¯ä»¥æ¸…æ¥šçœ‹åˆ°å®é™…äº¤æ˜“ä»·æ ¼
4. âœ… **æµåŠ¨æ€§æŒ‡ç¤ºå™¨**ï¼šğŸŸ¢é«˜æµåŠ¨æ€§ | ğŸŸ¡ä¸­ç­‰ | ğŸ”´ä½æµåŠ¨æ€§
5. âœ… **ä»·å·®è­¦å‘Š**ï¼šå½“ä»·å·® >= 10% æ—¶è‡ªåŠ¨æç¤º
6. âœ… **è‡ªåŠ¨åˆ·æ–°**ï¼šæ¯30ç§’è‡ªåŠ¨æ›´æ–°ä»·æ ¼

---

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. `useMarketPrice` Hook

æ–°å¢çš„è‡ªå®šä¹‰ Hook ç”¨äºè·å–å¸‚åœºå®æ—¶ä»·æ ¼ï¼š

```typescript
// hooks/useMarketPrice.ts
import { useMarketPrice } from '@/hooks/useMarketPrice';

const price = useMarketPrice(
  marketId,     // å¸‚åœº ID
  enabled       // æ˜¯å¦å¯ç”¨ï¼ˆä»…åœ¨å·²æ¿€æ´»å¸‚åœºå¯ç”¨ï¼‰
);

// è¿”å›å€¼
interface MarketPrice {
  yes: number;        // YES ä»·æ ¼ï¼ˆ0-1ï¼‰
  no: number;         // NO ä»·æ ¼ï¼ˆ0-1ï¼‰
  probability: number; // æ¦‚ç‡ç™¾åˆ†æ¯”ï¼ˆ0-100ï¼‰
  bestBid: number;    // æœ€é«˜ä¹°ä»·
  bestAsk: number;    // æœ€ä½å–ä»·
  spread: number;     // ä»·å·®
  loading: boolean;   // åŠ è½½çŠ¶æ€
  error: string | null; // é”™è¯¯ä¿¡æ¯
}
```

### 2. MarketCard ç»„ä»¶æ›´æ–°

```typescript
// components/MarketCard.tsx
import { useMarketPrice } from '@/hooks/useMarketPrice';

export function MarketCard({ market, showPrice = true }) {
  // è·å–å®æ—¶ä»·æ ¼ï¼ˆä»…åœ¨å·²æ¿€æ´»çš„å¸‚åœºï¼‰
  const price = useMarketPrice(
    market.id,
    showPrice && market.blockchain_status === 'created'
  );

  return (
    <div>
      {/* å¸‚åœºä¿¡æ¯ */}
      
      {/* ä»·æ ¼æ˜¾ç¤ºåŒºåŸŸ */}
      {showPrice && market.blockchain_status === 'created' && (
        <div>
          {/* YES 55.0% | NO 45.0% */}
          {/* ä¹°ä»·: $0.52 | å–ä»·: $0.58 | ä»·å·®: 0.06 (6%) ğŸŸ¡ */}
        </div>
      )}
    </div>
  );
}
```

---

## ğŸ’¡ ä½¿ç”¨æ–¹æ³•

### åŸºç¡€ä½¿ç”¨

```typescript
import { MarketCard } from '@/components/MarketCard';

// æ˜¾ç¤ºå¸¦ä»·æ ¼çš„å¸‚åœºå¡ç‰‡ï¼ˆé»˜è®¤ï¼‰
<MarketCard market={market} />

// æ˜¾ç¤ºå¸¦ä»·æ ¼çš„å¸‚åœºå¡ç‰‡ï¼ˆæ˜¾å¼å¯ç”¨ï¼‰
<MarketCard market={market} showPrice={true} />

// éšè—ä»·æ ¼ï¼ˆå¦‚æœä¸éœ€è¦æ˜¾ç¤ºä»·æ ¼ï¼‰
<MarketCard market={market} showPrice={false} />
```

### åœ¨åˆ—è¡¨é¡µé¢ä¸­ä½¿ç”¨

```typescript
// app/markets/[category]/page.tsx
import { MarketCard } from '@/components/MarketCard';

export default function CategoryPage() {
  const [markets, setMarkets] = useState([]);

  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {markets.map((market) => (
        <MarketCard 
          key={market.id} 
          market={market}
          showPrice={true}  // æ˜¾ç¤ºå®æ—¶ä»·æ ¼
        />
      ))}
    </div>
  );
}
```

---

## ğŸ¨ UI æ˜¾ç¤ºæ•ˆæœ

### å·²æ¿€æ´»å¸‚åœºï¼ˆæœ‰ä»·æ ¼æ•°æ®ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç‰¹æ–¯æ‹‰ Q4 äº¤ä»˜é‡è¶…è¿‡ 50 ä¸‡ï¼Ÿ        â”‚
â”‚  âœ“ å·²æ¿€æ´»  ğŸ”¥ çƒ­é—¨                  â”‚
â”‚                                     â”‚
â”‚  é¢„æµ‹ç‰¹æ–¯æ‹‰ 2024 å¹´...              â”‚
â”‚                                     â”‚
â”‚  ğŸ‘ï¸ 1234  â­ 56  ğŸ“Š æ´»è·ƒåº¦ 85      â”‚
â”‚                                     â”‚
â”‚  â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®   â”‚
â”‚  â”‚  ğŸŸ¢ YES 55.0%   ğŸ”´ NO 45.0% â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   â”‚
â”‚  â”‚ ä¹°ä»·: $0.52  å–ä»·: $0.58    â”‚   â”‚
â”‚  â”‚ ğŸŸ¡ 6.0%                     â”‚   â”‚
â”‚  â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯   â”‚
â”‚                                     â”‚
â”‚  [äº¤æ˜“] [æ„Ÿå…´è¶£]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¤§ä»·å·®è­¦å‘Šç¤ºä¾‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®   â”‚
â”‚  â”‚  ğŸŸ¢ YES 55.0%   ğŸ”´ NO 45.0% â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   â”‚
â”‚  â”‚ ä¹°ä»·: $0.30  å–ä»·: $0.80    â”‚   â”‚
â”‚  â”‚ ğŸ”´ 50.0%                    â”‚   â”‚
â”‚  â”‚ âš ï¸ ä»·å·®è¾ƒå¤§ï¼Œäº¤æ˜“æˆæœ¬è¾ƒé«˜    â”‚   â”‚
â”‚  â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœªæ¿€æ´»å¸‚åœºï¼ˆæ— ä»·æ ¼æ˜¾ç¤ºï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–°å…´å¸‚åœºé¢„æµ‹...                     â”‚
â”‚                                     â”‚
â”‚  è¿™æ˜¯ä¸€ä¸ªå³å°†æ¿€æ´»çš„å¸‚åœº              â”‚
â”‚                                     â”‚
â”‚  ğŸ‘ï¸ 234  â­ 12  ğŸ“Š æ´»è·ƒåº¦ 45       â”‚
â”‚                                     â”‚
â”‚  [æ¿€æ´»ä¸­...] [è¡¨ç¤ºæ„Ÿå…´è¶£]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š ä»·æ ¼æ•°æ®æµ

```
ç”¨æˆ·æ‰“å¼€é¡µé¢
    â†“
MarketCard æ¸²æŸ“
    â†“
useMarketPrice Hook åˆå§‹åŒ–
    â†“
æ£€æŸ¥å¸‚åœºæ˜¯å¦å·²æ¿€æ´»ï¼Ÿ
    â”œâ”€ æ˜¯ â†’ è°ƒç”¨ /api/orders/book
    â”‚       â†“
    â”‚     è·å–è®¢å•ç°¿æ•°æ®
    â”‚       â†“
    â”‚     è®¡ç®—ä»·æ ¼ï¼š
    â”‚     - bestBid (æœ€é«˜ä¹°ä»·)
    â”‚     - bestAsk (æœ€ä½å–ä»·)
    â”‚     - midPrice = (bestBid + bestAsk) / 2
    â”‚     - spread = bestAsk - bestBid
    â”‚       â†“
    â”‚     æ›´æ–°ä»·æ ¼æ˜¾ç¤º
    â”‚       â†“
    â”‚     30ç§’åè‡ªåŠ¨åˆ·æ–° â™»ï¸
    â”‚
    â””â”€ å¦ â†’ ä¸æ˜¾ç¤ºä»·æ ¼åŒºåŸŸ
```

---

## ğŸ¯ æµåŠ¨æ€§æŒ‡ç¤ºå™¨

ä»·å·®è¶Šå° = æµåŠ¨æ€§è¶Šå¥½ = äº¤æ˜“æˆæœ¬è¶Šä½

| ä»·å·®èŒƒå›´ | æŒ‡ç¤ºå™¨ | é¢œè‰² | è¯´æ˜ |
|---------|-------|------|------|
| < 2% | ğŸŸ¢ | ç»¿è‰² | é«˜æµåŠ¨æ€§ï¼Œäº¤æ˜“æˆæœ¬ä½ |
| 2% - 10% | ğŸŸ¡ | é»„è‰² | ä¸­ç­‰æµåŠ¨æ€§ï¼Œäº¤æ˜“æˆæœ¬é€‚ä¸­ |
| >= 10% | ğŸ”´ | çº¢è‰² | ä½æµåŠ¨æ€§ï¼Œäº¤æ˜“æˆæœ¬é«˜ |

### ç¤ºä¾‹

```typescript
ä»·å·® = $0.01 (1%)  â†’ ğŸŸ¢ é«˜æµåŠ¨æ€§
ä»·å·® = $0.05 (5%)  â†’ ğŸŸ¡ ä¸­ç­‰æµåŠ¨æ€§
ä»·å·® = $0.50 (50%) â†’ ğŸ”´ ä½æµåŠ¨æ€§ + âš ï¸ è­¦å‘Š
```

---

## âš™ï¸ é…ç½®é€‰é¡¹

### è‡ªåŠ¨åˆ·æ–°é—´éš”

é»˜è®¤æ¯ 30 ç§’åˆ·æ–°ä¸€æ¬¡ï¼Œå¯åœ¨ `useMarketPrice.ts` ä¸­ä¿®æ”¹ï¼š

```typescript
// ä¿®æ”¹åˆ·æ–°é—´éš”ï¼ˆæ¯«ç§’ï¼‰
const interval = setInterval(fetchPrice, 30000); // 30ç§’

// å¦‚éœ€æ›´é¢‘ç¹åˆ·æ–°
const interval = setInterval(fetchPrice, 10000); // 10ç§’

// å¦‚éœ€æ›´æ…¢åˆ·æ–°ä»¥èŠ‚çœèµ„æº
const interval = setInterval(fetchPrice, 60000); // 60ç§’
```

### æ˜¯å¦æ˜¾ç¤ºä»·æ ¼

```typescript
// å…¨å±€å¯ç”¨/ç¦ç”¨
<MarketCard market={market} showPrice={true} />

// æ ¹æ®æ¡ä»¶æ§åˆ¶
<MarketCard 
  market={market} 
  showPrice={market.blockchain_status === 'created'} 
/>

// åœ¨ç‰¹å®šé¡µé¢ç¦ç”¨
<MarketCard market={market} showPrice={false} />
```

---

## ğŸ” æ€§èƒ½ä¼˜åŒ–

### 1. æ¡ä»¶åŠ è½½

ä»·æ ¼æ•°æ®ä»…åœ¨ä»¥ä¸‹æ¡ä»¶åŒæ—¶æ»¡è¶³æ—¶åŠ è½½ï¼š
- `showPrice = true`
- `market.blockchain_status === 'created'`ï¼ˆå·²æ¿€æ´»ï¼‰

```typescript
const price = useMarketPrice(
  market.id,
  showPrice && market.blockchain_status === 'created'
);
```

### 2. è‡ªåŠ¨æ¸…ç†

Hook è‡ªåŠ¨å¤„ç†ç»„ä»¶å¸è½½æ—¶çš„æ¸…ç†ï¼š
```typescript
return () => {
  isMounted = false;      // é˜²æ­¢å†…å­˜æ³„æ¼
  clearInterval(interval); // æ¸…ç†å®šæ—¶å™¨
};
```

### 3. é¿å…é‡å¤è¯·æ±‚

å¦‚æœå¸‚åœºæœªæ¿€æ´»ï¼Œå®Œå…¨è·³è¿‡ API è¯·æ±‚ã€‚

---

## ğŸ› é”™è¯¯å¤„ç†

### API è¯·æ±‚å¤±è´¥

```typescript
if (error) {
  // æ˜¾ç¤ºé»˜è®¤å€¼ï¼ˆ50/50ï¼‰
  // ä¸å½±å“å…¶ä»–åŠŸèƒ½
  // æ§åˆ¶å°è®°å½•é”™è¯¯
  console.error('è·å–ä»·æ ¼å¤±è´¥:', error);
}
```

### ç½‘ç»œè¶…æ—¶

```typescript
try {
  const response = await fetch('/api/orders/book', {
    signal: AbortSignal.timeout(5000) // 5ç§’è¶…æ—¶
  });
} catch (error) {
  // ä½¿ç”¨é»˜è®¤å€¼
}
```

### è®¢å•ç°¿ä¸ºç©º

```typescript
if (bestBid === 0 && bestAsk === 0) {
  // ä½¿ç”¨é»˜è®¤å€¼
  bestBid = 0.49;
  bestAsk = 0.51;
}
```

---

## ğŸ“± å“åº”å¼è®¾è®¡

ä»·æ ¼æ˜¾ç¤ºåŒºåŸŸè‡ªé€‚åº”ä¸åŒå±å¹•å°ºå¯¸ï¼š

```css
/* ç§»åŠ¨ç«¯ */
@media (max-width: 640px) {
  - ä»·æ ¼ä¿¡æ¯å‚ç›´å †å 
  - å­—ä½“ç•¥å°
  - ä¿æŒå¯è¯»æ€§
}

/* æ¡Œé¢ç«¯ */
@media (min-width: 1024px) {
  - ä»·æ ¼ä¿¡æ¯æ°´å¹³æ’åˆ—
  - æ ‡å‡†å­—ä½“å¤§å°
  - æœ€ä½³æ˜¾ç¤ºæ•ˆæœ
}
```

---

## âœ… æ€»ç»“

### æ ¸å¿ƒä¼˜åŠ¿

1. âœ… **çœŸå®å¯é **ï¼šåŸºäºè®¢å•ç°¿çš„å®é™…ä»·æ ¼
2. âœ… **å®æ—¶æ›´æ–°**ï¼šè‡ªåŠ¨åˆ·æ–°ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ
3. âœ… **ç”¨æˆ·å‹å¥½**ï¼šæ¸…æ™°çš„ä»·æ ¼å’ŒæµåŠ¨æ€§æŒ‡ç¤º
4. âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šæ¡ä»¶åŠ è½½ï¼Œé¿å…ä¸å¿…è¦è¯·æ±‚
5. âœ… **é”™è¯¯å®¹é”™**ï¼šå¤±è´¥æ—¶ä½¿ç”¨é»˜è®¤å€¼ï¼Œä¸å½±å“åŠŸèƒ½

### é€‚ç”¨åœºæ™¯

- âœ… å¸‚åœºåˆ—è¡¨é¡µï¼ˆé¦–é¡µã€åˆ†ç±»é¡µï¼‰
- âœ… æœç´¢ç»“æœé¡µ
- âœ… çƒ­é—¨å¸‚åœºæ¨è
- âœ… ç”¨æˆ·æ”¶è—åˆ—è¡¨
- âœ… ä»»ä½•éœ€è¦å±•ç¤ºå¸‚åœºå¡ç‰‡çš„åœ°æ–¹

### ä¸é€‚ç”¨åœºæ™¯

- âŒ æœªæ¿€æ´»çš„å¸‚åœºï¼ˆæ²¡æœ‰è®¢å•ç°¿æ•°æ®ï¼‰
- âŒ å†å²å·²ç»“ç®—çš„å¸‚åœºï¼ˆä»·æ ¼å·²å›ºå®šï¼‰
- âŒ çº¯å±•ç¤ºé¡µé¢ï¼ˆä¸éœ€è¦å®æ—¶æ•°æ®ï¼‰

---

## ğŸš€ éƒ¨ç½²å»ºè®®

1. ç¡®ä¿ API `/api/orders/book` æ­£å¸¸å·¥ä½œ
2. æ£€æŸ¥æ•°æ®åº“ä¸­æœ‰è®¢å•æ•°æ®
3. åœ¨ Vercel é…ç½® `DATABASE_URL` ç¯å¢ƒå˜é‡
4. æµ‹è¯•ä¸åŒç½‘ç»œæ¡ä»¶ä¸‹çš„è¡¨ç°
5. ç›‘æ§ API è¯·æ±‚é¢‘ç‡å’Œæ€§èƒ½

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼š1.0
**æ›´æ–°æ—¥æœŸ**ï¼š2025-10-29
**ä½œè€…**ï¼šLUMI Team

